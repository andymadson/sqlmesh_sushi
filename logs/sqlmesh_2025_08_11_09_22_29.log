2025-08-11 09:22:29,277 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'sushi-example.db'} (connection.py:481)
2025-08-11 09:22:29,780 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:483)
2025-08-11 09:22:29,780 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:483)
2025-08-11 09:22:29,781 - ThreadPoolExecutor-0_0 - sqlmesh.core.console - WARNING - Model '"sushi-example"."sushimoderate"."customer_lifetime_value"' was not found at C:\Users\andym\sqlmesh_tutorials\sqlmesh_sushi\tests\test_customer_lifetime_value.yaml (console.py:2224)
2025-08-11 09:22:29,836 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: sushi-example.db (connection.py:471)
2025-08-11 09:22:29,859 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0001_init' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0001_init.py'> (migrator.py:177)
2025-08-11 09:22:29,881 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0002_remove_identify' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0002_remove_identify.py'> (migrator.py:177)
2025-08-11 09:22:29,881 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0003_move_batch_size' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0003_move_batch_size.py'> (migrator.py:177)
2025-08-11 09:22:29,882 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0004_environmnent_add_finalized_at' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0004_environmnent_add_finalized_at.py'> (migrator.py:177)
2025-08-11 09:22:29,885 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0005_create_seed_table' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0005_create_seed_table.py'> (migrator.py:177)
2025-08-11 09:22:29,890 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0006_change_seed_hash' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0006_change_seed_hash.py'> (migrator.py:177)
2025-08-11 09:22:29,890 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0007_env_table_info_to_kind' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0007_env_table_info_to_kind.py'> (migrator.py:177)
2025-08-11 09:22:29,891 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0008_create_intervals_table' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0008_create_intervals_table.py'> (migrator.py:177)
2025-08-11 09:22:29,895 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0009_remove_pre_post_hooks' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0009_remove_pre_post_hooks.py'> (migrator.py:177)
2025-08-11 09:22:29,897 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0010_seed_hash_batch_size' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0010_seed_hash_batch_size.py'> (migrator.py:177)
2025-08-11 09:22:29,897 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0011_add_model_kind_name' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0011_add_model_kind_name.py'> (migrator.py:177)
2025-08-11 09:22:29,901 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0012_update_jinja_expressions' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0012_update_jinja_expressions.py'> (migrator.py:177)
2025-08-11 09:22:29,902 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0013_serde_using_model_dialects' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0013_serde_using_model_dialects.py'> (migrator.py:177)
2025-08-11 09:22:29,902 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0014_fix_dev_intervals' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0014_fix_dev_intervals.py'> (migrator.py:177)
2025-08-11 09:22:29,903 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0015_environment_add_promoted_snapshot_ids' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0015_environment_add_promoted_snapshot_ids.py'> (migrator.py:177)
2025-08-11 09:22:29,906 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0016_fix_windows_path' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0016_fix_windows_path.py'> (migrator.py:177)
2025-08-11 09:22:29,907 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0017_fix_windows_seed_path' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0017_fix_windows_seed_path.py'> (migrator.py:177)
2025-08-11 09:22:29,907 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0018_rename_snapshot_model_to_node' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0018_rename_snapshot_model_to_node.py'> (migrator.py:177)
2025-08-11 09:22:29,908 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0019_add_env_suffix_target' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0019_add_env_suffix_target.py'> (migrator.py:177)
2025-08-11 09:22:29,911 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0020_remove_redundant_attributes_from_dbt_models' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0020_remove_redundant_attributes_from_dbt_models.py'> (migrator.py:177)
2025-08-11 09:22:29,912 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0021_fix_table_properties' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0021_fix_table_properties.py'> (migrator.py:177)
2025-08-11 09:22:29,913 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0022_move_project_to_model' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0022_move_project_to_model.py'> (migrator.py:177)
2025-08-11 09:22:29,914 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0023_fix_added_models_with_forward_only_parents' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0023_fix_added_models_with_forward_only_parents.py'> (migrator.py:177)
2025-08-11 09:22:29,915 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0024_replace_model_kind_name_enum_with_value' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0024_replace_model_kind_name_enum_with_value.py'> (migrator.py:177)
2025-08-11 09:22:29,915 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0025_fix_intervals_and_missing_change_category' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0025_fix_intervals_and_missing_change_category.py'> (migrator.py:177)
2025-08-11 09:22:29,916 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0026_remove_dialect_from_seed' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0026_remove_dialect_from_seed.py'> (migrator.py:177)
2025-08-11 09:22:29,916 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0027_minute_interval_to_five' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0027_minute_interval_to_five.py'> (migrator.py:177)
2025-08-11 09:22:29,917 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0028_add_plan_dags_table' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0028_add_plan_dags_table.py'> (migrator.py:177)
2025-08-11 09:22:29,920 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0029_generate_schema_types_using_dialect' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0029_generate_schema_types_using_dialect.py'> (migrator.py:177)
2025-08-11 09:22:29,921 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0030_update_unrestorable_snapshots' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0030_update_unrestorable_snapshots.py'> (migrator.py:177)
2025-08-11 09:22:29,922 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0031_remove_dbt_target_fields' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0031_remove_dbt_target_fields.py'> (migrator.py:177)
2025-08-11 09:22:29,922 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0032_add_sqlmesh_version' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0032_add_sqlmesh_version.py'> (migrator.py:177)
2025-08-11 09:22:29,925 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0033_mysql_fix_blob_text_type' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0033_mysql_fix_blob_text_type.py'> (migrator.py:177)
2025-08-11 09:22:29,925 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0034_add_default_catalog' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0034_add_default_catalog.py'> (migrator.py:177)
2025-08-11 09:22:29,927 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0035_add_catalog_name_override' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0035_add_catalog_name_override.py'> (migrator.py:177)
2025-08-11 09:22:29,931 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0036_delete_plan_dags_bug_fix' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0036_delete_plan_dags_bug_fix.py'> (migrator.py:177)
2025-08-11 09:22:29,931 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0037_remove_dbt_is_incremental_macro' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0037_remove_dbt_is_incremental_macro.py'> (migrator.py:177)
2025-08-11 09:22:29,932 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0038_add_expiration_ts_to_snapshot' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0038_add_expiration_ts_to_snapshot.py'> (migrator.py:177)
2025-08-11 09:22:29,935 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0039_include_environment_in_plan_dag_spec' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0039_include_environment_in_plan_dag_spec.py'> (migrator.py:177)
2025-08-11 09:22:29,935 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0040_add_previous_finalized_snapshots' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0040_add_previous_finalized_snapshots.py'> (migrator.py:177)
2025-08-11 09:22:29,938 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0041_remove_hash_raw_query_attribute' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0041_remove_hash_raw_query_attribute.py'> (migrator.py:177)
2025-08-11 09:22:29,938 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0042_trim_indirect_versions' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0042_trim_indirect_versions.py'> (migrator.py:177)
2025-08-11 09:22:29,939 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0043_fix_remove_obsolete_attributes_in_plan_dags' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0043_fix_remove_obsolete_attributes_in_plan_dags.py'> (migrator.py:177)
2025-08-11 09:22:29,940 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0044_quote_identifiers_in_model_attributes' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0044_quote_identifiers_in_model_attributes.py'> (migrator.py:177)
2025-08-11 09:22:29,940 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0045_move_gateway_variable' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0045_move_gateway_variable.py'> (migrator.py:177)
2025-08-11 09:22:29,940 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0046_add_batch_concurrency' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0046_add_batch_concurrency.py'> (migrator.py:177)
2025-08-11 09:22:29,940 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0047_change_scd_string_to_column' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0047_change_scd_string_to_column.py'> (migrator.py:177)
2025-08-11 09:22:29,940 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0048_drop_indirect_versions' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0048_drop_indirect_versions.py'> (migrator.py:177)
2025-08-11 09:22:29,941 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0049_replace_identifier_with_version_in_seeds_table' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0049_replace_identifier_with_version_in_seeds_table.py'> (migrator.py:177)
2025-08-11 09:22:29,952 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0050_drop_seeds_table' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0050_drop_seeds_table.py'> (migrator.py:177)
2025-08-11 09:22:29,954 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0051_rename_column_descriptions' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0051_rename_column_descriptions.py'> (migrator.py:177)
2025-08-11 09:22:29,955 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0052_add_normalize_name_in_environment_naming_info' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0052_add_normalize_name_in_environment_naming_info.py'> (migrator.py:177)
2025-08-11 09:22:29,957 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0053_custom_model_kind_extra_attributes' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0053_custom_model_kind_extra_attributes.py'> (migrator.py:177)
2025-08-11 09:22:29,958 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0054_fix_trailing_comments' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0054_fix_trailing_comments.py'> (migrator.py:177)
2025-08-11 09:22:29,958 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0055_add_updated_ts_unpaused_ts_ttl_ms_unrestorable_to_snapshot' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0055_add_updated_ts_unpaused_ts_ttl_ms_unrestorable_to_snapshot.py'> (migrator.py:177)
2025-08-11 09:22:29,970 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0056_restore_table_indexes' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0056_restore_table_indexes.py'> (migrator.py:177)
2025-08-11 09:22:29,970 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0057_add_table_format' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0057_add_table_format.py'> (migrator.py:177)
2025-08-11 09:22:29,970 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0058_add_requirements' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0058_add_requirements.py'> (migrator.py:177)
2025-08-11 09:22:29,973 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0059_add_physical_version' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0059_add_physical_version.py'> (migrator.py:177)
2025-08-11 09:22:29,973 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0060_move_audits_to_model' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0060_move_audits_to_model.py'> (migrator.py:177)
2025-08-11 09:22:29,974 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0061_mysql_fix_blob_text_type' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0061_mysql_fix_blob_text_type.py'> (migrator.py:177)
2025-08-11 09:22:29,974 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0062_add_model_gateway' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0062_add_model_gateway.py'> (migrator.py:177)
2025-08-11 09:22:29,974 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0063_change_signals' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0063_change_signals.py'> (migrator.py:177)
2025-08-11 09:22:29,975 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0064_join_when_matched_strings' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0064_join_when_matched_strings.py'> (migrator.py:177)
2025-08-11 09:22:29,975 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0065_add_model_optimize' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0065_add_model_optimize.py'> (migrator.py:177)
2025-08-11 09:22:29,975 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0066_add_auto_restatements' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0066_add_auto_restatements.py'> (migrator.py:177)
2025-08-11 09:22:29,982 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0067_add_tsql_date_full_precision' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0067_add_tsql_date_full_precision.py'> (migrator.py:177)
2025-08-11 09:22:29,982 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0068_include_unrendered_query_in_metadata_hash' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0068_include_unrendered_query_in_metadata_hash.py'> (migrator.py:177)
2025-08-11 09:22:29,982 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0069_update_dev_table_suffix' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0069_update_dev_table_suffix.py'> (migrator.py:177)
2025-08-11 09:22:29,984 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0070_include_grains_in_metadata_hash' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0070_include_grains_in_metadata_hash.py'> (migrator.py:177)
2025-08-11 09:22:29,984 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0071_add_dev_version_to_intervals' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0071_add_dev_version_to_intervals.py'> (migrator.py:177)
2025-08-11 09:22:29,988 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0072_add_environment_statements' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0072_add_environment_statements.py'> (migrator.py:177)
2025-08-11 09:22:29,992 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0073_remove_symbolic_disable_restatement' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0073_remove_symbolic_disable_restatement.py'> (migrator.py:177)
2025-08-11 09:22:29,993 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0074_add_partition_by_time_column_property' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0074_add_partition_by_time_column_property.py'> (migrator.py:177)
2025-08-11 09:22:29,993 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0075_remove_validate_query' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0075_remove_validate_query.py'> (migrator.py:177)
2025-08-11 09:22:29,994 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0076_add_cron_tz' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0076_add_cron_tz.py'> (migrator.py:177)
2025-08-11 09:22:29,994 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0077_fix_column_type_hash_calculation' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0077_fix_column_type_hash_calculation.py'> (migrator.py:177)
2025-08-11 09:22:29,994 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0078_warn_if_non_migratable_python_env' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0078_warn_if_non_migratable_python_env.py'> (migrator.py:177)
2025-08-11 09:22:29,994 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0079_add_gateway_managed_property' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0079_add_gateway_managed_property.py'> (migrator.py:177)
2025-08-11 09:22:29,997 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0080_add_batch_size_to_scd_type_2_models' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0080_add_batch_size_to_scd_type_2_models.py'> (migrator.py:177)
2025-08-11 09:22:29,997 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0081_update_partitioned_by' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0081_update_partitioned_by.py'> (migrator.py:177)
2025-08-11 09:22:29,998 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0082_warn_if_incorrectly_duplicated_statements' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0082_warn_if_incorrectly_duplicated_statements.py'> (migrator.py:177)
2025-08-11 09:22:29,998 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0083_use_sql_for_scd_time_data_type_data_hash' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0083_use_sql_for_scd_time_data_type_data_hash.py'> (migrator.py:177)
2025-08-11 09:22:29,998 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0084_normalize_quote_when_matched_and_merge_filter' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0084_normalize_quote_when_matched_and_merge_filter.py'> (migrator.py:177)
2025-08-11 09:22:29,998 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0085_deterministic_repr' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0085_deterministic_repr.py'> (migrator.py:177)
2025-08-11 09:22:29,999 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0086_check_deterministic_bug' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0086_check_deterministic_bug.py'> (migrator.py:177)
2025-08-11 09:22:29,999 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Applying migration <module 'sqlmesh.migrations.v0087_normalize_blueprint_variables' from 'C:\\Users\\andym\\sqlmesh_tutorials\\.venv\\Lib\\site-packages\\sqlmesh\\migrations\\v0087_normalize_blueprint_variables.py'> (migrator.py:177)
2025-08-11 09:22:30,001 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Fetching environments (migrator.py:196)
2025-08-11 09:22:30,001 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - Migrating snapshot rows... (migrator.py:213)
2025-08-11 09:22:30,002 - MainThread - sqlmesh.core.state_sync.db.migrator - INFO - No changes to snapshots detected (migrator.py:206)
2025-08-11 09:22:31,540 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage CreateSnapshotRecordsStage (evaluator.py:125)
2025-08-11 09:22:31,562 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage PhysicalLayerUpdateStage (evaluator.py:125)
2025-08-11 09:22:31,565 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema "sushi-example".sqlmesh__sushimoderate (evaluator.py:361)
2025-08-11 09:22:31,565 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,566 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,567 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'sushi-example' AND table_schema = 'sqlmesh__sushimoderate') AND table_name IN ('sushimoderate__waiter_names__1494776325', 'sushimoderate__top_waiters__4200137544', 'sushimoderate__items__4183556318', 'sushimoderate__order_items__3229655664', 'sushimoderate__customers__1460721243', 'sushimoderate__customer_revenue_lifetime__2371348360', 'sushimoderate__waiter_revenue_by_day__2502736145', 'sushimoderate__orders__2553744583', 'sushimoderate__customer_revenue_by_day__2161423016') (base.py:2260)
2025-08-11 09:22:31,570 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema "sushi-example".sqlmesh__raw (evaluator.py:361)
2025-08-11 09:22:31,570 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,571 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,572 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'sushi-example' AND table_schema = 'sqlmesh__raw') AND table_name IN ('raw__marketing__2281409975', 'raw__demographics__3399964752', 'raw__items__1587933360', 'raw__orders__1960537533', 'raw__order_items__654969149') (base.py:2260)
2025-08-11 09:22:31,578 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema '"sushi-example".sqlmesh__raw' (evaluator.py:1176)
2025-08-11 09:22:31,579 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE SCHEMA IF NOT EXISTS "sushi-example"."sqlmesh__raw" (base.py:2260)
2025-08-11 09:22:31,581 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema '"sushi-example".sqlmesh__sushimoderate' (evaluator.py:1176)
2025-08-11 09:22:31,581 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE SCHEMA IF NOT EXISTS "sushi-example"."sqlmesh__sushimoderate" (base.py:2260)
2025-08-11 09:22:31,584 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__raw.raw__demographics__3399964752' (evaluator.py:1538)
2025-08-11 09:22:31,585 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,586 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,586 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__raw"."raw__demographics__3399964752" ("id" INT, "customer_id" INT, "zip" TEXT) (base.py:2260)
2025-08-11 09:22:31,628 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,629 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,630 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE TABLE "sushi-example"."sqlmesh__raw"."raw__demographics__3399964752" AS SELECT CAST("id" AS INT) AS "id", CAST("customer_id" AS INT) AS "customer_id", CAST("zip" AS TEXT) AS "zip" FROM (SELECT "id", "customer_id", "zip" FROM "sushi-example"."sqlmesh__raw"."__temp_raw__demographics__3399964752_zbdyivri") AS "_subquery" (base.py:2260)
2025-08-11 09:22:31,634 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DROP TABLE IF EXISTS "sushi-example"."sqlmesh__raw"."__temp_raw__demographics__3399964752_zbdyivri" (base.py:2260)
2025-08-11 09:22:31,637 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__raw.raw__items__1587933360' (evaluator.py:1538)
2025-08-11 09:22:31,637 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,638 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,639 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__raw"."raw__items__1587933360" ("id" INT, "name" TEXT, "price" DOUBLE, "ds" TEXT) (base.py:2260)
2025-08-11 09:22:31,648 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,649 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,650 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE TABLE "sushi-example"."sqlmesh__raw"."raw__items__1587933360" AS SELECT CAST("id" AS INT) AS "id", CAST("name" AS TEXT) AS "name", CAST("price" AS DOUBLE) AS "price", CAST("ds" AS TEXT) AS "ds" FROM (SELECT "id", "name", "price", "ds" FROM "sushi-example"."sqlmesh__raw"."__temp_raw__items__1587933360_9a9giy0p") AS "_subquery" (base.py:2260)
2025-08-11 09:22:31,653 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DROP TABLE IF EXISTS "sushi-example"."sqlmesh__raw"."__temp_raw__items__1587933360_9a9giy0p" (base.py:2260)
2025-08-11 09:22:31,657 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__raw.raw__marketing__2281409975' (evaluator.py:1538)
2025-08-11 09:22:31,658 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,659 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,660 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__raw"."raw__marketing__2281409975" ("id" INT, "customer_id" INT, "status" TEXT) (base.py:2260)
2025-08-11 09:22:31,667 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,668 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,669 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE TABLE "sushi-example"."sqlmesh__raw"."raw__marketing__2281409975" AS SELECT CAST("id" AS INT) AS "id", CAST("customer_id" AS INT) AS "customer_id", CAST("status" AS TEXT) AS "status" FROM (SELECT "id", "customer_id", "status" FROM "sushi-example"."sqlmesh__raw"."__temp_raw__marketing__2281409975_ztsw6y3f") AS "_subquery" (base.py:2260)
2025-08-11 09:22:31,672 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DROP TABLE IF EXISTS "sushi-example"."sqlmesh__raw"."__temp_raw__marketing__2281409975_ztsw6y3f" (base.py:2260)
2025-08-11 09:22:31,677 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__raw.raw__order_items__654969149' (evaluator.py:1538)
2025-08-11 09:22:31,677 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,678 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,679 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__raw"."raw__order_items__654969149" ("id" INT, "order_id" INT, "item_id" INT, "quantity" INT, "ds" TEXT) (base.py:2260)
2025-08-11 09:22:31,681 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__raw"."raw__order_items__654969149" IS 'File: models/raw/order_items.sql' (base.py:2260)
2025-08-11 09:22:31,692 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,693 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,694 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE TABLE "sushi-example"."sqlmesh__raw"."raw__order_items__654969149" AS SELECT CAST("id" AS INT) AS "id", CAST("order_id" AS INT) AS "order_id", CAST("item_id" AS INT) AS "item_id", CAST("quantity" AS INT) AS "quantity", CAST("ds" AS TEXT) AS "ds" FROM (SELECT "id", "order_id", "item_id", "quantity", "ds" FROM "sushi-example"."sqlmesh__raw"."__temp_raw__order_items__654969149_wp1hc83o") AS "_subquery" (base.py:2260)
2025-08-11 09:22:31,697 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DROP TABLE IF EXISTS "sushi-example"."sqlmesh__raw"."__temp_raw__order_items__654969149_wp1hc83o" (base.py:2260)
2025-08-11 09:22:31,707 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__raw"."raw__order_items__654969149" IS 'File: models/raw/order_items.sql' (base.py:2260)
2025-08-11 09:22:31,710 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__raw.raw__orders__1960537533' (evaluator.py:1538)
2025-08-11 09:22:31,711 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,711 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,713 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__raw"."raw__orders__1960537533" ("id" INT, "customer_id" INT, "waiter_id" INT, "start_ts" TIMESTAMP, "end_ts" TIMESTAMP, "ds" TEXT) (base.py:2260)
2025-08-11 09:22:31,723 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,724 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,725 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE TABLE "sushi-example"."sqlmesh__raw"."raw__orders__1960537533" AS SELECT CAST("id" AS INT) AS "id", CAST("customer_id" AS INT) AS "customer_id", CAST("waiter_id" AS INT) AS "waiter_id", CAST("start_ts" AS TIMESTAMP) AS "start_ts", CAST("end_ts" AS TIMESTAMP) AS "end_ts", CAST("ds" AS TEXT) AS "ds" FROM (SELECT "id", "customer_id", "waiter_id", "start_ts", "end_ts", "ds" FROM "sushi-example"."sqlmesh__raw"."__temp_raw__orders__1960537533_qpwps7ib") AS "_subquery" (base.py:2260)
2025-08-11 09:22:31,728 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DROP TABLE IF EXISTS "sushi-example"."sqlmesh__raw"."__temp_raw__orders__1960537533_qpwps7ib" (base.py:2260)
2025-08-11 09:22:31,732 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__waiter_names__1494776325' (evaluator.py:1538)
2025-08-11 09:22:31,732 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,732 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,733 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_names__1494776325" ("id" INT, "name" TEXT) (base.py:2260)
2025-08-11 09:22:31,736 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_names__1494776325" IS 'Seed data containing water names.' (base.py:2260)
2025-08-11 09:22:31,744 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,745 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,746 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_names__1494776325" AS SELECT CAST("id" AS INT) AS "id", CAST("name" AS TEXT) AS "name" FROM (SELECT "id", "name" FROM "sushi-example"."sqlmesh__sushimoderate"."__temp_sushimoderate__waiter_names__1494776325_apsym86h") AS "_subquery" (base.py:2260)
2025-08-11 09:22:31,749 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DROP TABLE IF EXISTS "sushi-example"."sqlmesh__sushimoderate"."__temp_sushimoderate__waiter_names__1494776325_apsym86h" (base.py:2260)
2025-08-11 09:22:31,752 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_names__1494776325" IS 'Seed data containing water names.' (base.py:2260)
2025-08-11 09:22:31,761 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__items__4183556318' (evaluator.py:1538)
2025-08-11 09:22:31,761 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,762 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,764 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" ("id" INT, "name" TEXT, "price" DOUBLE, "ds" TEXT) (base.py:2260)
2025-08-11 09:22:31,766 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" IS 'Incremental table loading items table from raw.' (base.py:2260)
2025-08-11 09:22:31,769 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318"."id" IS 'Item ID' (base.py:2260)
2025-08-11 09:22:31,771 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318"."name" IS 'Item name' (base.py:2260)
2025-08-11 09:22:31,773 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318"."price" IS 'Item price on this date' (base.py:2260)
2025-08-11 09:22:31,775 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318"."ds" IS 'Date' (base.py:2260)
2025-08-11 09:22:31,777 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sushimoderate.items' (evaluator.py:1560)
2025-08-11 09:22:31,778 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CAST("items"."id" AS INT) AS "id", CAST("items"."name" AS TEXT) AS "name", CAST("items"."price" AS DOUBLE) AS "price", CAST("items"."ds" AS TEXT) AS "ds" FROM "sushi-example"."sqlmesh__raw"."raw__items__1587933360" AS "items" WHERE ("items"."ds" <= '1970-01-01' AND "items"."ds" >= '1970-01-01') AND FALSE LIMIT 0 (base.py:2260)
2025-08-11 09:22:31,786 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__order_items__3229655664' (evaluator.py:1538)
2025-08-11 09:22:31,786 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,787 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,788 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" ("id" INT, "order_id" INT, "item_id" INT, "quantity" INT, "ds" TEXT) (base.py:2260)
2025-08-11 09:22:31,791 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" IS 'Incremental table loading order_items table from raw.' (base.py:2260)
2025-08-11 09:22:31,794 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664"."id" IS 'Order items ID' (base.py:2260)
2025-08-11 09:22:31,797 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664"."order_id" IS 'Order ID' (base.py:2260)
2025-08-11 09:22:31,800 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664"."item_id" IS 'Item ID' (base.py:2260)
2025-08-11 09:22:31,802 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664"."quantity" IS 'Quantity of item ordered for this order' (base.py:2260)
2025-08-11 09:22:31,805 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664"."ds" IS 'Date' (base.py:2260)
2025-08-11 09:22:31,807 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sushimoderate.order_items' (evaluator.py:1560)
2025-08-11 09:22:31,808 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CAST("order_items"."id" AS INT) AS "id", CAST("order_items"."order_id" AS INT) AS "order_id", CAST("order_items"."item_id" AS INT) AS "item_id", CAST("order_items"."quantity" AS INT) AS "quantity", CAST("order_items"."ds" AS TEXT) AS "ds" FROM "sushi-example"."sqlmesh__raw"."raw__order_items__654969149" AS "order_items" WHERE ("order_items"."ds" <= '1970-01-01' AND "order_items"."ds" >= '1970-01-01') AND FALSE LIMIT 0 (base.py:2260)
2025-08-11 09:22:31,814 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__orders__2553744583' (evaluator.py:1538)
2025-08-11 09:22:31,815 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,815 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,816 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" ("id" INT, "customer_id" INT, "waiter_id" INT, "start_ts" TIMESTAMP, "end_ts" TIMESTAMP, "ds" TEXT) (base.py:2260)
2025-08-11 09:22:31,819 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" IS 'Incremental table loading orders table from raw.' (base.py:2260)
2025-08-11 09:22:31,821 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583"."id" IS 'Order ID' (base.py:2260)
2025-08-11 09:22:31,824 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583"."customer_id" IS 'ID of customer placing order' (base.py:2260)
2025-08-11 09:22:31,827 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583"."waiter_id" IS 'ID of waiter taking order' (base.py:2260)
2025-08-11 09:22:31,829 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583"."start_ts" IS 'Order start timestamp' (base.py:2260)
2025-08-11 09:22:31,831 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583"."end_ts" IS 'Order end timestamp' (base.py:2260)
2025-08-11 09:22:31,833 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583"."ds" IS 'Order date' (base.py:2260)
2025-08-11 09:22:31,836 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sushimoderate.orders' (evaluator.py:1560)
2025-08-11 09:22:31,836 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CAST("orders"."id" AS INT) AS "id", CAST("orders"."customer_id" AS INT) AS "customer_id", CAST("orders"."waiter_id" AS INT) AS "waiter_id", CAST("orders"."start_ts" AS TIMESTAMP) AS "start_ts", CAST("orders"."end_ts" AS TIMESTAMP) AS "end_ts", CAST("orders"."ds" AS TEXT) AS "ds" FROM "sushi-example"."sqlmesh__raw"."raw__orders__1960537533" AS "orders" WHERE ("orders"."ds" <= '1970-01-01' AND "orders"."ds" >= '1970-01-01') AND FALSE LIMIT 0 (base.py:2260)
2025-08-11 09:22:31,852 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_by_day__2161423016' (evaluator.py:1538)
2025-08-11 09:22:31,852 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,853 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,854 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_by_day__2161423016" ("customer_id" INT, "revenue" DOUBLE, "ds" TEXT) (base.py:2260)
2025-08-11 09:22:31,858 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_by_day__2161423016" IS 'Incremental table of revenue from customers by day.' (base.py:2260)
2025-08-11 09:22:31,861 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_by_day__2161423016"."customer_id" IS 'Customer ID' (base.py:2260)
2025-08-11 09:22:31,863 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_by_day__2161423016"."revenue" IS 'Revenue from orders made by this customer' (base.py:2260)
2025-08-11 09:22:31,866 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_by_day__2161423016"."ds" IS 'Date' (base.py:2260)
2025-08-11 09:22:31,868 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sushimoderate.customer_revenue_by_day' (evaluator.py:1560)
2025-08-11 09:22:31,869 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total", "oi"."ds" AS "ds" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE ("oi"."ds" <= '1970-01-01' AND "oi"."ds" >= '1970-01-01') AND FALSE GROUP BY "oi"."order_id", "oi"."ds") SELECT CAST("o"."customer_id" AS INT) AS "customer_id", CAST(SUM("ot"."total") AS DOUBLE) AS "revenue", CAST("o"."ds" AS TEXT) AS "ds" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."ds" = "ot"."ds" AND "o"."id" = "ot"."order_id" WHERE ("o"."ds" <= '1970-01-01' AND "o"."ds" >= '1970-01-01') AND FALSE GROUP BY "o"."customer_id", "o"."ds" LIMIT 0 (base.py:2260)
2025-08-11 09:22:31,888 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:1538)
2025-08-11 09:22:31,888 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,889 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,890 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id" INT, "revenue" DOUBLE, "ds" TEXT) (base.py:2260)
2025-08-11 09:22:31,893 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" IS 'Incremental table of lifetime customer revenue up to a certain date.
    Use latest date to get current lifetime value.' (base.py:2260)
2025-08-11 09:22:31,896 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360"."customer_id" IS 'Customer ID' (base.py:2260)
2025-08-11 09:22:31,900 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360"."revenue" IS 'Lifetime revenue from this customer' (base.py:2260)
2025-08-11 09:22:31,903 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360"."ds" IS 'End date of the lifetime calculation' (base.py:2260)
2025-08-11 09:22:31,906 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sushimoderate.customer_revenue_lifetime' (evaluator.py:1560)
2025-08-11 09:22:31,907 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '1970-01-01' AND FALSE GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '1970-01-01' AND FALSE GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('1969-12-31' AS DATE), '%Y-%m-%d') AND FALSE) SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '1970-01-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id" WHERE FALSE LIMIT 0 (base.py:2260)
2025-08-11 09:22:31,915 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customers__1460721243' (evaluator.py:1538)
2025-08-11 09:22:31,916 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,916 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,917 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243" ("customer_id" INT, "status" TEXT, "zip" TEXT) (base.py:2260)
2025-08-11 09:22:31,920 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243" IS 'Table of customer data for customers who have ever placed an order.' (base.py:2260)
2025-08-11 09:22:31,922 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243"."customer_id" IS 'Customer ID' (base.py:2260)
2025-08-11 09:22:31,925 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243"."status" IS 'Customer marketing status' (base.py:2260)
2025-08-11 09:22:31,927 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243"."zip" IS 'Customer ZIP code' (base.py:2260)
2025-08-11 09:22:31,929 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sushimoderate.customers' (evaluator.py:1560)
2025-08-11 09:22:31,930 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT DISTINCT CAST("o"."customer_id" AS INT) AS "customer_id", CAST(COALESCE("m"."status", 'UNKNOWN') AS TEXT) AS "status", CAST("d"."zip" AS TEXT) AS "zip" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "sushi-example"."sqlmesh__raw"."raw__marketing__2281409975" AS "m" ON "m"."customer_id" = "o"."customer_id" LEFT JOIN "sushi-example"."sqlmesh__raw"."raw__demographics__3399964752" AS "d" ON "d"."customer_id" = "o"."customer_id" WHERE FALSE LIMIT 0 (base.py:2260)
2025-08-11 09:22:31,941 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__waiter_revenue_by_day__2502736145' (evaluator.py:1538)
2025-08-11 09:22:31,942 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:31,943 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:31,944 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145" ("waiter_id" INT, "revenue" DOUBLE, "ds" TEXT) (base.py:2260)
2025-08-11 09:22:31,946 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145" IS 'Incremental table of revenue generated by each waiter by day.' (base.py:2260)
2025-08-11 09:22:31,949 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145"."waiter_id" IS 'Waiter id' (base.py:2260)
2025-08-11 09:22:31,952 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145"."revenue" IS 'Revenue from orders taken by waiter on day' (base.py:2260)
2025-08-11 09:22:31,955 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145"."ds" IS 'Order date' (base.py:2260)
2025-08-11 09:22:31,957 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sushimoderate.waiter_revenue_by_day' (evaluator.py:1560)
2025-08-11 09:22:31,959 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CAST("o"."waiter_id" AS INT) AS "waiter_id", CAST(SUM("oi"."quantity" * "i"."price") AS DOUBLE) AS "revenue", CAST("o"."ds" AS TEXT) AS "ds" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" ON "o"."ds" = "oi"."ds" AND "o"."id" = "oi"."order_id" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE ("o"."ds" <= '1970-01-01' AND "o"."ds" >= '1970-01-01') AND FALSE GROUP BY "o"."waiter_id", "o"."ds" LIMIT 0 (base.py:2260)
2025-08-11 09:22:31,961 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544" (base.py:2260)
2025-08-11 09:22:31,961 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating view '"sushi-example".sqlmesh__sushimoderate.sushimoderate__top_waiters__4200137544' (evaluator.py:1979)
2025-08-11 09:22:31,967 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE VIEW "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544" AS SELECT CAST("r"."waiter_id" AS INT) AS "waiter_id", CAST("n"."name" AS TEXT) AS "waiter_name", CAST("r"."revenue" AS DOUBLE) AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145" AS "r" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_names__1494776325" AS "n" ON "n"."id" = "r"."waiter_id" WHERE "r"."ds" = (SELECT MAX("waiter_revenue_by_day"."ds") AS "_col_0" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145" AS "waiter_revenue_by_day") ORDER BY "revenue" DESC LIMIT 10 (base.py:2260)
2025-08-11 09:22:31,970 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON VIEW "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544" IS 'View of 10 waiters with highest revenue on most recent day of data.' (base.py:2260)
2025-08-11 09:22:31,973 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544"."waiter_id" IS 'Waiter ID' (base.py:2260)
2025-08-11 09:22:31,975 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544"."waiter_name" IS 'Waiter name' (base.py:2260)
2025-08-11 09:22:31,977 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544"."revenue" IS 'Waiter revenue on most recent day of data' (base.py:2260)
2025-08-11 09:22:31,981 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage BackfillStage (evaluator.py:125)
2025-08-11 09:22:32,030 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-10 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."raw"."demographics": 292817807> (facade.py:619)
2025-08-11 09:22:32,030 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."raw"."demographics": 292817807> (interval.py:213)
2025-08-11 09:22:32,042 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-10 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."raw"."items": 4099807363> (facade.py:619)
2025-08-11 09:22:32,042 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."raw"."items": 4099807363> (interval.py:213)
2025-08-11 09:22:32,053 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-10 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."raw"."marketing": 76687353> (facade.py:619)
2025-08-11 09:22:32,053 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."raw"."marketing": 76687353> (interval.py:213)
2025-08-11 09:22:32,067 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-10 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."raw"."order_items": 2786783310> (facade.py:619)
2025-08-11 09:22:32,067 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."raw"."order_items": 2786783310> (interval.py:213)
2025-08-11 09:22:32,081 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-10 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."raw"."orders": 992661192> (facade.py:619)
2025-08-11 09:22:32,081 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."raw"."orders": 992661192> (interval.py:213)
2025-08-11 09:22:32,094 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-10 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."waiter_names": 2534315953> (facade.py:619)
2025-08-11 09:22:32,094 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."waiter_names": 2534315953> (interval.py:213)
2025-08-11 09:22:32,107 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."items": 226083708> (evaluator.py:648)
2025-08-11 09:22:32,112 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-01-01 00:00:00, 2025-08-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__items__4183556318' (evaluator.py:703)
2025-08-11 09:22:32,115 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:32,116 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" ("id", "name", "price", "ds") SELECT "id", "name", "price", "ds" FROM (SELECT CAST("items"."id" AS INT) AS "id", CAST("items"."name" AS TEXT) AS "name", CAST("items"."price" AS DOUBLE) AS "price", CAST("items"."ds" AS TEXT) AS "ds" FROM "sushi-example"."sqlmesh__raw"."raw__items__1587933360" AS "items" WHERE "items"."ds" <= '2025-08-10' AND "items"."ds" >= '2023-01-01') AS "_subquery" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:32,119 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"sushi-example"."sushimoderate"."items": 226083708> (evaluator.py:553)
2025-08-11 09:22:32,120 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" (base.py:2260)
2025-08-11 09:22:32,125 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT * FROM (SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "sushimoderate__items__4183556318" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10') AS "_q_0" WHERE ("id" IS NULL OR "name" IS NULL OR "price" IS NULL OR "ds" IS NULL) AND TRUE) AS "audit" (base.py:2260)
2025-08-11 09:22:32,126 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" (base.py:2260)
2025-08-11 09:22:32,131 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT "id" AS "id", "ds" AS "ds" FROM (SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "sushimoderate__items__4183556318" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10') AS "_q_0" WHERE TRUE GROUP BY "id", "ds" HAVING COUNT(*) > 1) AS "audit" (base.py:2260)
2025-08-11 09:22:32,135 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" (base.py:2260)
2025-08-11 09:22:32,140 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT * FROM (SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "sushimoderate__items__4183556318" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10') AS "_q_0" WHERE (NOT (LENGTH("name") > 0) OR NOT ("price" > 0)) AND TRUE) AS "audit" (base.py:2260)
2025-08-11 09:22:32,141 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-01-01 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."items": 226083708> (facade.py:619)
2025-08-11 09:22:32,141 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."items": 226083708> (interval.py:213)
2025-08-11 09:22:32,155 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."order_items": 2462776276> (evaluator.py:648)
2025-08-11 09:22:32,159 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-01-01 00:00:00, 2025-08-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__order_items__3229655664' (evaluator.py:703)
2025-08-11 09:22:32,161 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:32,162 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" ("id", "order_id", "item_id", "quantity", "ds") SELECT "id", "order_id", "item_id", "quantity", "ds" FROM (SELECT CAST("order_items"."id" AS INT) AS "id", CAST("order_items"."order_id" AS INT) AS "order_id", CAST("order_items"."item_id" AS INT) AS "item_id", CAST("order_items"."quantity" AS INT) AS "quantity", CAST("order_items"."ds" AS TEXT) AS "ds" FROM "sushi-example"."sqlmesh__raw"."raw__order_items__654969149" AS "order_items" WHERE "order_items"."ds" <= '2025-08-10' AND "order_items"."ds" >= '2023-01-01') AS "_subquery" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:32,164 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"sushi-example"."sushimoderate"."order_items": 2462776276> (evaluator.py:553)
2025-08-11 09:22:32,165 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" (base.py:2260)
2025-08-11 09:22:32,170 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT * FROM (SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "sushimoderate__order_items__3229655664" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10') AS "_q_0" WHERE ("id" IS NULL OR "order_id" IS NULL OR "item_id" IS NULL OR "quantity" IS NULL OR "ds" IS NULL) AND TRUE) AS "audit" (base.py:2260)
2025-08-11 09:22:32,171 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" (base.py:2260)
2025-08-11 09:22:32,175 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT "id" AS "id", "ds" AS "ds" FROM (SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "sushimoderate__order_items__3229655664" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10') AS "_q_0" WHERE TRUE GROUP BY "id", "ds" HAVING COUNT(*) > 1) AS "audit" (base.py:2260)
2025-08-11 09:22:32,179 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" (base.py:2260)
2025-08-11 09:22:32,184 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT * FROM (SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "sushimoderate__order_items__3229655664" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10') AS "_q_0" WHERE NOT ("quantity" > 0) AND TRUE) AS "audit" (base.py:2260)
2025-08-11 09:22:32,185 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-01-01 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."order_items": 2462776276> (facade.py:619)
2025-08-11 09:22:32,185 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."order_items": 2462776276> (interval.py:213)
2025-08-11 09:22:32,199 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."orders": 1427178259> (evaluator.py:648)
2025-08-11 09:22:32,204 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-01-01 00:00:00, 2025-08-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__orders__2553744583' (evaluator.py:703)
2025-08-11 09:22:32,205 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:32,208 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" ("id", "customer_id", "waiter_id", "start_ts", "end_ts", "ds") SELECT "id", "customer_id", "waiter_id", "start_ts", "end_ts", "ds" FROM (SELECT CAST("orders"."id" AS INT) AS "id", CAST("orders"."customer_id" AS INT) AS "customer_id", CAST("orders"."waiter_id" AS INT) AS "waiter_id", CAST("orders"."start_ts" AS TIMESTAMP) AS "start_ts", CAST("orders"."end_ts" AS TIMESTAMP) AS "end_ts", CAST("orders"."ds" AS TEXT) AS "ds" FROM "sushi-example"."sqlmesh__raw"."raw__orders__1960537533" AS "orders" WHERE "orders"."ds" <= '2025-08-10' AND "orders"."ds" >= '2023-01-01') AS "_subquery" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:32,211 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"sushi-example"."sushimoderate"."orders": 1427178259> (evaluator.py:553)
2025-08-11 09:22:32,211 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" (base.py:2260)
2025-08-11 09:22:32,217 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT * FROM (SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "sushimoderate__orders__2553744583" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10') AS "_q_0" WHERE ("id" IS NULL OR "customer_id" IS NULL OR "waiter_id" IS NULL OR "ds" IS NULL) AND TRUE) AS "audit" (base.py:2260)
2025-08-11 09:22:32,218 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" (base.py:2260)
2025-08-11 09:22:32,223 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT "id" AS "id", "ds" AS "ds" FROM (SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "sushimoderate__orders__2553744583" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10') AS "_q_0" WHERE TRUE GROUP BY "id", "ds" HAVING COUNT(*) > 1) AS "audit" (base.py:2260)
2025-08-11 09:22:32,227 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-01-01 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."orders": 1427178259> (facade.py:619)
2025-08-11 09:22:32,227 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."orders": 1427178259> (interval.py:213)
2025-08-11 09:22:32,239 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_by_day": 1206094937> (evaluator.py:648)
2025-08-11 09:22:32,250 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-01 00:00:00, 2025-08-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_by_day__2161423016' (evaluator.py:703)
2025-08-11 09:22:32,251 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_by_day__2161423016" WHERE "ds" BETWEEN '2023-10-01' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:32,254 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_by_day__2161423016" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total", "oi"."ds" AS "ds" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" <= '2025-08-10' AND "oi"."ds" >= '2023-10-01' GROUP BY "oi"."order_id", "oi"."ds") SELECT "customer_id", "revenue", "ds" FROM (SELECT CAST("o"."customer_id" AS INT) AS "customer_id", CAST(SUM("ot"."total") AS DOUBLE) AS "revenue", CAST("o"."ds" AS TEXT) AS "ds" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."ds" = "ot"."ds" AND "o"."id" = "ot"."order_id" WHERE "o"."ds" <= '2025-08-10' AND "o"."ds" >= '2023-10-01' GROUP BY "o"."customer_id", "o"."ds") AS "_subquery" WHERE "ds" BETWEEN '2023-10-01' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:32,265 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-01 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_by_day": 1206094937> (facade.py:619)
2025-08-11 09:22:32,265 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_by_day": 1206094937> (interval.py:213)
2025-08-11 09:22:32,278 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,292 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-01 00:00:00, 2023-10-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,293 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-01' AND '2023-10-01' (base.py:2260)
2025-08-11 09:22:32,296 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-09-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-01' AND '2023-10-01' (base.py:2260)
2025-08-11 09:22:32,301 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-01 00:00:00, 2023-10-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,301 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,313 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customers": 1577372822> (evaluator.py:648)
2025-08-11 09:22:32,319 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-01-01 00:00:00, 2025-08-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customers__1460721243' (evaluator.py:703)
2025-08-11 09:22:32,320 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-11 09:22:32,322 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-11 09:22:32,325 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243" AS SELECT CAST("customer_id" AS INT) AS "customer_id", CAST("status" AS TEXT) AS "status", CAST("zip" AS TEXT) AS "zip" FROM (SELECT DISTINCT CAST("o"."customer_id" AS INT) AS "customer_id", CAST(COALESCE("m"."status", 'UNKNOWN') AS TEXT) AS "status", CAST("d"."zip" AS TEXT) AS "zip" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "sushi-example"."sqlmesh__raw"."raw__marketing__2281409975" AS "m" ON "m"."customer_id" = "o"."customer_id" LEFT JOIN "sushi-example"."sqlmesh__raw"."raw__demographics__3399964752" AS "d" ON "d"."customer_id" = "o"."customer_id") AS "_subquery" (base.py:2260)
2025-08-11 09:22:32,333 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243" IS 'Table of customer data for customers who have ever placed an order.' (base.py:2260)
2025-08-11 09:22:32,336 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243"."customer_id" IS 'Customer ID' (base.py:2260)
2025-08-11 09:22:32,339 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243"."status" IS 'Customer marketing status' (base.py:2260)
2025-08-11 09:22:32,341 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243"."zip" IS 'Customer ZIP code' (base.py:2260)
2025-08-11 09:22:32,343 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"sushi-example"."sushimoderate"."customers": 1577372822> (evaluator.py:553)
2025-08-11 09:22:32,344 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243" (base.py:2260)
2025-08-11 09:22:32,347 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243" AS "sushimoderate__customers__1460721243" WHERE "customer_id" IS NULL AND TRUE) AS "audit" (base.py:2260)
2025-08-11 09:22:32,348 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243" (base.py:2260)
2025-08-11 09:22:32,353 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT * FROM (SELECT ROW_NUMBER() OVER (PARTITION BY "customer_id" ORDER BY "customer_id" NULLS FIRST) AS "rank_customer_id" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243" AS "sushimoderate__customers__1460721243" WHERE TRUE) AS "_q_0" WHERE "rank_customer_id" > 1) AS "audit" (base.py:2260)
2025-08-11 09:22:32,360 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-01-01 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customers": 1577372822> (facade.py:619)
2025-08-11 09:22:32,360 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customers": 1577372822> (interval.py:213)
2025-08-11 09:22:32,374 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."waiter_revenue_by_day": 1729487303> (evaluator.py:648)
2025-08-11 09:22:32,381 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-01-01 00:00:00, 2025-08-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__waiter_revenue_by_day__2502736145' (evaluator.py:703)
2025-08-11 09:22:32,382 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:32,384 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145" ("waiter_id", "revenue", "ds") SELECT "waiter_id", "revenue", "ds" FROM (SELECT CAST("o"."waiter_id" AS INT) AS "waiter_id", CAST(SUM("oi"."quantity" * "i"."price") AS DOUBLE) AS "revenue", CAST("o"."ds" AS TEXT) AS "ds" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" ON "o"."ds" = "oi"."ds" AND "o"."id" = "oi"."order_id" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "o"."ds" <= '2025-08-10' AND "o"."ds" >= '2023-01-01' GROUP BY "o"."waiter_id", "o"."ds") AS "_subquery" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:32,391 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"sushi-example"."sushimoderate"."waiter_revenue_by_day": 1729487303> (evaluator.py:553)
2025-08-11 09:22:32,391 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145" (base.py:2260)
2025-08-11 09:22:32,396 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT COUNT(*) FROM (SELECT 1 FROM (SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145" AS "sushimoderate__waiter_revenue_by_day__2502736145" WHERE "ds" BETWEEN '2023-01-01' AND '2025-08-10') AS "_q_0" WHERE TRUE LIMIT 0 + 1) AS "_q_1" HAVING COUNT(*) <= 0) AS "audit" (base.py:2260)
2025-08-11 09:22:32,397 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-01-01 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."waiter_revenue_by_day": 1729487303> (facade.py:619)
2025-08-11 09:22:32,397 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."waiter_revenue_by_day": 1729487303> (interval.py:213)
2025-08-11 09:22:32,411 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,426 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-02 00:00:00, 2023-10-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,429 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-02' AND '2023-10-02' (base.py:2260)
2025-08-11 09:22:32,433 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-02' AND '2023-10-02' (base.py:2260)
2025-08-11 09:22:32,438 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-02 00:00:00, 2023-10-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,438 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,450 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."top_waiters": 4156350067> (evaluator.py:648)
2025-08-11 09:22:32,456 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-01-01 00:00:00, 2025-08-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__top_waiters__4200137544' (evaluator.py:703)
2025-08-11 09:22:32,456 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Replacing view '"sushi-example".sqlmesh__sushimoderate.sushimoderate__top_waiters__4200137544' (evaluator.py:1933)
2025-08-11 09:22:32,457 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544" ("waiter_id", "waiter_name", "revenue") AS SELECT CAST("r"."waiter_id" AS INT) AS "waiter_id", CAST("n"."name" AS TEXT) AS "waiter_name", CAST("r"."revenue" AS DOUBLE) AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145" AS "r" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_names__1494776325" AS "n" ON "n"."id" = "r"."waiter_id" WHERE "r"."ds" = (SELECT MAX("waiter_revenue_by_day"."ds") AS "_col_0" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145" AS "waiter_revenue_by_day") ORDER BY "revenue" DESC LIMIT 10 (base.py:2260)
2025-08-11 09:22:32,460 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON VIEW "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544" IS 'View of 10 waiters with highest revenue on most recent day of data.' (base.py:2260)
2025-08-11 09:22:32,463 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544"."waiter_id" IS 'Waiter ID' (base.py:2260)
2025-08-11 09:22:32,466 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544"."waiter_name" IS 'Waiter name' (base.py:2260)
2025-08-11 09:22:32,468 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544"."revenue" IS 'Waiter revenue on most recent day of data' (base.py:2260)
2025-08-11 09:22:32,470 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"sushi-example"."sushimoderate"."top_waiters": 4156350067> (evaluator.py:553)
2025-08-11 09:22:32,471 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544" (base.py:2260)
2025-08-11 09:22:32,477 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ SELECT COUNT(*) FROM (SELECT * FROM (SELECT ROW_NUMBER() OVER (PARTITION BY "waiter_id" ORDER BY "waiter_id" NULLS FIRST) AS "rank_waiter_id" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544" AS "sushimoderate__top_waiters__4200137544" WHERE TRUE) AS "_q_0" WHERE "rank_waiter_id" > 1) AS "audit" (base.py:2260)
2025-08-11 09:22:32,483 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-01-01 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."top_waiters": 4156350067> (facade.py:619)
2025-08-11 09:22:32,483 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."top_waiters": 4156350067> (interval.py:213)
2025-08-11 09:22:32,497 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,511 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-03 00:00:00, 2023-10-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,512 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-03' AND '2023-10-03' (base.py:2260)
2025-08-11 09:22:32,515 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-03' AND '2023-10-03' (base.py:2260)
2025-08-11 09:22:32,519 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-03 00:00:00, 2023-10-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,520 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,534 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,551 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-04 00:00:00, 2023-10-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,553 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-04' AND '2023-10-04' (base.py:2260)
2025-08-11 09:22:32,555 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-04' AND '2023-10-04' (base.py:2260)
2025-08-11 09:22:32,561 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-04 00:00:00, 2023-10-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,561 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,575 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,589 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-05 00:00:00, 2023-10-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,590 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-05' AND '2023-10-05' (base.py:2260)
2025-08-11 09:22:32,593 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-05' AND '2023-10-05' (base.py:2260)
2025-08-11 09:22:32,597 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-05 00:00:00, 2023-10-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,598 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,614 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,630 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-06 00:00:00, 2023-10-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,631 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-06' AND '2023-10-06' (base.py:2260)
2025-08-11 09:22:32,635 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-06' AND '2023-10-06' (base.py:2260)
2025-08-11 09:22:32,639 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-06 00:00:00, 2023-10-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,639 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,652 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,666 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-07 00:00:00, 2023-10-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,667 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-07' AND '2023-10-07' (base.py:2260)
2025-08-11 09:22:32,670 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-07' AND '2023-10-07' (base.py:2260)
2025-08-11 09:22:32,675 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-07 00:00:00, 2023-10-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,675 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,688 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,702 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-08 00:00:00, 2023-10-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,704 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-08' AND '2023-10-08' (base.py:2260)
2025-08-11 09:22:32,708 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-08' AND '2023-10-08' (base.py:2260)
2025-08-11 09:22:32,711 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-08 00:00:00, 2023-10-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,711 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,726 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,741 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-09 00:00:00, 2023-10-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,742 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-09' AND '2023-10-09' (base.py:2260)
2025-08-11 09:22:32,746 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-09' AND '2023-10-09' (base.py:2260)
2025-08-11 09:22:32,750 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-09 00:00:00, 2023-10-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,750 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,762 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,777 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-10 00:00:00, 2023-10-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,778 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-10' AND '2023-10-10' (base.py:2260)
2025-08-11 09:22:32,781 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-10' AND '2023-10-10' (base.py:2260)
2025-08-11 09:22:32,787 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-10 00:00:00, 2023-10-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,787 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,800 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,815 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-11 00:00:00, 2023-10-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,816 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-11' AND '2023-10-11' (base.py:2260)
2025-08-11 09:22:32,819 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-11' AND '2023-10-11' (base.py:2260)
2025-08-11 09:22:32,824 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-11 00:00:00, 2023-10-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,824 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,837 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,852 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-12 00:00:00, 2023-10-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,853 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-12' AND '2023-10-12' (base.py:2260)
2025-08-11 09:22:32,855 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-12' AND '2023-10-12' (base.py:2260)
2025-08-11 09:22:32,859 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-12 00:00:00, 2023-10-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,859 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,872 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,888 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-13 00:00:00, 2023-10-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,890 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-13' AND '2023-10-13' (base.py:2260)
2025-08-11 09:22:32,894 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-13' AND '2023-10-13' (base.py:2260)
2025-08-11 09:22:32,899 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-13 00:00:00, 2023-10-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,899 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,913 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,928 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-14 00:00:00, 2023-10-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,929 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-14' AND '2023-10-14' (base.py:2260)
2025-08-11 09:22:32,932 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-14' AND '2023-10-14' (base.py:2260)
2025-08-11 09:22:32,938 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-14 00:00:00, 2023-10-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,938 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,952 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:32,966 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-15 00:00:00, 2023-10-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:32,968 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-15' AND '2023-10-15' (base.py:2260)
2025-08-11 09:22:32,971 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-15' AND '2023-10-15' (base.py:2260)
2025-08-11 09:22:32,976 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-15 00:00:00, 2023-10-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:32,976 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:32,990 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,005 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-16 00:00:00, 2023-10-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,008 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-16' AND '2023-10-16' (base.py:2260)
2025-08-11 09:22:33,011 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-16' AND '2023-10-16' (base.py:2260)
2025-08-11 09:22:33,017 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-16 00:00:00, 2023-10-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,017 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,085 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,099 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-17 00:00:00, 2023-10-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,100 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-17' AND '2023-10-17' (base.py:2260)
2025-08-11 09:22:33,103 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-17' AND '2023-10-17' (base.py:2260)
2025-08-11 09:22:33,108 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-17 00:00:00, 2023-10-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,108 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,122 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,137 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-18 00:00:00, 2023-10-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,137 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-18' AND '2023-10-18' (base.py:2260)
2025-08-11 09:22:33,141 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-18' AND '2023-10-18' (base.py:2260)
2025-08-11 09:22:33,145 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-18 00:00:00, 2023-10-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,145 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,159 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,174 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-19 00:00:00, 2023-10-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,175 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-19' AND '2023-10-19' (base.py:2260)
2025-08-11 09:22:33,178 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-19' AND '2023-10-19' (base.py:2260)
2025-08-11 09:22:33,184 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-19 00:00:00, 2023-10-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,184 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,197 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,211 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-20 00:00:00, 2023-10-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,212 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-20' AND '2023-10-20' (base.py:2260)
2025-08-11 09:22:33,215 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-20' AND '2023-10-20' (base.py:2260)
2025-08-11 09:22:33,220 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-20 00:00:00, 2023-10-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,220 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,233 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,248 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-21 00:00:00, 2023-10-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,249 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-21' AND '2023-10-21' (base.py:2260)
2025-08-11 09:22:33,253 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-21' AND '2023-10-21' (base.py:2260)
2025-08-11 09:22:33,257 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-21 00:00:00, 2023-10-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,258 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,272 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,287 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-22 00:00:00, 2023-10-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,289 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-22' AND '2023-10-22' (base.py:2260)
2025-08-11 09:22:33,292 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-22' AND '2023-10-22' (base.py:2260)
2025-08-11 09:22:33,296 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-22 00:00:00, 2023-10-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,296 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,307 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,320 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-23 00:00:00, 2023-10-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,321 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-23' AND '2023-10-23' (base.py:2260)
2025-08-11 09:22:33,325 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-23' AND '2023-10-23' (base.py:2260)
2025-08-11 09:22:33,331 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-23 00:00:00, 2023-10-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,331 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,343 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,359 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-24 00:00:00, 2023-10-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,360 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-24' AND '2023-10-24' (base.py:2260)
2025-08-11 09:22:33,363 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-24' AND '2023-10-24' (base.py:2260)
2025-08-11 09:22:33,368 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-24 00:00:00, 2023-10-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,368 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,381 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,397 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-25 00:00:00, 2023-10-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,398 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-25' AND '2023-10-25' (base.py:2260)
2025-08-11 09:22:33,400 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-25' AND '2023-10-25' (base.py:2260)
2025-08-11 09:22:33,404 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-25 00:00:00, 2023-10-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,404 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,418 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,433 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-26 00:00:00, 2023-10-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,434 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-26' AND '2023-10-26' (base.py:2260)
2025-08-11 09:22:33,438 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-26' AND '2023-10-26' (base.py:2260)
2025-08-11 09:22:33,443 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-26 00:00:00, 2023-10-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,444 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,456 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,471 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-27 00:00:00, 2023-10-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,473 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-27' AND '2023-10-27' (base.py:2260)
2025-08-11 09:22:33,475 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-27' AND '2023-10-27' (base.py:2260)
2025-08-11 09:22:33,479 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-27 00:00:00, 2023-10-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,479 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,493 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,506 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-28 00:00:00, 2023-10-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,508 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-28' AND '2023-10-28' (base.py:2260)
2025-08-11 09:22:33,511 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-28' AND '2023-10-28' (base.py:2260)
2025-08-11 09:22:33,515 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-28 00:00:00, 2023-10-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,515 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,529 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,544 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-29 00:00:00, 2023-10-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,547 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-29' AND '2023-10-29' (base.py:2260)
2025-08-11 09:22:33,550 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-29' AND '2023-10-29' (base.py:2260)
2025-08-11 09:22:33,555 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-29 00:00:00, 2023-10-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,556 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,570 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,585 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-30 00:00:00, 2023-10-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,586 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-30' AND '2023-10-30' (base.py:2260)
2025-08-11 09:22:33,590 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-30' AND '2023-10-30' (base.py:2260)
2025-08-11 09:22:33,594 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-30 00:00:00, 2023-10-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,594 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,607 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,622 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-10-31 00:00:00, 2023-11-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,623 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-10-31' AND '2023-10-31' (base.py:2260)
2025-08-11 09:22:33,626 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-10-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-10-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-10-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-10-31' AND '2023-10-31' (base.py:2260)
2025-08-11 09:22:33,631 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-10-31 00:00:00, 2023-11-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,631 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,644 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,659 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-01 00:00:00, 2023-11-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,663 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-01' AND '2023-11-01' (base.py:2260)
2025-08-11 09:22:33,666 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-10-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-01' AND '2023-11-01' (base.py:2260)
2025-08-11 09:22:33,670 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-01 00:00:00, 2023-11-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,670 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,683 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,698 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-02 00:00:00, 2023-11-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,700 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-02' AND '2023-11-02' (base.py:2260)
2025-08-11 09:22:33,703 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-02' AND '2023-11-02' (base.py:2260)
2025-08-11 09:22:33,707 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-02 00:00:00, 2023-11-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,708 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,721 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,735 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-03 00:00:00, 2023-11-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,737 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-03' AND '2023-11-03' (base.py:2260)
2025-08-11 09:22:33,740 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-03' AND '2023-11-03' (base.py:2260)
2025-08-11 09:22:33,745 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-03 00:00:00, 2023-11-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,745 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,757 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,772 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-04 00:00:00, 2023-11-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,773 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-04' AND '2023-11-04' (base.py:2260)
2025-08-11 09:22:33,776 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-04' AND '2023-11-04' (base.py:2260)
2025-08-11 09:22:33,783 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-04 00:00:00, 2023-11-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,783 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,799 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,814 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-05 00:00:00, 2023-11-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,815 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-05' AND '2023-11-05' (base.py:2260)
2025-08-11 09:22:33,818 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-05' AND '2023-11-05' (base.py:2260)
2025-08-11 09:22:33,822 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-05 00:00:00, 2023-11-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,822 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,836 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,850 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-06 00:00:00, 2023-11-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,851 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-06' AND '2023-11-06' (base.py:2260)
2025-08-11 09:22:33,854 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-06' AND '2023-11-06' (base.py:2260)
2025-08-11 09:22:33,858 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-06 00:00:00, 2023-11-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,858 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,872 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,888 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-07 00:00:00, 2023-11-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,891 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-07' AND '2023-11-07' (base.py:2260)
2025-08-11 09:22:33,894 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-07' AND '2023-11-07' (base.py:2260)
2025-08-11 09:22:33,899 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-07 00:00:00, 2023-11-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,899 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,913 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,928 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-08 00:00:00, 2023-11-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,930 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-08' AND '2023-11-08' (base.py:2260)
2025-08-11 09:22:33,932 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-08' AND '2023-11-08' (base.py:2260)
2025-08-11 09:22:33,937 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-08 00:00:00, 2023-11-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,937 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,950 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:33,965 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-09 00:00:00, 2023-11-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:33,967 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-09' AND '2023-11-09' (base.py:2260)
2025-08-11 09:22:33,971 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-09' AND '2023-11-09' (base.py:2260)
2025-08-11 09:22:33,975 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-09 00:00:00, 2023-11-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:33,975 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:33,990 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,004 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-10 00:00:00, 2023-11-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,005 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-10' AND '2023-11-10' (base.py:2260)
2025-08-11 09:22:34,010 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-10' AND '2023-11-10' (base.py:2260)
2025-08-11 09:22:34,014 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-10 00:00:00, 2023-11-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,014 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,028 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,043 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-11 00:00:00, 2023-11-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,044 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-11' AND '2023-11-11' (base.py:2260)
2025-08-11 09:22:34,046 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-11' AND '2023-11-11' (base.py:2260)
2025-08-11 09:22:34,051 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-11 00:00:00, 2023-11-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,051 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,063 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,078 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-12 00:00:00, 2023-11-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,079 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-12' AND '2023-11-12' (base.py:2260)
2025-08-11 09:22:34,082 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-12' AND '2023-11-12' (base.py:2260)
2025-08-11 09:22:34,086 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-12 00:00:00, 2023-11-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,086 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,099 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,114 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-13 00:00:00, 2023-11-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,115 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-13' AND '2023-11-13' (base.py:2260)
2025-08-11 09:22:34,119 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-13' AND '2023-11-13' (base.py:2260)
2025-08-11 09:22:34,124 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-13 00:00:00, 2023-11-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,124 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,138 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,154 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-14 00:00:00, 2023-11-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,155 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-14' AND '2023-11-14' (base.py:2260)
2025-08-11 09:22:34,159 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-14' AND '2023-11-14' (base.py:2260)
2025-08-11 09:22:34,162 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-14 00:00:00, 2023-11-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,162 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,176 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,190 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-15 00:00:00, 2023-11-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,191 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-15' AND '2023-11-15' (base.py:2260)
2025-08-11 09:22:34,195 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-15' AND '2023-11-15' (base.py:2260)
2025-08-11 09:22:34,199 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-15 00:00:00, 2023-11-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,199 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,213 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,228 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-16 00:00:00, 2023-11-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,229 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-16' AND '2023-11-16' (base.py:2260)
2025-08-11 09:22:34,234 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-16' AND '2023-11-16' (base.py:2260)
2025-08-11 09:22:34,238 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-16 00:00:00, 2023-11-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,238 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,252 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,265 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-17 00:00:00, 2023-11-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,267 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-17' AND '2023-11-17' (base.py:2260)
2025-08-11 09:22:34,271 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-17' AND '2023-11-17' (base.py:2260)
2025-08-11 09:22:34,275 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-17 00:00:00, 2023-11-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,276 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,289 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,304 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-18 00:00:00, 2023-11-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,305 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-18' AND '2023-11-18' (base.py:2260)
2025-08-11 09:22:34,309 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-18' AND '2023-11-18' (base.py:2260)
2025-08-11 09:22:34,313 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-18 00:00:00, 2023-11-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,313 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,326 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,342 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-19 00:00:00, 2023-11-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,343 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-19' AND '2023-11-19' (base.py:2260)
2025-08-11 09:22:34,345 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-19' AND '2023-11-19' (base.py:2260)
2025-08-11 09:22:34,350 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-19 00:00:00, 2023-11-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,350 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,364 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,381 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-20 00:00:00, 2023-11-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,382 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-20' AND '2023-11-20' (base.py:2260)
2025-08-11 09:22:34,385 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-20' AND '2023-11-20' (base.py:2260)
2025-08-11 09:22:34,389 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-20 00:00:00, 2023-11-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,389 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,403 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,417 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-21 00:00:00, 2023-11-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,418 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-21' AND '2023-11-21' (base.py:2260)
2025-08-11 09:22:34,421 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-21' AND '2023-11-21' (base.py:2260)
2025-08-11 09:22:34,426 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-21 00:00:00, 2023-11-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,426 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,440 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,455 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-22 00:00:00, 2023-11-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,458 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-22' AND '2023-11-22' (base.py:2260)
2025-08-11 09:22:34,462 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-22' AND '2023-11-22' (base.py:2260)
2025-08-11 09:22:34,466 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-22 00:00:00, 2023-11-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,467 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,481 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,495 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-23 00:00:00, 2023-11-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,497 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-23' AND '2023-11-23' (base.py:2260)
2025-08-11 09:22:34,499 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-23' AND '2023-11-23' (base.py:2260)
2025-08-11 09:22:34,504 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-23 00:00:00, 2023-11-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,504 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,517 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,532 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-24 00:00:00, 2023-11-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,533 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-24' AND '2023-11-24' (base.py:2260)
2025-08-11 09:22:34,537 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-24' AND '2023-11-24' (base.py:2260)
2025-08-11 09:22:34,543 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-24 00:00:00, 2023-11-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,543 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,557 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,572 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-25 00:00:00, 2023-11-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,573 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-25' AND '2023-11-25' (base.py:2260)
2025-08-11 09:22:34,577 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-25' AND '2023-11-25' (base.py:2260)
2025-08-11 09:22:34,582 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-25 00:00:00, 2023-11-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,582 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,595 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,611 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-26 00:00:00, 2023-11-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,613 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-26' AND '2023-11-26' (base.py:2260)
2025-08-11 09:22:34,616 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-26' AND '2023-11-26' (base.py:2260)
2025-08-11 09:22:34,621 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-26 00:00:00, 2023-11-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,621 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,634 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,649 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-27 00:00:00, 2023-11-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,651 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-27' AND '2023-11-27' (base.py:2260)
2025-08-11 09:22:34,653 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-27' AND '2023-11-27' (base.py:2260)
2025-08-11 09:22:34,658 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-27 00:00:00, 2023-11-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,658 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,671 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,685 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-28 00:00:00, 2023-11-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,687 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-28' AND '2023-11-28' (base.py:2260)
2025-08-11 09:22:34,691 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-28' AND '2023-11-28' (base.py:2260)
2025-08-11 09:22:34,695 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-28 00:00:00, 2023-11-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,696 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,710 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,724 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-29 00:00:00, 2023-11-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,725 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-29' AND '2023-11-29' (base.py:2260)
2025-08-11 09:22:34,728 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-29' AND '2023-11-29' (base.py:2260)
2025-08-11 09:22:34,732 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-29 00:00:00, 2023-11-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,732 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,744 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,759 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-11-30 00:00:00, 2023-12-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,760 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-11-30' AND '2023-11-30' (base.py:2260)
2025-08-11 09:22:34,763 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-11-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-11-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-11-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-11-30' AND '2023-11-30' (base.py:2260)
2025-08-11 09:22:34,768 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-11-30 00:00:00, 2023-12-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,768 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,782 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,797 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-01 00:00:00, 2023-12-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,798 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-01' AND '2023-12-01' (base.py:2260)
2025-08-11 09:22:34,803 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-11-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-01' AND '2023-12-01' (base.py:2260)
2025-08-11 09:22:34,807 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-01 00:00:00, 2023-12-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,808 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,819 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,834 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-02 00:00:00, 2023-12-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,835 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-02' AND '2023-12-02' (base.py:2260)
2025-08-11 09:22:34,838 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-02' AND '2023-12-02' (base.py:2260)
2025-08-11 09:22:34,842 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-02 00:00:00, 2023-12-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,842 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,856 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,869 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-03 00:00:00, 2023-12-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,871 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-03' AND '2023-12-03' (base.py:2260)
2025-08-11 09:22:34,936 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-03' AND '2023-12-03' (base.py:2260)
2025-08-11 09:22:34,941 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-03 00:00:00, 2023-12-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,941 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,955 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:34,969 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-04 00:00:00, 2023-12-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:34,970 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-04' AND '2023-12-04' (base.py:2260)
2025-08-11 09:22:34,973 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-04' AND '2023-12-04' (base.py:2260)
2025-08-11 09:22:34,978 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-04 00:00:00, 2023-12-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:34,978 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:34,993 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,005 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-05 00:00:00, 2023-12-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,007 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-05' AND '2023-12-05' (base.py:2260)
2025-08-11 09:22:35,010 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-05' AND '2023-12-05' (base.py:2260)
2025-08-11 09:22:35,014 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-05 00:00:00, 2023-12-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,014 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,028 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,042 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-06 00:00:00, 2023-12-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,045 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-06' AND '2023-12-06' (base.py:2260)
2025-08-11 09:22:35,048 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-06' AND '2023-12-06' (base.py:2260)
2025-08-11 09:22:35,054 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-06 00:00:00, 2023-12-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,054 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,066 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,082 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-07 00:00:00, 2023-12-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,083 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-07' AND '2023-12-07' (base.py:2260)
2025-08-11 09:22:35,085 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-07' AND '2023-12-07' (base.py:2260)
2025-08-11 09:22:35,089 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-07 00:00:00, 2023-12-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,089 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,104 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,118 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-08 00:00:00, 2023-12-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,119 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-08' AND '2023-12-08' (base.py:2260)
2025-08-11 09:22:35,122 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-08' AND '2023-12-08' (base.py:2260)
2025-08-11 09:22:35,126 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-08 00:00:00, 2023-12-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,126 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,140 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,154 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-09 00:00:00, 2023-12-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,155 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-09' AND '2023-12-09' (base.py:2260)
2025-08-11 09:22:35,159 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-09' AND '2023-12-09' (base.py:2260)
2025-08-11 09:22:35,163 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-09 00:00:00, 2023-12-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,163 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,176 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,191 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-10 00:00:00, 2023-12-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,191 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-10' AND '2023-12-10' (base.py:2260)
2025-08-11 09:22:35,195 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-10' AND '2023-12-10' (base.py:2260)
2025-08-11 09:22:35,198 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-10 00:00:00, 2023-12-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,200 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,214 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,229 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-11 00:00:00, 2023-12-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,230 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-11' AND '2023-12-11' (base.py:2260)
2025-08-11 09:22:35,233 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-11' AND '2023-12-11' (base.py:2260)
2025-08-11 09:22:35,238 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-11 00:00:00, 2023-12-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,238 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,250 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,265 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-12 00:00:00, 2023-12-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,266 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-12' AND '2023-12-12' (base.py:2260)
2025-08-11 09:22:35,269 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-12' AND '2023-12-12' (base.py:2260)
2025-08-11 09:22:35,276 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-12 00:00:00, 2023-12-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,276 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,289 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,305 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-13 00:00:00, 2023-12-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,306 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-13' AND '2023-12-13' (base.py:2260)
2025-08-11 09:22:35,308 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-13' AND '2023-12-13' (base.py:2260)
2025-08-11 09:22:35,313 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-13 00:00:00, 2023-12-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,313 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,327 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,344 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-14 00:00:00, 2023-12-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,346 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-14' AND '2023-12-14' (base.py:2260)
2025-08-11 09:22:35,348 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-14' AND '2023-12-14' (base.py:2260)
2025-08-11 09:22:35,352 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-14 00:00:00, 2023-12-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,352 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,364 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,378 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-15 00:00:00, 2023-12-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,379 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-15' AND '2023-12-15' (base.py:2260)
2025-08-11 09:22:35,384 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-15' AND '2023-12-15' (base.py:2260)
2025-08-11 09:22:35,388 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-15 00:00:00, 2023-12-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,388 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,403 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,417 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-16 00:00:00, 2023-12-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,418 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-16' AND '2023-12-16' (base.py:2260)
2025-08-11 09:22:35,421 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-16' AND '2023-12-16' (base.py:2260)
2025-08-11 09:22:35,425 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-16 00:00:00, 2023-12-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,426 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,441 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,456 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-17 00:00:00, 2023-12-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,457 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-17' AND '2023-12-17' (base.py:2260)
2025-08-11 09:22:35,460 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-17' AND '2023-12-17' (base.py:2260)
2025-08-11 09:22:35,464 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-17 00:00:00, 2023-12-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,464 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,477 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,492 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-18 00:00:00, 2023-12-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,494 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-18' AND '2023-12-18' (base.py:2260)
2025-08-11 09:22:35,498 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-18' AND '2023-12-18' (base.py:2260)
2025-08-11 09:22:35,503 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-18 00:00:00, 2023-12-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,503 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,516 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,533 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-19 00:00:00, 2023-12-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,534 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-19' AND '2023-12-19' (base.py:2260)
2025-08-11 09:22:35,537 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-19' AND '2023-12-19' (base.py:2260)
2025-08-11 09:22:35,541 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-19 00:00:00, 2023-12-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,541 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,554 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,570 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-20 00:00:00, 2023-12-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,571 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-20' AND '2023-12-20' (base.py:2260)
2025-08-11 09:22:35,575 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-20' AND '2023-12-20' (base.py:2260)
2025-08-11 09:22:35,579 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-20 00:00:00, 2023-12-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,579 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,592 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,606 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-21 00:00:00, 2023-12-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,608 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-21' AND '2023-12-21' (base.py:2260)
2025-08-11 09:22:35,611 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-21' AND '2023-12-21' (base.py:2260)
2025-08-11 09:22:35,617 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-21 00:00:00, 2023-12-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,617 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,633 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,648 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-22 00:00:00, 2023-12-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,649 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-22' AND '2023-12-22' (base.py:2260)
2025-08-11 09:22:35,653 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-22' AND '2023-12-22' (base.py:2260)
2025-08-11 09:22:35,658 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-22 00:00:00, 2023-12-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,658 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,673 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,686 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-23 00:00:00, 2023-12-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,687 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-23' AND '2023-12-23' (base.py:2260)
2025-08-11 09:22:35,690 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-23' AND '2023-12-23' (base.py:2260)
2025-08-11 09:22:35,695 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-23 00:00:00, 2023-12-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,695 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,710 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,724 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-24 00:00:00, 2023-12-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,727 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-24' AND '2023-12-24' (base.py:2260)
2025-08-11 09:22:35,730 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-24' AND '2023-12-24' (base.py:2260)
2025-08-11 09:22:35,735 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-24 00:00:00, 2023-12-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,736 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,751 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,768 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-25 00:00:00, 2023-12-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,769 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-25' AND '2023-12-25' (base.py:2260)
2025-08-11 09:22:35,772 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-25' AND '2023-12-25' (base.py:2260)
2025-08-11 09:22:35,776 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-25 00:00:00, 2023-12-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,776 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,790 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,806 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-26 00:00:00, 2023-12-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,807 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-26' AND '2023-12-26' (base.py:2260)
2025-08-11 09:22:35,811 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-26' AND '2023-12-26' (base.py:2260)
2025-08-11 09:22:35,817 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-26 00:00:00, 2023-12-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,817 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,830 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,845 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-27 00:00:00, 2023-12-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,848 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-27' AND '2023-12-27' (base.py:2260)
2025-08-11 09:22:35,851 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-27' AND '2023-12-27' (base.py:2260)
2025-08-11 09:22:35,854 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-27 00:00:00, 2023-12-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,854 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,870 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,885 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-28 00:00:00, 2023-12-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,887 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-28' AND '2023-12-28' (base.py:2260)
2025-08-11 09:22:35,892 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-28' AND '2023-12-28' (base.py:2260)
2025-08-11 09:22:35,896 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-28 00:00:00, 2023-12-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,896 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,908 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,925 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-29 00:00:00, 2023-12-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,926 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-29' AND '2023-12-29' (base.py:2260)
2025-08-11 09:22:35,930 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-29' AND '2023-12-29' (base.py:2260)
2025-08-11 09:22:35,935 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-29 00:00:00, 2023-12-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,935 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,952 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:35,965 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-30 00:00:00, 2023-12-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:35,966 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-30' AND '2023-12-30' (base.py:2260)
2025-08-11 09:22:35,970 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-30' AND '2023-12-30' (base.py:2260)
2025-08-11 09:22:35,974 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-30 00:00:00, 2023-12-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:35,974 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:35,988 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,003 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2023-12-31 00:00:00, 2024-01-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,004 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2023-12-31' AND '2023-12-31' (base.py:2260)
2025-08-11 09:22:36,008 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2023-12-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2023-12-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2023-12-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2023-12-31' AND '2023-12-31' (base.py:2260)
2025-08-11 09:22:36,012 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2023-12-31 00:00:00, 2024-01-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,012 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,029 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,044 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-01 00:00:00, 2024-01-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,045 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-01' AND '2024-01-01' (base.py:2260)
2025-08-11 09:22:36,048 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2023-12-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-01' AND '2024-01-01' (base.py:2260)
2025-08-11 09:22:36,052 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-01 00:00:00, 2024-01-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,052 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,066 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,081 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-02 00:00:00, 2024-01-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,083 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-02' AND '2024-01-02' (base.py:2260)
2025-08-11 09:22:36,089 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-02' AND '2024-01-02' (base.py:2260)
2025-08-11 09:22:36,093 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-02 00:00:00, 2024-01-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,093 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,105 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,119 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-03 00:00:00, 2024-01-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,121 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-03' AND '2024-01-03' (base.py:2260)
2025-08-11 09:22:36,126 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-03' AND '2024-01-03' (base.py:2260)
2025-08-11 09:22:36,130 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-03 00:00:00, 2024-01-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,130 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,143 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,157 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-04 00:00:00, 2024-01-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,158 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-04' AND '2024-01-04' (base.py:2260)
2025-08-11 09:22:36,161 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-04' AND '2024-01-04' (base.py:2260)
2025-08-11 09:22:36,166 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-04 00:00:00, 2024-01-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,166 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,181 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,196 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-05 00:00:00, 2024-01-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,197 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-05' AND '2024-01-05' (base.py:2260)
2025-08-11 09:22:36,200 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-05' AND '2024-01-05' (base.py:2260)
2025-08-11 09:22:36,206 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-05 00:00:00, 2024-01-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,206 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,220 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,236 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-06 00:00:00, 2024-01-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,238 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-06' AND '2024-01-06' (base.py:2260)
2025-08-11 09:22:36,240 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-06' AND '2024-01-06' (base.py:2260)
2025-08-11 09:22:36,245 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-06 00:00:00, 2024-01-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,245 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,258 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,273 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-07 00:00:00, 2024-01-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,275 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-07' AND '2024-01-07' (base.py:2260)
2025-08-11 09:22:36,277 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-07' AND '2024-01-07' (base.py:2260)
2025-08-11 09:22:36,281 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-07 00:00:00, 2024-01-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,281 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,294 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,311 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-08 00:00:00, 2024-01-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,314 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-08' AND '2024-01-08' (base.py:2260)
2025-08-11 09:22:36,318 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-08' AND '2024-01-08' (base.py:2260)
2025-08-11 09:22:36,324 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-08 00:00:00, 2024-01-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,324 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,337 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,351 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-09 00:00:00, 2024-01-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,352 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-09' AND '2024-01-09' (base.py:2260)
2025-08-11 09:22:36,355 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-09' AND '2024-01-09' (base.py:2260)
2025-08-11 09:22:36,360 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-09 00:00:00, 2024-01-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,360 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,373 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,386 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-10 00:00:00, 2024-01-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,387 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-10' AND '2024-01-10' (base.py:2260)
2025-08-11 09:22:36,390 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-10' AND '2024-01-10' (base.py:2260)
2025-08-11 09:22:36,394 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-10 00:00:00, 2024-01-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,394 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,411 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,425 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-11 00:00:00, 2024-01-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,426 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-11' AND '2024-01-11' (base.py:2260)
2025-08-11 09:22:36,431 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-11' AND '2024-01-11' (base.py:2260)
2025-08-11 09:22:36,436 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-11 00:00:00, 2024-01-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,436 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,448 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,463 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-12 00:00:00, 2024-01-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,465 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-12' AND '2024-01-12' (base.py:2260)
2025-08-11 09:22:36,467 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-12' AND '2024-01-12' (base.py:2260)
2025-08-11 09:22:36,473 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-12 00:00:00, 2024-01-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,473 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,486 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,500 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-13 00:00:00, 2024-01-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,502 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-13' AND '2024-01-13' (base.py:2260)
2025-08-11 09:22:36,505 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-13' AND '2024-01-13' (base.py:2260)
2025-08-11 09:22:36,510 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-13 00:00:00, 2024-01-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,510 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,522 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,536 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-14 00:00:00, 2024-01-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,538 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-14' AND '2024-01-14' (base.py:2260)
2025-08-11 09:22:36,540 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-14' AND '2024-01-14' (base.py:2260)
2025-08-11 09:22:36,545 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-14 00:00:00, 2024-01-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,545 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,557 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,571 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-15 00:00:00, 2024-01-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,572 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-15' AND '2024-01-15' (base.py:2260)
2025-08-11 09:22:36,576 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-15' AND '2024-01-15' (base.py:2260)
2025-08-11 09:22:36,580 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-15 00:00:00, 2024-01-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,580 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,593 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,606 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-16 00:00:00, 2024-01-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,607 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-16' AND '2024-01-16' (base.py:2260)
2025-08-11 09:22:36,610 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-16' AND '2024-01-16' (base.py:2260)
2025-08-11 09:22:36,615 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-16 00:00:00, 2024-01-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,615 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,629 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,644 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-17 00:00:00, 2024-01-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,645 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-17' AND '2024-01-17' (base.py:2260)
2025-08-11 09:22:36,648 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-17' AND '2024-01-17' (base.py:2260)
2025-08-11 09:22:36,654 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-17 00:00:00, 2024-01-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,654 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,666 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,682 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-18 00:00:00, 2024-01-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,683 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-18' AND '2024-01-18' (base.py:2260)
2025-08-11 09:22:36,685 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-18' AND '2024-01-18' (base.py:2260)
2025-08-11 09:22:36,690 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-18 00:00:00, 2024-01-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,690 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,709 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,724 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-19 00:00:00, 2024-01-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,725 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-19' AND '2024-01-19' (base.py:2260)
2025-08-11 09:22:36,727 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-19' AND '2024-01-19' (base.py:2260)
2025-08-11 09:22:36,732 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-19 00:00:00, 2024-01-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,732 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,746 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,761 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-20 00:00:00, 2024-01-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,764 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-20' AND '2024-01-20' (base.py:2260)
2025-08-11 09:22:36,766 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-20' AND '2024-01-20' (base.py:2260)
2025-08-11 09:22:36,770 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-20 00:00:00, 2024-01-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,771 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,785 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,799 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-21 00:00:00, 2024-01-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,800 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-21' AND '2024-01-21' (base.py:2260)
2025-08-11 09:22:36,804 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-21' AND '2024-01-21' (base.py:2260)
2025-08-11 09:22:36,807 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-21 00:00:00, 2024-01-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,809 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,821 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,836 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-22 00:00:00, 2024-01-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,837 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-22' AND '2024-01-22' (base.py:2260)
2025-08-11 09:22:36,840 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-22' AND '2024-01-22' (base.py:2260)
2025-08-11 09:22:36,845 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-22 00:00:00, 2024-01-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,845 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,859 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,874 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-23 00:00:00, 2024-01-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,877 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-23' AND '2024-01-23' (base.py:2260)
2025-08-11 09:22:36,880 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-23' AND '2024-01-23' (base.py:2260)
2025-08-11 09:22:36,884 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-23 00:00:00, 2024-01-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,884 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,896 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,912 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-24 00:00:00, 2024-01-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,913 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-24' AND '2024-01-24' (base.py:2260)
2025-08-11 09:22:36,915 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-24' AND '2024-01-24' (base.py:2260)
2025-08-11 09:22:36,920 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-24 00:00:00, 2024-01-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,920 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,934 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,950 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-25 00:00:00, 2024-01-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:36,951 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-25' AND '2024-01-25' (base.py:2260)
2025-08-11 09:22:36,954 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-25' AND '2024-01-25' (base.py:2260)
2025-08-11 09:22:36,959 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-25 00:00:00, 2024-01-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:36,959 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:36,973 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:36,987 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-26 00:00:00, 2024-01-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,053 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-26' AND '2024-01-26' (base.py:2260)
2025-08-11 09:22:37,056 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-26' AND '2024-01-26' (base.py:2260)
2025-08-11 09:22:37,060 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-26 00:00:00, 2024-01-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,060 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,073 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,089 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-27 00:00:00, 2024-01-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,090 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-27' AND '2024-01-27' (base.py:2260)
2025-08-11 09:22:37,094 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-27' AND '2024-01-27' (base.py:2260)
2025-08-11 09:22:37,099 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-27 00:00:00, 2024-01-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,099 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,111 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,125 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-28 00:00:00, 2024-01-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,126 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-28' AND '2024-01-28' (base.py:2260)
2025-08-11 09:22:37,129 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-28' AND '2024-01-28' (base.py:2260)
2025-08-11 09:22:37,133 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-28 00:00:00, 2024-01-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,133 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,147 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,163 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-29 00:00:00, 2024-01-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,165 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-29' AND '2024-01-29' (base.py:2260)
2025-08-11 09:22:37,169 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-29' AND '2024-01-29' (base.py:2260)
2025-08-11 09:22:37,173 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-29 00:00:00, 2024-01-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,173 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,187 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,201 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-30 00:00:00, 2024-01-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,203 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-30' AND '2024-01-30' (base.py:2260)
2025-08-11 09:22:37,206 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-30' AND '2024-01-30' (base.py:2260)
2025-08-11 09:22:37,211 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-30 00:00:00, 2024-01-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,211 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,225 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,240 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-01-31 00:00:00, 2024-02-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,241 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-01-31' AND '2024-01-31' (base.py:2260)
2025-08-11 09:22:37,244 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-01-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-01-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-01-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-01-31' AND '2024-01-31' (base.py:2260)
2025-08-11 09:22:37,249 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-01-31 00:00:00, 2024-02-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,249 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,262 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,277 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-01 00:00:00, 2024-02-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,281 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-01' AND '2024-02-01' (base.py:2260)
2025-08-11 09:22:37,284 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-01-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-01' AND '2024-02-01' (base.py:2260)
2025-08-11 09:22:37,288 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-01 00:00:00, 2024-02-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,288 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,300 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,316 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-02 00:00:00, 2024-02-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,317 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-02' AND '2024-02-02' (base.py:2260)
2025-08-11 09:22:37,320 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-02' AND '2024-02-02' (base.py:2260)
2025-08-11 09:22:37,325 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-02 00:00:00, 2024-02-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,325 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,337 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,351 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-03 00:00:00, 2024-02-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,352 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-03' AND '2024-02-03' (base.py:2260)
2025-08-11 09:22:37,355 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-03' AND '2024-02-03' (base.py:2260)
2025-08-11 09:22:37,359 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-03 00:00:00, 2024-02-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,359 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,373 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,387 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-04 00:00:00, 2024-02-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,388 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-04' AND '2024-02-04' (base.py:2260)
2025-08-11 09:22:37,391 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-04' AND '2024-02-04' (base.py:2260)
2025-08-11 09:22:37,395 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-04 00:00:00, 2024-02-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,395 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,410 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,426 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-05 00:00:00, 2024-02-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,427 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-05' AND '2024-02-05' (base.py:2260)
2025-08-11 09:22:37,430 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-05' AND '2024-02-05' (base.py:2260)
2025-08-11 09:22:37,435 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-05 00:00:00, 2024-02-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,435 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,448 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,464 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-06 00:00:00, 2024-02-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,465 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-06' AND '2024-02-06' (base.py:2260)
2025-08-11 09:22:37,468 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-06' AND '2024-02-06' (base.py:2260)
2025-08-11 09:22:37,473 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-06 00:00:00, 2024-02-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,473 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,485 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,499 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-07 00:00:00, 2024-02-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,501 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-07' AND '2024-02-07' (base.py:2260)
2025-08-11 09:22:37,505 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-07' AND '2024-02-07' (base.py:2260)
2025-08-11 09:22:37,509 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-07 00:00:00, 2024-02-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,509 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,529 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,543 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-08 00:00:00, 2024-02-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,545 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-08' AND '2024-02-08' (base.py:2260)
2025-08-11 09:22:37,548 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-08' AND '2024-02-08' (base.py:2260)
2025-08-11 09:22:37,552 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-08 00:00:00, 2024-02-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,552 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,566 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,581 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-09 00:00:00, 2024-02-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,582 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-09' AND '2024-02-09' (base.py:2260)
2025-08-11 09:22:37,585 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-09' AND '2024-02-09' (base.py:2260)
2025-08-11 09:22:37,589 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-09 00:00:00, 2024-02-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,589 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,604 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,619 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-10 00:00:00, 2024-02-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,622 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-10' AND '2024-02-10' (base.py:2260)
2025-08-11 09:22:37,625 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-10' AND '2024-02-10' (base.py:2260)
2025-08-11 09:22:37,629 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-10 00:00:00, 2024-02-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,629 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,643 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,657 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-11 00:00:00, 2024-02-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,658 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-11' AND '2024-02-11' (base.py:2260)
2025-08-11 09:22:37,661 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-11' AND '2024-02-11' (base.py:2260)
2025-08-11 09:22:37,666 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-11 00:00:00, 2024-02-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,666 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,679 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,694 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-12 00:00:00, 2024-02-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,695 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-12' AND '2024-02-12' (base.py:2260)
2025-08-11 09:22:37,698 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-12' AND '2024-02-12' (base.py:2260)
2025-08-11 09:22:37,703 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-12 00:00:00, 2024-02-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,703 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,716 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,730 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-13 00:00:00, 2024-02-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,731 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-13' AND '2024-02-13' (base.py:2260)
2025-08-11 09:22:37,734 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-13' AND '2024-02-13' (base.py:2260)
2025-08-11 09:22:37,740 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-13 00:00:00, 2024-02-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,740 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,754 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,768 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-14 00:00:00, 2024-02-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,770 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-14' AND '2024-02-14' (base.py:2260)
2025-08-11 09:22:37,774 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-14' AND '2024-02-14' (base.py:2260)
2025-08-11 09:22:37,778 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-14 00:00:00, 2024-02-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,778 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,791 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,806 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-15 00:00:00, 2024-02-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,807 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-15' AND '2024-02-15' (base.py:2260)
2025-08-11 09:22:37,811 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-15' AND '2024-02-15' (base.py:2260)
2025-08-11 09:22:37,816 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-15 00:00:00, 2024-02-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,816 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,828 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,842 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-16 00:00:00, 2024-02-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,843 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-16' AND '2024-02-16' (base.py:2260)
2025-08-11 09:22:37,846 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-16' AND '2024-02-16' (base.py:2260)
2025-08-11 09:22:37,850 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-16 00:00:00, 2024-02-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,850 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,863 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,880 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-17 00:00:00, 2024-02-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,881 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-17' AND '2024-02-17' (base.py:2260)
2025-08-11 09:22:37,884 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-17' AND '2024-02-17' (base.py:2260)
2025-08-11 09:22:37,888 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-17 00:00:00, 2024-02-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,888 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,902 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,917 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-18 00:00:00, 2024-02-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,918 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-18' AND '2024-02-18' (base.py:2260)
2025-08-11 09:22:37,920 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-18' AND '2024-02-18' (base.py:2260)
2025-08-11 09:22:37,925 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-18 00:00:00, 2024-02-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,925 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,939 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,955 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-19 00:00:00, 2024-02-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,957 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-19' AND '2024-02-19' (base.py:2260)
2025-08-11 09:22:37,960 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-19' AND '2024-02-19' (base.py:2260)
2025-08-11 09:22:37,965 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-19 00:00:00, 2024-02-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:37,966 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:37,979 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:37,993 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-20 00:00:00, 2024-02-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:37,995 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-20' AND '2024-02-20' (base.py:2260)
2025-08-11 09:22:37,998 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-20' AND '2024-02-20' (base.py:2260)
2025-08-11 09:22:38,002 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-20 00:00:00, 2024-02-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,002 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,016 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,029 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-21 00:00:00, 2024-02-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,030 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-21' AND '2024-02-21' (base.py:2260)
2025-08-11 09:22:38,033 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-21' AND '2024-02-21' (base.py:2260)
2025-08-11 09:22:38,039 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-21 00:00:00, 2024-02-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,039 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,053 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,069 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-22 00:00:00, 2024-02-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,072 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-22' AND '2024-02-22' (base.py:2260)
2025-08-11 09:22:38,075 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-22' AND '2024-02-22' (base.py:2260)
2025-08-11 09:22:38,080 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-22 00:00:00, 2024-02-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,080 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,093 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,106 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-23 00:00:00, 2024-02-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,107 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-23' AND '2024-02-23' (base.py:2260)
2025-08-11 09:22:38,110 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-23' AND '2024-02-23' (base.py:2260)
2025-08-11 09:22:38,114 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-23 00:00:00, 2024-02-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,114 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,128 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,143 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-24 00:00:00, 2024-02-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,144 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-24' AND '2024-02-24' (base.py:2260)
2025-08-11 09:22:38,147 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-24' AND '2024-02-24' (base.py:2260)
2025-08-11 09:22:38,151 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-24 00:00:00, 2024-02-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,151 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,164 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,179 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-25 00:00:00, 2024-02-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,182 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-25' AND '2024-02-25' (base.py:2260)
2025-08-11 09:22:38,185 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-25' AND '2024-02-25' (base.py:2260)
2025-08-11 09:22:38,190 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-25 00:00:00, 2024-02-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,190 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,203 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,217 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-26 00:00:00, 2024-02-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,219 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-26' AND '2024-02-26' (base.py:2260)
2025-08-11 09:22:38,221 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-26' AND '2024-02-26' (base.py:2260)
2025-08-11 09:22:38,226 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-26 00:00:00, 2024-02-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,226 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,239 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,254 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-27 00:00:00, 2024-02-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,255 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-27' AND '2024-02-27' (base.py:2260)
2025-08-11 09:22:38,259 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-27' AND '2024-02-27' (base.py:2260)
2025-08-11 09:22:38,264 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-27 00:00:00, 2024-02-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,264 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,276 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,290 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-28 00:00:00, 2024-02-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,291 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-28' AND '2024-02-28' (base.py:2260)
2025-08-11 09:22:38,293 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-28' AND '2024-02-28' (base.py:2260)
2025-08-11 09:22:38,298 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-28 00:00:00, 2024-02-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,298 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,314 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,327 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-02-29 00:00:00, 2024-03-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,328 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-02-29' AND '2024-02-29' (base.py:2260)
2025-08-11 09:22:38,331 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-02-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-02-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-02-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-02-29' AND '2024-02-29' (base.py:2260)
2025-08-11 09:22:38,336 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-02-29 00:00:00, 2024-03-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,336 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,348 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,363 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-01 00:00:00, 2024-03-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,364 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-01' AND '2024-03-01' (base.py:2260)
2025-08-11 09:22:38,367 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-02-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-01' AND '2024-03-01' (base.py:2260)
2025-08-11 09:22:38,371 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-01 00:00:00, 2024-03-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,371 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,383 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,397 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-02 00:00:00, 2024-03-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,398 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-02' AND '2024-03-02' (base.py:2260)
2025-08-11 09:22:38,401 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-02' AND '2024-03-02' (base.py:2260)
2025-08-11 09:22:38,407 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-02 00:00:00, 2024-03-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,407 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,421 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,438 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-03 00:00:00, 2024-03-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,440 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-03' AND '2024-03-03' (base.py:2260)
2025-08-11 09:22:38,442 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-03' AND '2024-03-03' (base.py:2260)
2025-08-11 09:22:38,447 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-03 00:00:00, 2024-03-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,447 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,459 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,473 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-04 00:00:00, 2024-03-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,474 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-04' AND '2024-03-04' (base.py:2260)
2025-08-11 09:22:38,477 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-04' AND '2024-03-04' (base.py:2260)
2025-08-11 09:22:38,481 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-04 00:00:00, 2024-03-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,482 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,495 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,510 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-05 00:00:00, 2024-03-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,512 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-05' AND '2024-03-05' (base.py:2260)
2025-08-11 09:22:38,516 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-05' AND '2024-03-05' (base.py:2260)
2025-08-11 09:22:38,522 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-05 00:00:00, 2024-03-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,522 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,536 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,549 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-06 00:00:00, 2024-03-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,550 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-06' AND '2024-03-06' (base.py:2260)
2025-08-11 09:22:38,554 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-06' AND '2024-03-06' (base.py:2260)
2025-08-11 09:22:38,558 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-06 00:00:00, 2024-03-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,558 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,572 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,587 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-07 00:00:00, 2024-03-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,589 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-07' AND '2024-03-07' (base.py:2260)
2025-08-11 09:22:38,591 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-07' AND '2024-03-07' (base.py:2260)
2025-08-11 09:22:38,597 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-07 00:00:00, 2024-03-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,597 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,611 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,629 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-08 00:00:00, 2024-03-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,632 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-08' AND '2024-03-08' (base.py:2260)
2025-08-11 09:22:38,635 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-08' AND '2024-03-08' (base.py:2260)
2025-08-11 09:22:38,639 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-08 00:00:00, 2024-03-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,639 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,654 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,670 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-09 00:00:00, 2024-03-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,671 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-09' AND '2024-03-09' (base.py:2260)
2025-08-11 09:22:38,674 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-09' AND '2024-03-09' (base.py:2260)
2025-08-11 09:22:38,679 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-09 00:00:00, 2024-03-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,680 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,694 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,708 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-10 00:00:00, 2024-03-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,710 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-10' AND '2024-03-10' (base.py:2260)
2025-08-11 09:22:38,713 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-10' AND '2024-03-10' (base.py:2260)
2025-08-11 09:22:38,717 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-10 00:00:00, 2024-03-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,717 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,731 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,744 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-11 00:00:00, 2024-03-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,746 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-11' AND '2024-03-11' (base.py:2260)
2025-08-11 09:22:38,750 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-11' AND '2024-03-11' (base.py:2260)
2025-08-11 09:22:38,755 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-11 00:00:00, 2024-03-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,755 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,769 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,784 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-12 00:00:00, 2024-03-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,785 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-12' AND '2024-03-12' (base.py:2260)
2025-08-11 09:22:38,787 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-12' AND '2024-03-12' (base.py:2260)
2025-08-11 09:22:38,791 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-12 00:00:00, 2024-03-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,791 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,805 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,820 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-13 00:00:00, 2024-03-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,821 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-13' AND '2024-03-13' (base.py:2260)
2025-08-11 09:22:38,824 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-13' AND '2024-03-13' (base.py:2260)
2025-08-11 09:22:38,828 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-13 00:00:00, 2024-03-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,828 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,842 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,856 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-14 00:00:00, 2024-03-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,857 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-14' AND '2024-03-14' (base.py:2260)
2025-08-11 09:22:38,862 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-14' AND '2024-03-14' (base.py:2260)
2025-08-11 09:22:38,867 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-14 00:00:00, 2024-03-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,867 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,880 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,894 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-15 00:00:00, 2024-03-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,896 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-15' AND '2024-03-15' (base.py:2260)
2025-08-11 09:22:38,899 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-15' AND '2024-03-15' (base.py:2260)
2025-08-11 09:22:38,903 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-15 00:00:00, 2024-03-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:38,903 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:38,917 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:38,931 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-16 00:00:00, 2024-03-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:38,933 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-16' AND '2024-03-16' (base.py:2260)
2025-08-11 09:22:39,003 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-16' AND '2024-03-16' (base.py:2260)
2025-08-11 09:22:39,008 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-16 00:00:00, 2024-03-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,008 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,021 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,035 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-17 00:00:00, 2024-03-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,036 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-17' AND '2024-03-17' (base.py:2260)
2025-08-11 09:22:39,039 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-17' AND '2024-03-17' (base.py:2260)
2025-08-11 09:22:39,044 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-17 00:00:00, 2024-03-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,044 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,058 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,072 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-18 00:00:00, 2024-03-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,073 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-18' AND '2024-03-18' (base.py:2260)
2025-08-11 09:22:39,076 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-18' AND '2024-03-18' (base.py:2260)
2025-08-11 09:22:39,081 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-18 00:00:00, 2024-03-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,081 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,095 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,109 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-19 00:00:00, 2024-03-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,111 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-19' AND '2024-03-19' (base.py:2260)
2025-08-11 09:22:39,113 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-19' AND '2024-03-19' (base.py:2260)
2025-08-11 09:22:39,120 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-19 00:00:00, 2024-03-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,120 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,136 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,151 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-20 00:00:00, 2024-03-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,153 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-20' AND '2024-03-20' (base.py:2260)
2025-08-11 09:22:39,156 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-20' AND '2024-03-20' (base.py:2260)
2025-08-11 09:22:39,161 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-20 00:00:00, 2024-03-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,161 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,176 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,191 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-21 00:00:00, 2024-03-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,193 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-21' AND '2024-03-21' (base.py:2260)
2025-08-11 09:22:39,195 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-21' AND '2024-03-21' (base.py:2260)
2025-08-11 09:22:39,202 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-21 00:00:00, 2024-03-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,202 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,215 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,229 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-22 00:00:00, 2024-03-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,233 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-22' AND '2024-03-22' (base.py:2260)
2025-08-11 09:22:39,237 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-22' AND '2024-03-22' (base.py:2260)
2025-08-11 09:22:39,241 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-22 00:00:00, 2024-03-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,241 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,253 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,269 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-23 00:00:00, 2024-03-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,270 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-23' AND '2024-03-23' (base.py:2260)
2025-08-11 09:22:39,273 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-23' AND '2024-03-23' (base.py:2260)
2025-08-11 09:22:39,277 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-23 00:00:00, 2024-03-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,277 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,292 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,306 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-24 00:00:00, 2024-03-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,307 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-24' AND '2024-03-24' (base.py:2260)
2025-08-11 09:22:39,310 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-24' AND '2024-03-24' (base.py:2260)
2025-08-11 09:22:39,315 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-24 00:00:00, 2024-03-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,315 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,327 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,343 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-25 00:00:00, 2024-03-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,346 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-25' AND '2024-03-25' (base.py:2260)
2025-08-11 09:22:39,349 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-25' AND '2024-03-25' (base.py:2260)
2025-08-11 09:22:39,354 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-25 00:00:00, 2024-03-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,354 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,366 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,381 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-26 00:00:00, 2024-03-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,382 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-26' AND '2024-03-26' (base.py:2260)
2025-08-11 09:22:39,385 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-26' AND '2024-03-26' (base.py:2260)
2025-08-11 09:22:39,390 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-26 00:00:00, 2024-03-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,390 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,403 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,418 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-27 00:00:00, 2024-03-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,420 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-27' AND '2024-03-27' (base.py:2260)
2025-08-11 09:22:39,423 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-27' AND '2024-03-27' (base.py:2260)
2025-08-11 09:22:39,428 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-27 00:00:00, 2024-03-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,428 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,443 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,456 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-28 00:00:00, 2024-03-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,457 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-28' AND '2024-03-28' (base.py:2260)
2025-08-11 09:22:39,461 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-28' AND '2024-03-28' (base.py:2260)
2025-08-11 09:22:39,468 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-28 00:00:00, 2024-03-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,468 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,482 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,496 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-29 00:00:00, 2024-03-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,497 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-29' AND '2024-03-29' (base.py:2260)
2025-08-11 09:22:39,500 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-29' AND '2024-03-29' (base.py:2260)
2025-08-11 09:22:39,504 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-29 00:00:00, 2024-03-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,504 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,518 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,532 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-30 00:00:00, 2024-03-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,533 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-30' AND '2024-03-30' (base.py:2260)
2025-08-11 09:22:39,536 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-30' AND '2024-03-30' (base.py:2260)
2025-08-11 09:22:39,541 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-30 00:00:00, 2024-03-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,541 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,554 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,569 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-03-31 00:00:00, 2024-04-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,570 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-03-31' AND '2024-03-31' (base.py:2260)
2025-08-11 09:22:39,573 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-03-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-03-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-03-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-03-31' AND '2024-03-31' (base.py:2260)
2025-08-11 09:22:39,578 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-03-31 00:00:00, 2024-04-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,578 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,591 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,608 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-01 00:00:00, 2024-04-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,609 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-01' AND '2024-04-01' (base.py:2260)
2025-08-11 09:22:39,613 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-03-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-01' AND '2024-04-01' (base.py:2260)
2025-08-11 09:22:39,618 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-01 00:00:00, 2024-04-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,618 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,630 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,644 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-02 00:00:00, 2024-04-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,645 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-02' AND '2024-04-02' (base.py:2260)
2025-08-11 09:22:39,647 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-02' AND '2024-04-02' (base.py:2260)
2025-08-11 09:22:39,653 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-02 00:00:00, 2024-04-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,653 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,666 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,681 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-03 00:00:00, 2024-04-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,682 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-03' AND '2024-04-03' (base.py:2260)
2025-08-11 09:22:39,688 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-03' AND '2024-04-03' (base.py:2260)
2025-08-11 09:22:39,693 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-03 00:00:00, 2024-04-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,693 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,705 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,720 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-04 00:00:00, 2024-04-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,722 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-04' AND '2024-04-04' (base.py:2260)
2025-08-11 09:22:39,725 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-04' AND '2024-04-04' (base.py:2260)
2025-08-11 09:22:39,729 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-04 00:00:00, 2024-04-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,729 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,744 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,758 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-05 00:00:00, 2024-04-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,759 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-05' AND '2024-04-05' (base.py:2260)
2025-08-11 09:22:39,762 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-05' AND '2024-04-05' (base.py:2260)
2025-08-11 09:22:39,767 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-05 00:00:00, 2024-04-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,767 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,782 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,798 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-06 00:00:00, 2024-04-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,801 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-06' AND '2024-04-06' (base.py:2260)
2025-08-11 09:22:39,804 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-06' AND '2024-04-06' (base.py:2260)
2025-08-11 09:22:39,808 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-06 00:00:00, 2024-04-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,808 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,820 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,835 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-07 00:00:00, 2024-04-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,836 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-07' AND '2024-04-07' (base.py:2260)
2025-08-11 09:22:39,839 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-07' AND '2024-04-07' (base.py:2260)
2025-08-11 09:22:39,845 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-07 00:00:00, 2024-04-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,845 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,858 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,873 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-08 00:00:00, 2024-04-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,875 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-08' AND '2024-04-08' (base.py:2260)
2025-08-11 09:22:39,878 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-08' AND '2024-04-08' (base.py:2260)
2025-08-11 09:22:39,882 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-08 00:00:00, 2024-04-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,882 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,894 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,908 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-09 00:00:00, 2024-04-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,910 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-09' AND '2024-04-09' (base.py:2260)
2025-08-11 09:22:39,912 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-09' AND '2024-04-09' (base.py:2260)
2025-08-11 09:22:39,918 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-09 00:00:00, 2024-04-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,918 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,932 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,946 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-10 00:00:00, 2024-04-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,947 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-10' AND '2024-04-10' (base.py:2260)
2025-08-11 09:22:39,951 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-10' AND '2024-04-10' (base.py:2260)
2025-08-11 09:22:39,955 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-10 00:00:00, 2024-04-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,955 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:39,968 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:39,983 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-11 00:00:00, 2024-04-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:39,984 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-11' AND '2024-04-11' (base.py:2260)
2025-08-11 09:22:39,987 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-11' AND '2024-04-11' (base.py:2260)
2025-08-11 09:22:39,992 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-11 00:00:00, 2024-04-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:39,993 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,006 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,020 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-12 00:00:00, 2024-04-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,021 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-12' AND '2024-04-12' (base.py:2260)
2025-08-11 09:22:40,024 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-12' AND '2024-04-12' (base.py:2260)
2025-08-11 09:22:40,030 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-12 00:00:00, 2024-04-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,030 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,044 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,060 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-13 00:00:00, 2024-04-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,062 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-13' AND '2024-04-13' (base.py:2260)
2025-08-11 09:22:40,065 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-13' AND '2024-04-13' (base.py:2260)
2025-08-11 09:22:40,070 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-13 00:00:00, 2024-04-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,070 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,082 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,098 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-14 00:00:00, 2024-04-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,099 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-14' AND '2024-04-14' (base.py:2260)
2025-08-11 09:22:40,101 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-14' AND '2024-04-14' (base.py:2260)
2025-08-11 09:22:40,106 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-14 00:00:00, 2024-04-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,106 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,120 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,134 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-15 00:00:00, 2024-04-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,136 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-15' AND '2024-04-15' (base.py:2260)
2025-08-11 09:22:40,141 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-15' AND '2024-04-15' (base.py:2260)
2025-08-11 09:22:40,145 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-15 00:00:00, 2024-04-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,146 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,158 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,172 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-16 00:00:00, 2024-04-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,174 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-16' AND '2024-04-16' (base.py:2260)
2025-08-11 09:22:40,177 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-16' AND '2024-04-16' (base.py:2260)
2025-08-11 09:22:40,182 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-16 00:00:00, 2024-04-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,182 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,195 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,209 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-17 00:00:00, 2024-04-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,210 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-17' AND '2024-04-17' (base.py:2260)
2025-08-11 09:22:40,213 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-17' AND '2024-04-17' (base.py:2260)
2025-08-11 09:22:40,218 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-17 00:00:00, 2024-04-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,218 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,232 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,246 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-18 00:00:00, 2024-04-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,249 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-18' AND '2024-04-18' (base.py:2260)
2025-08-11 09:22:40,252 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-18' AND '2024-04-18' (base.py:2260)
2025-08-11 09:22:40,257 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-18 00:00:00, 2024-04-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,257 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,269 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,284 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-19 00:00:00, 2024-04-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,285 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-19' AND '2024-04-19' (base.py:2260)
2025-08-11 09:22:40,288 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-19' AND '2024-04-19' (base.py:2260)
2025-08-11 09:22:40,292 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-19 00:00:00, 2024-04-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,292 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,305 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,320 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-20 00:00:00, 2024-04-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,322 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-20' AND '2024-04-20' (base.py:2260)
2025-08-11 09:22:40,325 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-20' AND '2024-04-20' (base.py:2260)
2025-08-11 09:22:40,329 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-20 00:00:00, 2024-04-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,329 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,342 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,357 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-21 00:00:00, 2024-04-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,359 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-21' AND '2024-04-21' (base.py:2260)
2025-08-11 09:22:40,363 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-21' AND '2024-04-21' (base.py:2260)
2025-08-11 09:22:40,369 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-21 00:00:00, 2024-04-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,369 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,382 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,397 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-22 00:00:00, 2024-04-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,398 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-22' AND '2024-04-22' (base.py:2260)
2025-08-11 09:22:40,402 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-22' AND '2024-04-22' (base.py:2260)
2025-08-11 09:22:40,407 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-22 00:00:00, 2024-04-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,407 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,420 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,435 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-23 00:00:00, 2024-04-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,436 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-23' AND '2024-04-23' (base.py:2260)
2025-08-11 09:22:40,439 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-23' AND '2024-04-23' (base.py:2260)
2025-08-11 09:22:40,443 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-23 00:00:00, 2024-04-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,443 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,459 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,473 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-24 00:00:00, 2024-04-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,477 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-24' AND '2024-04-24' (base.py:2260)
2025-08-11 09:22:40,481 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-24' AND '2024-04-24' (base.py:2260)
2025-08-11 09:22:40,485 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-24 00:00:00, 2024-04-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,485 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,497 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,513 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-25 00:00:00, 2024-04-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,514 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-25' AND '2024-04-25' (base.py:2260)
2025-08-11 09:22:40,517 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-25' AND '2024-04-25' (base.py:2260)
2025-08-11 09:22:40,522 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-25 00:00:00, 2024-04-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,522 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,535 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,551 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-26 00:00:00, 2024-04-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,553 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-26' AND '2024-04-26' (base.py:2260)
2025-08-11 09:22:40,556 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-26' AND '2024-04-26' (base.py:2260)
2025-08-11 09:22:40,560 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-26 00:00:00, 2024-04-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,560 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,572 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,587 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-27 00:00:00, 2024-04-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,588 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-27' AND '2024-04-27' (base.py:2260)
2025-08-11 09:22:40,592 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-27' AND '2024-04-27' (base.py:2260)
2025-08-11 09:22:40,597 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-27 00:00:00, 2024-04-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,597 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,610 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,624 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-28 00:00:00, 2024-04-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,626 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-28' AND '2024-04-28' (base.py:2260)
2025-08-11 09:22:40,630 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-28' AND '2024-04-28' (base.py:2260)
2025-08-11 09:22:40,634 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-28 00:00:00, 2024-04-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,634 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,647 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,662 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-29 00:00:00, 2024-04-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,663 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-29' AND '2024-04-29' (base.py:2260)
2025-08-11 09:22:40,665 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-29' AND '2024-04-29' (base.py:2260)
2025-08-11 09:22:40,669 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-29 00:00:00, 2024-04-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,669 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,685 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,700 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-04-30 00:00:00, 2024-05-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,703 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-04-30' AND '2024-04-30' (base.py:2260)
2025-08-11 09:22:40,707 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-04-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-04-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-04-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-04-30' AND '2024-04-30' (base.py:2260)
2025-08-11 09:22:40,711 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-04-30 00:00:00, 2024-05-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,711 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,725 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,740 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-01 00:00:00, 2024-05-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,741 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-01' AND '2024-05-01' (base.py:2260)
2025-08-11 09:22:40,746 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-04-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-01' AND '2024-05-01' (base.py:2260)
2025-08-11 09:22:40,750 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-01 00:00:00, 2024-05-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,750 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,762 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,775 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-02 00:00:00, 2024-05-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,776 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-02' AND '2024-05-02' (base.py:2260)
2025-08-11 09:22:40,779 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-02' AND '2024-05-02' (base.py:2260)
2025-08-11 09:22:40,784 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-02 00:00:00, 2024-05-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,784 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,797 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,813 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-03 00:00:00, 2024-05-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,814 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-03' AND '2024-05-03' (base.py:2260)
2025-08-11 09:22:40,819 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-03' AND '2024-05-03' (base.py:2260)
2025-08-11 09:22:40,823 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-03 00:00:00, 2024-05-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,823 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,838 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,852 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-04 00:00:00, 2024-05-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,853 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-04' AND '2024-05-04' (base.py:2260)
2025-08-11 09:22:40,857 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-04' AND '2024-05-04' (base.py:2260)
2025-08-11 09:22:40,861 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-04 00:00:00, 2024-05-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,861 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,876 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,890 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-05 00:00:00, 2024-05-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,891 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-05' AND '2024-05-05' (base.py:2260)
2025-08-11 09:22:40,894 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-05' AND '2024-05-05' (base.py:2260)
2025-08-11 09:22:40,898 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-05 00:00:00, 2024-05-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,898 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,911 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,925 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-06 00:00:00, 2024-05-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,926 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-06' AND '2024-05-06' (base.py:2260)
2025-08-11 09:22:40,929 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-06' AND '2024-05-06' (base.py:2260)
2025-08-11 09:22:40,935 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-06 00:00:00, 2024-05-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,936 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,948 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:40,964 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-07 00:00:00, 2024-05-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:40,965 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-07' AND '2024-05-07' (base.py:2260)
2025-08-11 09:22:40,968 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-07' AND '2024-05-07' (base.py:2260)
2025-08-11 09:22:40,973 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-07 00:00:00, 2024-05-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:40,973 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:40,986 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,001 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-08 00:00:00, 2024-05-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,002 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-08' AND '2024-05-08' (base.py:2260)
2025-08-11 09:22:41,005 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-08' AND '2024-05-08' (base.py:2260)
2025-08-11 09:22:41,009 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-08 00:00:00, 2024-05-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,010 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,023 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,037 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-09 00:00:00, 2024-05-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,040 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-09' AND '2024-05-09' (base.py:2260)
2025-08-11 09:22:41,045 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-09' AND '2024-05-09' (base.py:2260)
2025-08-11 09:22:41,050 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-09 00:00:00, 2024-05-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,050 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,063 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,077 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-10 00:00:00, 2024-05-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,078 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-10' AND '2024-05-10' (base.py:2260)
2025-08-11 09:22:41,144 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-10' AND '2024-05-10' (base.py:2260)
2025-08-11 09:22:41,149 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-10 00:00:00, 2024-05-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,149 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,162 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,177 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-11 00:00:00, 2024-05-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,179 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-11' AND '2024-05-11' (base.py:2260)
2025-08-11 09:22:41,182 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-11' AND '2024-05-11' (base.py:2260)
2025-08-11 09:22:41,187 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-11 00:00:00, 2024-05-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,187 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,200 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,214 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-12 00:00:00, 2024-05-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,216 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-12' AND '2024-05-12' (base.py:2260)
2025-08-11 09:22:41,219 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-12' AND '2024-05-12' (base.py:2260)
2025-08-11 09:22:41,223 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-12 00:00:00, 2024-05-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,223 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,235 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,251 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-13 00:00:00, 2024-05-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,253 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-13' AND '2024-05-13' (base.py:2260)
2025-08-11 09:22:41,257 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-13' AND '2024-05-13' (base.py:2260)
2025-08-11 09:22:41,261 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-13 00:00:00, 2024-05-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,261 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,275 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,291 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-14 00:00:00, 2024-05-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,292 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-14' AND '2024-05-14' (base.py:2260)
2025-08-11 09:22:41,295 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-14' AND '2024-05-14' (base.py:2260)
2025-08-11 09:22:41,300 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-14 00:00:00, 2024-05-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,300 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,313 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,326 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-15 00:00:00, 2024-05-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,328 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-15' AND '2024-05-15' (base.py:2260)
2025-08-11 09:22:41,331 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-15' AND '2024-05-15' (base.py:2260)
2025-08-11 09:22:41,336 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-15 00:00:00, 2024-05-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,336 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,350 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,364 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-16 00:00:00, 2024-05-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,365 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-16' AND '2024-05-16' (base.py:2260)
2025-08-11 09:22:41,372 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-16' AND '2024-05-16' (base.py:2260)
2025-08-11 09:22:41,378 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-16 00:00:00, 2024-05-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,378 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,390 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,404 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-17 00:00:00, 2024-05-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,405 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-17' AND '2024-05-17' (base.py:2260)
2025-08-11 09:22:41,408 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-17' AND '2024-05-17' (base.py:2260)
2025-08-11 09:22:41,413 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-17 00:00:00, 2024-05-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,413 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,427 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,441 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-18 00:00:00, 2024-05-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,442 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-18' AND '2024-05-18' (base.py:2260)
2025-08-11 09:22:41,444 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-18' AND '2024-05-18' (base.py:2260)
2025-08-11 09:22:41,449 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-18 00:00:00, 2024-05-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,449 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,462 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,476 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-19 00:00:00, 2024-05-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,477 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-19' AND '2024-05-19' (base.py:2260)
2025-08-11 09:22:41,481 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-19' AND '2024-05-19' (base.py:2260)
2025-08-11 09:22:41,486 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-19 00:00:00, 2024-05-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,486 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,499 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,515 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-20 00:00:00, 2024-05-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,516 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-20' AND '2024-05-20' (base.py:2260)
2025-08-11 09:22:41,519 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-20' AND '2024-05-20' (base.py:2260)
2025-08-11 09:22:41,524 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-20 00:00:00, 2024-05-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,524 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,537 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,551 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-21 00:00:00, 2024-05-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,554 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-21' AND '2024-05-21' (base.py:2260)
2025-08-11 09:22:41,556 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-21' AND '2024-05-21' (base.py:2260)
2025-08-11 09:22:41,561 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-21 00:00:00, 2024-05-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,561 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,574 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,588 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-22 00:00:00, 2024-05-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,589 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-22' AND '2024-05-22' (base.py:2260)
2025-08-11 09:22:41,594 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-22' AND '2024-05-22' (base.py:2260)
2025-08-11 09:22:41,599 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-22 00:00:00, 2024-05-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,599 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,613 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,627 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-23 00:00:00, 2024-05-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,628 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-23' AND '2024-05-23' (base.py:2260)
2025-08-11 09:22:41,632 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-23' AND '2024-05-23' (base.py:2260)
2025-08-11 09:22:41,636 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-23 00:00:00, 2024-05-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,637 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,651 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,665 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-24 00:00:00, 2024-05-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,666 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-24' AND '2024-05-24' (base.py:2260)
2025-08-11 09:22:41,669 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-24' AND '2024-05-24' (base.py:2260)
2025-08-11 09:22:41,673 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-24 00:00:00, 2024-05-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,673 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,687 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,701 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-25 00:00:00, 2024-05-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,702 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-25' AND '2024-05-25' (base.py:2260)
2025-08-11 09:22:41,705 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-25' AND '2024-05-25' (base.py:2260)
2025-08-11 09:22:41,709 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-25 00:00:00, 2024-05-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,709 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,723 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,739 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-26 00:00:00, 2024-05-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,741 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-26' AND '2024-05-26' (base.py:2260)
2025-08-11 09:22:41,744 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-26' AND '2024-05-26' (base.py:2260)
2025-08-11 09:22:41,749 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-26 00:00:00, 2024-05-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,749 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,761 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,774 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-27 00:00:00, 2024-05-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,777 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-27' AND '2024-05-27' (base.py:2260)
2025-08-11 09:22:41,781 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-27' AND '2024-05-27' (base.py:2260)
2025-08-11 09:22:41,785 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-27 00:00:00, 2024-05-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,785 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,797 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,814 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-28 00:00:00, 2024-05-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,815 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-28' AND '2024-05-28' (base.py:2260)
2025-08-11 09:22:41,819 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-28' AND '2024-05-28' (base.py:2260)
2025-08-11 09:22:41,824 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-28 00:00:00, 2024-05-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,824 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,839 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,855 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-29 00:00:00, 2024-05-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,857 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-29' AND '2024-05-29' (base.py:2260)
2025-08-11 09:22:41,859 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-29' AND '2024-05-29' (base.py:2260)
2025-08-11 09:22:41,864 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-29 00:00:00, 2024-05-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,864 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,879 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,892 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-30 00:00:00, 2024-05-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,893 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-30' AND '2024-05-30' (base.py:2260)
2025-08-11 09:22:41,896 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-30' AND '2024-05-30' (base.py:2260)
2025-08-11 09:22:41,900 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-30 00:00:00, 2024-05-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,901 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,914 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,928 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-05-31 00:00:00, 2024-06-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,931 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-05-31' AND '2024-05-31' (base.py:2260)
2025-08-11 09:22:41,935 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-05-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-05-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-05-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-05-31' AND '2024-05-31' (base.py:2260)
2025-08-11 09:22:41,939 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-05-31 00:00:00, 2024-06-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,939 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,953 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:41,969 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-01 00:00:00, 2024-06-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:41,971 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-01' AND '2024-06-01' (base.py:2260)
2025-08-11 09:22:41,972 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-05-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-01' AND '2024-06-01' (base.py:2260)
2025-08-11 09:22:41,977 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-01 00:00:00, 2024-06-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:41,977 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:41,991 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,006 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-02 00:00:00, 2024-06-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,008 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-02' AND '2024-06-02' (base.py:2260)
2025-08-11 09:22:42,011 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-02' AND '2024-06-02' (base.py:2260)
2025-08-11 09:22:42,015 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-02 00:00:00, 2024-06-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,015 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,027 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,041 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-03 00:00:00, 2024-06-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,042 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-03' AND '2024-06-03' (base.py:2260)
2025-08-11 09:22:42,047 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-03' AND '2024-06-03' (base.py:2260)
2025-08-11 09:22:42,052 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-03 00:00:00, 2024-06-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,052 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,066 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,082 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-04 00:00:00, 2024-06-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,083 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-04' AND '2024-06-04' (base.py:2260)
2025-08-11 09:22:42,086 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-04' AND '2024-06-04' (base.py:2260)
2025-08-11 09:22:42,092 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-04 00:00:00, 2024-06-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,092 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,106 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,119 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-05 00:00:00, 2024-06-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,121 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-05' AND '2024-06-05' (base.py:2260)
2025-08-11 09:22:42,123 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-05' AND '2024-06-05' (base.py:2260)
2025-08-11 09:22:42,128 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-05 00:00:00, 2024-06-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,128 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,142 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,157 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-06 00:00:00, 2024-06-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,158 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-06' AND '2024-06-06' (base.py:2260)
2025-08-11 09:22:42,163 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-06' AND '2024-06-06' (base.py:2260)
2025-08-11 09:22:42,168 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-06 00:00:00, 2024-06-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,168 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,182 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,198 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-07 00:00:00, 2024-06-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,199 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-07' AND '2024-06-07' (base.py:2260)
2025-08-11 09:22:42,202 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-07' AND '2024-06-07' (base.py:2260)
2025-08-11 09:22:42,206 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-07 00:00:00, 2024-06-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,206 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,219 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,233 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-08 00:00:00, 2024-06-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,234 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-08' AND '2024-06-08' (base.py:2260)
2025-08-11 09:22:42,237 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-08' AND '2024-06-08' (base.py:2260)
2025-08-11 09:22:42,242 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-08 00:00:00, 2024-06-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,242 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,255 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,268 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-09 00:00:00, 2024-06-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,269 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-09' AND '2024-06-09' (base.py:2260)
2025-08-11 09:22:42,275 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-09' AND '2024-06-09' (base.py:2260)
2025-08-11 09:22:42,280 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-09 00:00:00, 2024-06-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,280 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,293 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,308 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-10 00:00:00, 2024-06-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,309 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-10' AND '2024-06-10' (base.py:2260)
2025-08-11 09:22:42,312 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-10' AND '2024-06-10' (base.py:2260)
2025-08-11 09:22:42,317 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-10 00:00:00, 2024-06-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,317 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,333 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,346 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-11 00:00:00, 2024-06-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,347 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-11' AND '2024-06-11' (base.py:2260)
2025-08-11 09:22:42,350 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-11' AND '2024-06-11' (base.py:2260)
2025-08-11 09:22:42,356 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-11 00:00:00, 2024-06-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,356 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,369 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,383 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-12 00:00:00, 2024-06-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,386 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-12' AND '2024-06-12' (base.py:2260)
2025-08-11 09:22:42,389 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-12' AND '2024-06-12' (base.py:2260)
2025-08-11 09:22:42,393 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-12 00:00:00, 2024-06-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,393 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,407 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,423 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-13 00:00:00, 2024-06-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,424 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-13' AND '2024-06-13' (base.py:2260)
2025-08-11 09:22:42,428 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-13' AND '2024-06-13' (base.py:2260)
2025-08-11 09:22:42,434 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-13 00:00:00, 2024-06-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,434 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,446 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,461 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-14 00:00:00, 2024-06-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,462 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-14' AND '2024-06-14' (base.py:2260)
2025-08-11 09:22:42,465 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-14' AND '2024-06-14' (base.py:2260)
2025-08-11 09:22:42,470 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-14 00:00:00, 2024-06-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,470 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,484 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,499 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-15 00:00:00, 2024-06-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,500 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-15' AND '2024-06-15' (base.py:2260)
2025-08-11 09:22:42,506 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-15' AND '2024-06-15' (base.py:2260)
2025-08-11 09:22:42,511 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-15 00:00:00, 2024-06-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,511 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,524 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,538 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-16 00:00:00, 2024-06-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,540 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-16' AND '2024-06-16' (base.py:2260)
2025-08-11 09:22:42,542 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-16' AND '2024-06-16' (base.py:2260)
2025-08-11 09:22:42,547 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-16 00:00:00, 2024-06-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,547 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,562 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,576 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-17 00:00:00, 2024-06-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,577 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-17' AND '2024-06-17' (base.py:2260)
2025-08-11 09:22:42,580 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-17' AND '2024-06-17' (base.py:2260)
2025-08-11 09:22:42,585 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-17 00:00:00, 2024-06-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,585 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,599 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,615 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-18 00:00:00, 2024-06-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,618 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-18' AND '2024-06-18' (base.py:2260)
2025-08-11 09:22:42,622 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-18' AND '2024-06-18' (base.py:2260)
2025-08-11 09:22:42,626 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-18 00:00:00, 2024-06-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,626 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,639 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,655 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-19 00:00:00, 2024-06-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,656 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-19' AND '2024-06-19' (base.py:2260)
2025-08-11 09:22:42,659 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-19' AND '2024-06-19' (base.py:2260)
2025-08-11 09:22:42,664 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-19 00:00:00, 2024-06-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,664 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,676 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,695 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-20 00:00:00, 2024-06-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,696 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-20' AND '2024-06-20' (base.py:2260)
2025-08-11 09:22:42,699 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-20' AND '2024-06-20' (base.py:2260)
2025-08-11 09:22:42,704 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-20 00:00:00, 2024-06-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,704 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,718 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,732 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-21 00:00:00, 2024-06-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,734 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-21' AND '2024-06-21' (base.py:2260)
2025-08-11 09:22:42,738 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-21' AND '2024-06-21' (base.py:2260)
2025-08-11 09:22:42,743 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-21 00:00:00, 2024-06-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,743 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,760 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,774 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-22 00:00:00, 2024-06-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,775 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-22' AND '2024-06-22' (base.py:2260)
2025-08-11 09:22:42,778 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-22' AND '2024-06-22' (base.py:2260)
2025-08-11 09:22:42,783 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-22 00:00:00, 2024-06-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,783 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,797 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,811 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-23 00:00:00, 2024-06-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,812 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-23' AND '2024-06-23' (base.py:2260)
2025-08-11 09:22:42,815 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-23' AND '2024-06-23' (base.py:2260)
2025-08-11 09:22:42,820 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-23 00:00:00, 2024-06-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,820 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,833 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,847 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-24 00:00:00, 2024-06-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,849 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-24' AND '2024-06-24' (base.py:2260)
2025-08-11 09:22:42,853 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-24' AND '2024-06-24' (base.py:2260)
2025-08-11 09:22:42,857 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-24 00:00:00, 2024-06-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,857 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,870 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,886 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-25 00:00:00, 2024-06-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,887 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-25' AND '2024-06-25' (base.py:2260)
2025-08-11 09:22:42,890 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-25' AND '2024-06-25' (base.py:2260)
2025-08-11 09:22:42,894 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-25 00:00:00, 2024-06-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,894 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,907 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,922 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-26 00:00:00, 2024-06-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,924 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-26' AND '2024-06-26' (base.py:2260)
2025-08-11 09:22:42,927 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-26' AND '2024-06-26' (base.py:2260)
2025-08-11 09:22:42,931 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-26 00:00:00, 2024-06-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,931 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,944 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,958 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-27 00:00:00, 2024-06-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:42,959 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-27' AND '2024-06-27' (base.py:2260)
2025-08-11 09:22:42,962 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-27' AND '2024-06-27' (base.py:2260)
2025-08-11 09:22:42,968 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-27 00:00:00, 2024-06-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:42,969 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:42,982 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:42,999 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-28 00:00:00, 2024-06-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,000 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-28' AND '2024-06-28' (base.py:2260)
2025-08-11 09:22:43,004 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-28' AND '2024-06-28' (base.py:2260)
2025-08-11 09:22:43,008 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-28 00:00:00, 2024-06-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,008 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,022 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,035 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-29 00:00:00, 2024-06-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,036 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-29' AND '2024-06-29' (base.py:2260)
2025-08-11 09:22:43,039 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-29' AND '2024-06-29' (base.py:2260)
2025-08-11 09:22:43,044 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-29 00:00:00, 2024-06-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,044 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,057 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,072 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-06-30 00:00:00, 2024-07-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,073 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-06-30' AND '2024-06-30' (base.py:2260)
2025-08-11 09:22:43,078 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-06-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-06-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-06-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-06-30' AND '2024-06-30' (base.py:2260)
2025-08-11 09:22:43,082 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-06-30 00:00:00, 2024-07-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,082 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,094 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,110 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-01 00:00:00, 2024-07-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,111 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-01' AND '2024-07-01' (base.py:2260)
2025-08-11 09:22:43,114 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-06-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-01' AND '2024-07-01' (base.py:2260)
2025-08-11 09:22:43,118 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-01 00:00:00, 2024-07-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,118 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,131 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,146 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-02 00:00:00, 2024-07-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,148 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-02' AND '2024-07-02' (base.py:2260)
2025-08-11 09:22:43,151 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-02' AND '2024-07-02' (base.py:2260)
2025-08-11 09:22:43,155 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-02 00:00:00, 2024-07-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,155 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,169 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,182 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-03 00:00:00, 2024-07-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,183 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-03' AND '2024-07-03' (base.py:2260)
2025-08-11 09:22:43,189 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-03' AND '2024-07-03' (base.py:2260)
2025-08-11 09:22:43,194 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-03 00:00:00, 2024-07-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,194 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,207 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,221 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-04 00:00:00, 2024-07-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,223 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-04' AND '2024-07-04' (base.py:2260)
2025-08-11 09:22:43,226 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-04' AND '2024-07-04' (base.py:2260)
2025-08-11 09:22:43,231 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-04 00:00:00, 2024-07-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,231 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,246 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,321 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-05 00:00:00, 2024-07-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,323 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-05' AND '2024-07-05' (base.py:2260)
2025-08-11 09:22:43,325 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-05' AND '2024-07-05' (base.py:2260)
2025-08-11 09:22:43,331 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-05 00:00:00, 2024-07-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,331 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,347 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,360 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-06 00:00:00, 2024-07-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,361 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-06' AND '2024-07-06' (base.py:2260)
2025-08-11 09:22:43,364 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-06' AND '2024-07-06' (base.py:2260)
2025-08-11 09:22:43,368 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-06 00:00:00, 2024-07-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,368 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,382 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,396 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-07 00:00:00, 2024-07-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,397 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-07' AND '2024-07-07' (base.py:2260)
2025-08-11 09:22:43,400 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-07' AND '2024-07-07' (base.py:2260)
2025-08-11 09:22:43,404 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-07 00:00:00, 2024-07-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,404 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,418 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,434 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-08 00:00:00, 2024-07-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,437 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-08' AND '2024-07-08' (base.py:2260)
2025-08-11 09:22:43,440 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-08' AND '2024-07-08' (base.py:2260)
2025-08-11 09:22:43,445 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-08 00:00:00, 2024-07-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,445 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,456 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,472 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-09 00:00:00, 2024-07-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,473 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-09' AND '2024-07-09' (base.py:2260)
2025-08-11 09:22:43,476 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-09' AND '2024-07-09' (base.py:2260)
2025-08-11 09:22:43,481 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-09 00:00:00, 2024-07-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,481 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,494 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,509 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-10 00:00:00, 2024-07-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,510 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-10' AND '2024-07-10' (base.py:2260)
2025-08-11 09:22:43,512 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-10' AND '2024-07-10' (base.py:2260)
2025-08-11 09:22:43,516 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-10 00:00:00, 2024-07-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,517 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,530 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,545 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-11 00:00:00, 2024-07-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,547 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-11' AND '2024-07-11' (base.py:2260)
2025-08-11 09:22:43,550 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-11' AND '2024-07-11' (base.py:2260)
2025-08-11 09:22:43,554 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-11 00:00:00, 2024-07-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,554 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,566 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,583 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-12 00:00:00, 2024-07-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,585 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-12' AND '2024-07-12' (base.py:2260)
2025-08-11 09:22:43,588 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-12' AND '2024-07-12' (base.py:2260)
2025-08-11 09:22:43,593 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-12 00:00:00, 2024-07-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,593 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,605 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,620 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-13 00:00:00, 2024-07-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,621 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-13' AND '2024-07-13' (base.py:2260)
2025-08-11 09:22:43,623 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-13' AND '2024-07-13' (base.py:2260)
2025-08-11 09:22:43,627 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-13 00:00:00, 2024-07-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,628 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,642 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,656 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-14 00:00:00, 2024-07-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,658 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-14' AND '2024-07-14' (base.py:2260)
2025-08-11 09:22:43,660 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-14' AND '2024-07-14' (base.py:2260)
2025-08-11 09:22:43,666 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-14 00:00:00, 2024-07-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,666 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,679 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,695 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-15 00:00:00, 2024-07-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,697 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-15' AND '2024-07-15' (base.py:2260)
2025-08-11 09:22:43,701 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-15' AND '2024-07-15' (base.py:2260)
2025-08-11 09:22:43,705 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-15 00:00:00, 2024-07-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,705 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,722 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,736 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-16 00:00:00, 2024-07-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,737 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-16' AND '2024-07-16' (base.py:2260)
2025-08-11 09:22:43,740 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-16' AND '2024-07-16' (base.py:2260)
2025-08-11 09:22:43,744 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-16 00:00:00, 2024-07-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,744 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,758 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,773 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-17 00:00:00, 2024-07-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,776 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-17' AND '2024-07-17' (base.py:2260)
2025-08-11 09:22:43,780 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-17' AND '2024-07-17' (base.py:2260)
2025-08-11 09:22:43,784 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-17 00:00:00, 2024-07-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,784 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,797 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,812 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-18 00:00:00, 2024-07-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,813 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-18' AND '2024-07-18' (base.py:2260)
2025-08-11 09:22:43,815 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-18' AND '2024-07-18' (base.py:2260)
2025-08-11 09:22:43,820 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-18 00:00:00, 2024-07-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,820 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,833 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,847 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-19 00:00:00, 2024-07-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,849 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-19' AND '2024-07-19' (base.py:2260)
2025-08-11 09:22:43,852 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-19' AND '2024-07-19' (base.py:2260)
2025-08-11 09:22:43,857 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-19 00:00:00, 2024-07-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,857 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,871 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,886 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-20 00:00:00, 2024-07-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,888 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-20' AND '2024-07-20' (base.py:2260)
2025-08-11 09:22:43,891 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-20' AND '2024-07-20' (base.py:2260)
2025-08-11 09:22:43,897 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-20 00:00:00, 2024-07-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,897 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,910 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,925 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-21 00:00:00, 2024-07-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,927 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-21' AND '2024-07-21' (base.py:2260)
2025-08-11 09:22:43,931 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-21' AND '2024-07-21' (base.py:2260)
2025-08-11 09:22:43,936 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-21 00:00:00, 2024-07-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,936 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,949 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:43,964 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-22 00:00:00, 2024-07-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:43,965 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-22' AND '2024-07-22' (base.py:2260)
2025-08-11 09:22:43,969 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-22' AND '2024-07-22' (base.py:2260)
2025-08-11 09:22:43,974 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-22 00:00:00, 2024-07-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:43,974 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:43,987 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,002 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-23 00:00:00, 2024-07-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,003 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-23' AND '2024-07-23' (base.py:2260)
2025-08-11 09:22:44,007 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-23' AND '2024-07-23' (base.py:2260)
2025-08-11 09:22:44,012 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-23 00:00:00, 2024-07-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,013 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,027 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,043 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-24 00:00:00, 2024-07-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,044 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-24' AND '2024-07-24' (base.py:2260)
2025-08-11 09:22:44,046 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-24' AND '2024-07-24' (base.py:2260)
2025-08-11 09:22:44,051 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-24 00:00:00, 2024-07-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,051 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,065 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,079 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-25 00:00:00, 2024-07-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,080 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-25' AND '2024-07-25' (base.py:2260)
2025-08-11 09:22:44,083 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-25' AND '2024-07-25' (base.py:2260)
2025-08-11 09:22:44,088 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-25 00:00:00, 2024-07-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,088 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,101 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,117 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-26 00:00:00, 2024-07-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,120 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-26' AND '2024-07-26' (base.py:2260)
2025-08-11 09:22:44,123 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-26' AND '2024-07-26' (base.py:2260)
2025-08-11 09:22:44,127 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-26 00:00:00, 2024-07-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,127 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,140 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,154 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-27 00:00:00, 2024-07-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,156 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-27' AND '2024-07-27' (base.py:2260)
2025-08-11 09:22:44,159 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-27' AND '2024-07-27' (base.py:2260)
2025-08-11 09:22:44,163 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-27 00:00:00, 2024-07-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,163 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,176 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,190 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-28 00:00:00, 2024-07-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,191 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-28' AND '2024-07-28' (base.py:2260)
2025-08-11 09:22:44,194 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-28' AND '2024-07-28' (base.py:2260)
2025-08-11 09:22:44,199 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-28 00:00:00, 2024-07-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,199 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,213 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,227 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-29 00:00:00, 2024-07-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,229 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-29' AND '2024-07-29' (base.py:2260)
2025-08-11 09:22:44,231 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-29' AND '2024-07-29' (base.py:2260)
2025-08-11 09:22:44,237 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-29 00:00:00, 2024-07-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,237 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,256 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,270 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-30 00:00:00, 2024-07-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,272 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-30' AND '2024-07-30' (base.py:2260)
2025-08-11 09:22:44,274 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-30' AND '2024-07-30' (base.py:2260)
2025-08-11 09:22:44,280 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-30 00:00:00, 2024-07-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,280 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,292 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,306 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-07-31 00:00:00, 2024-08-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,307 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-07-31' AND '2024-07-31' (base.py:2260)
2025-08-11 09:22:44,310 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-07-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-07-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-07-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-07-31' AND '2024-07-31' (base.py:2260)
2025-08-11 09:22:44,314 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-07-31 00:00:00, 2024-08-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,314 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,327 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,343 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-01 00:00:00, 2024-08-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,346 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-01' AND '2024-08-01' (base.py:2260)
2025-08-11 09:22:44,350 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-07-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-01' AND '2024-08-01' (base.py:2260)
2025-08-11 09:22:44,354 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-01 00:00:00, 2024-08-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,354 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,370 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,384 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-02 00:00:00, 2024-08-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,385 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-02' AND '2024-08-02' (base.py:2260)
2025-08-11 09:22:44,388 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-02' AND '2024-08-02' (base.py:2260)
2025-08-11 09:22:44,392 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-02 00:00:00, 2024-08-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,392 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,405 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,419 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-03 00:00:00, 2024-08-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,420 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-03' AND '2024-08-03' (base.py:2260)
2025-08-11 09:22:44,423 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-03' AND '2024-08-03' (base.py:2260)
2025-08-11 09:22:44,428 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-03 00:00:00, 2024-08-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,428 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,442 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,458 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-04 00:00:00, 2024-08-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,460 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-04' AND '2024-08-04' (base.py:2260)
2025-08-11 09:22:44,464 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-04' AND '2024-08-04' (base.py:2260)
2025-08-11 09:22:44,469 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-04 00:00:00, 2024-08-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,469 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,482 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,496 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-05 00:00:00, 2024-08-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,498 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-05' AND '2024-08-05' (base.py:2260)
2025-08-11 09:22:44,500 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-05' AND '2024-08-05' (base.py:2260)
2025-08-11 09:22:44,505 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-05 00:00:00, 2024-08-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,505 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,519 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,533 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-06 00:00:00, 2024-08-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,535 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-06' AND '2024-08-06' (base.py:2260)
2025-08-11 09:22:44,538 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-06' AND '2024-08-06' (base.py:2260)
2025-08-11 09:22:44,541 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-06 00:00:00, 2024-08-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,542 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,554 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,568 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-07 00:00:00, 2024-08-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,570 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-07' AND '2024-08-07' (base.py:2260)
2025-08-11 09:22:44,572 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-07' AND '2024-08-07' (base.py:2260)
2025-08-11 09:22:44,577 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-07 00:00:00, 2024-08-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,577 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,590 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,604 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-08 00:00:00, 2024-08-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,606 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-08' AND '2024-08-08' (base.py:2260)
2025-08-11 09:22:44,609 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-08' AND '2024-08-08' (base.py:2260)
2025-08-11 09:22:44,613 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-08 00:00:00, 2024-08-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,613 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,626 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,640 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-09 00:00:00, 2024-08-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,641 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-09' AND '2024-08-09' (base.py:2260)
2025-08-11 09:22:44,645 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-09' AND '2024-08-09' (base.py:2260)
2025-08-11 09:22:44,650 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-09 00:00:00, 2024-08-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,650 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,663 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,676 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-10 00:00:00, 2024-08-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,678 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-10' AND '2024-08-10' (base.py:2260)
2025-08-11 09:22:44,681 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-10' AND '2024-08-10' (base.py:2260)
2025-08-11 09:22:44,688 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-10 00:00:00, 2024-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,688 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,700 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,714 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-11 00:00:00, 2024-08-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,715 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-11' AND '2024-08-11' (base.py:2260)
2025-08-11 09:22:44,718 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-11' AND '2024-08-11' (base.py:2260)
2025-08-11 09:22:44,723 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-11 00:00:00, 2024-08-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,723 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,736 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,752 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-12 00:00:00, 2024-08-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,753 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-12' AND '2024-08-12' (base.py:2260)
2025-08-11 09:22:44,756 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-12' AND '2024-08-12' (base.py:2260)
2025-08-11 09:22:44,760 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-12 00:00:00, 2024-08-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,761 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,773 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,787 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-13 00:00:00, 2024-08-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,788 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-13' AND '2024-08-13' (base.py:2260)
2025-08-11 09:22:44,791 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-13' AND '2024-08-13' (base.py:2260)
2025-08-11 09:22:44,795 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-13 00:00:00, 2024-08-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,796 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,809 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,823 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-14 00:00:00, 2024-08-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,825 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-14' AND '2024-08-14' (base.py:2260)
2025-08-11 09:22:44,828 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-14' AND '2024-08-14' (base.py:2260)
2025-08-11 09:22:44,832 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-14 00:00:00, 2024-08-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,832 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,846 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,860 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-15 00:00:00, 2024-08-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,863 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-15' AND '2024-08-15' (base.py:2260)
2025-08-11 09:22:44,865 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-15' AND '2024-08-15' (base.py:2260)
2025-08-11 09:22:44,871 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-15 00:00:00, 2024-08-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,871 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,883 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,896 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-16 00:00:00, 2024-08-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,897 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-16' AND '2024-08-16' (base.py:2260)
2025-08-11 09:22:44,903 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-16' AND '2024-08-16' (base.py:2260)
2025-08-11 09:22:44,907 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-16 00:00:00, 2024-08-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,907 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,921 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,937 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-17 00:00:00, 2024-08-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,938 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-17' AND '2024-08-17' (base.py:2260)
2025-08-11 09:22:44,941 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-17' AND '2024-08-17' (base.py:2260)
2025-08-11 09:22:44,945 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-17 00:00:00, 2024-08-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,945 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,958 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:44,973 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-18 00:00:00, 2024-08-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:44,974 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-18' AND '2024-08-18' (base.py:2260)
2025-08-11 09:22:44,977 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-18' AND '2024-08-18' (base.py:2260)
2025-08-11 09:22:44,982 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-18 00:00:00, 2024-08-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:44,982 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:44,995 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,010 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-19 00:00:00, 2024-08-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,014 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-19' AND '2024-08-19' (base.py:2260)
2025-08-11 09:22:45,017 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-19' AND '2024-08-19' (base.py:2260)
2025-08-11 09:22:45,020 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-19 00:00:00, 2024-08-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,020 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,035 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,050 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-20 00:00:00, 2024-08-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,051 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-20' AND '2024-08-20' (base.py:2260)
2025-08-11 09:22:45,054 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-20' AND '2024-08-20' (base.py:2260)
2025-08-11 09:22:45,060 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-20 00:00:00, 2024-08-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,060 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,072 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,086 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-21 00:00:00, 2024-08-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,088 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-21' AND '2024-08-21' (base.py:2260)
2025-08-11 09:22:45,091 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-21' AND '2024-08-21' (base.py:2260)
2025-08-11 09:22:45,096 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-21 00:00:00, 2024-08-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,096 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,108 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,122 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-22 00:00:00, 2024-08-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,123 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-22' AND '2024-08-22' (base.py:2260)
2025-08-11 09:22:45,126 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-22' AND '2024-08-22' (base.py:2260)
2025-08-11 09:22:45,132 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-22 00:00:00, 2024-08-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,132 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,211 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,225 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-23 00:00:00, 2024-08-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,226 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-23' AND '2024-08-23' (base.py:2260)
2025-08-11 09:22:45,229 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-23' AND '2024-08-23' (base.py:2260)
2025-08-11 09:22:45,233 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-23 00:00:00, 2024-08-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,233 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,247 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,263 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-24 00:00:00, 2024-08-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,264 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-24' AND '2024-08-24' (base.py:2260)
2025-08-11 09:22:45,267 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-24' AND '2024-08-24' (base.py:2260)
2025-08-11 09:22:45,271 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-24 00:00:00, 2024-08-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,272 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,286 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,300 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-25 00:00:00, 2024-08-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,301 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-25' AND '2024-08-25' (base.py:2260)
2025-08-11 09:22:45,304 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-25' AND '2024-08-25' (base.py:2260)
2025-08-11 09:22:45,310 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-25 00:00:00, 2024-08-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,310 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,325 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,340 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-26 00:00:00, 2024-08-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,341 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-26' AND '2024-08-26' (base.py:2260)
2025-08-11 09:22:45,344 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-26' AND '2024-08-26' (base.py:2260)
2025-08-11 09:22:45,351 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-26 00:00:00, 2024-08-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,351 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,363 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,378 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-27 00:00:00, 2024-08-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,379 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-27' AND '2024-08-27' (base.py:2260)
2025-08-11 09:22:45,382 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-27' AND '2024-08-27' (base.py:2260)
2025-08-11 09:22:45,388 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-27 00:00:00, 2024-08-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,388 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,400 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,415 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-28 00:00:00, 2024-08-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,416 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-28' AND '2024-08-28' (base.py:2260)
2025-08-11 09:22:45,420 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-28' AND '2024-08-28' (base.py:2260)
2025-08-11 09:22:45,425 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-28 00:00:00, 2024-08-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,425 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,438 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,452 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-29 00:00:00, 2024-08-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,453 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-29' AND '2024-08-29' (base.py:2260)
2025-08-11 09:22:45,456 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-29' AND '2024-08-29' (base.py:2260)
2025-08-11 09:22:45,461 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-29 00:00:00, 2024-08-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,462 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,475 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,491 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-30 00:00:00, 2024-08-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,492 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-30' AND '2024-08-30' (base.py:2260)
2025-08-11 09:22:45,495 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-30' AND '2024-08-30' (base.py:2260)
2025-08-11 09:22:45,500 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-30 00:00:00, 2024-08-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,500 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,513 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,527 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-08-31 00:00:00, 2024-09-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,529 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-08-31' AND '2024-08-31' (base.py:2260)
2025-08-11 09:22:45,531 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-08-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-08-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-08-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-08-31' AND '2024-08-31' (base.py:2260)
2025-08-11 09:22:45,537 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-08-31 00:00:00, 2024-09-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,537 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,552 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,567 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-01 00:00:00, 2024-09-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,570 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-01' AND '2024-09-01' (base.py:2260)
2025-08-11 09:22:45,573 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-08-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-01' AND '2024-09-01' (base.py:2260)
2025-08-11 09:22:45,578 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-01 00:00:00, 2024-09-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,578 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,592 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,607 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-02 00:00:00, 2024-09-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,608 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-02' AND '2024-09-02' (base.py:2260)
2025-08-11 09:22:45,611 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-02' AND '2024-09-02' (base.py:2260)
2025-08-11 09:22:45,615 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-02 00:00:00, 2024-09-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,615 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,628 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,642 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-03 00:00:00, 2024-09-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,643 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-03' AND '2024-09-03' (base.py:2260)
2025-08-11 09:22:45,647 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-03' AND '2024-09-03' (base.py:2260)
2025-08-11 09:22:45,652 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-03 00:00:00, 2024-09-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,652 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,665 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,681 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-04 00:00:00, 2024-09-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,684 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-04' AND '2024-09-04' (base.py:2260)
2025-08-11 09:22:45,686 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-04' AND '2024-09-04' (base.py:2260)
2025-08-11 09:22:45,692 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-04 00:00:00, 2024-09-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,692 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,706 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,722 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-05 00:00:00, 2024-09-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,723 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-05' AND '2024-09-05' (base.py:2260)
2025-08-11 09:22:45,727 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-05' AND '2024-09-05' (base.py:2260)
2025-08-11 09:22:45,732 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-05 00:00:00, 2024-09-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,732 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,754 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,775 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-06 00:00:00, 2024-09-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,777 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-06' AND '2024-09-06' (base.py:2260)
2025-08-11 09:22:45,781 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-06' AND '2024-09-06' (base.py:2260)
2025-08-11 09:22:45,786 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-06 00:00:00, 2024-09-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,786 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,798 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,813 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-07 00:00:00, 2024-09-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,814 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-07' AND '2024-09-07' (base.py:2260)
2025-08-11 09:22:45,817 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-07' AND '2024-09-07' (base.py:2260)
2025-08-11 09:22:45,822 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-07 00:00:00, 2024-09-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,822 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,836 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,850 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-08 00:00:00, 2024-09-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,852 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-08' AND '2024-09-08' (base.py:2260)
2025-08-11 09:22:45,855 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-08' AND '2024-09-08' (base.py:2260)
2025-08-11 09:22:45,860 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-08 00:00:00, 2024-09-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,860 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,875 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,889 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-09 00:00:00, 2024-09-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,891 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-09' AND '2024-09-09' (base.py:2260)
2025-08-11 09:22:45,895 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-09' AND '2024-09-09' (base.py:2260)
2025-08-11 09:22:45,899 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-09 00:00:00, 2024-09-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,899 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,916 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,931 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-10 00:00:00, 2024-09-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,932 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-10' AND '2024-09-10' (base.py:2260)
2025-08-11 09:22:45,935 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-10' AND '2024-09-10' (base.py:2260)
2025-08-11 09:22:45,939 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-10 00:00:00, 2024-09-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,939 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,954 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:45,968 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-11 00:00:00, 2024-09-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:45,970 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-11' AND '2024-09-11' (base.py:2260)
2025-08-11 09:22:45,973 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-11' AND '2024-09-11' (base.py:2260)
2025-08-11 09:22:45,978 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-11 00:00:00, 2024-09-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:45,978 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:45,991 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,007 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-12 00:00:00, 2024-09-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,008 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-12' AND '2024-09-12' (base.py:2260)
2025-08-11 09:22:46,011 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-12' AND '2024-09-12' (base.py:2260)
2025-08-11 09:22:46,017 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-12 00:00:00, 2024-09-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,017 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,035 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,052 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-13 00:00:00, 2024-09-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,053 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-13' AND '2024-09-13' (base.py:2260)
2025-08-11 09:22:46,056 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-13' AND '2024-09-13' (base.py:2260)
2025-08-11 09:22:46,060 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-13 00:00:00, 2024-09-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,060 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,077 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,091 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-14 00:00:00, 2024-09-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,093 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-14' AND '2024-09-14' (base.py:2260)
2025-08-11 09:22:46,096 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-14' AND '2024-09-14' (base.py:2260)
2025-08-11 09:22:46,100 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-14 00:00:00, 2024-09-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,100 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,114 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,128 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-15 00:00:00, 2024-09-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,129 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-15' AND '2024-09-15' (base.py:2260)
2025-08-11 09:22:46,134 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-15' AND '2024-09-15' (base.py:2260)
2025-08-11 09:22:46,139 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-15 00:00:00, 2024-09-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,139 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,151 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,165 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-16 00:00:00, 2024-09-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,166 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-16' AND '2024-09-16' (base.py:2260)
2025-08-11 09:22:46,169 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-16' AND '2024-09-16' (base.py:2260)
2025-08-11 09:22:46,172 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-16 00:00:00, 2024-09-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,172 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,185 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,199 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-17 00:00:00, 2024-09-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,200 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-17' AND '2024-09-17' (base.py:2260)
2025-08-11 09:22:46,203 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-17' AND '2024-09-17' (base.py:2260)
2025-08-11 09:22:46,208 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-17 00:00:00, 2024-09-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,208 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,221 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,236 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-18 00:00:00, 2024-09-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,238 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-18' AND '2024-09-18' (base.py:2260)
2025-08-11 09:22:46,241 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-18' AND '2024-09-18' (base.py:2260)
2025-08-11 09:22:46,247 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-18 00:00:00, 2024-09-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,248 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,259 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,275 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-19 00:00:00, 2024-09-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,277 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-19' AND '2024-09-19' (base.py:2260)
2025-08-11 09:22:46,280 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-19' AND '2024-09-19' (base.py:2260)
2025-08-11 09:22:46,284 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-19 00:00:00, 2024-09-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,284 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,301 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,317 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-20 00:00:00, 2024-09-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,318 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-20' AND '2024-09-20' (base.py:2260)
2025-08-11 09:22:46,321 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-20' AND '2024-09-20' (base.py:2260)
2025-08-11 09:22:46,324 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-20 00:00:00, 2024-09-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,324 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,337 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,351 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-21 00:00:00, 2024-09-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,352 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-21' AND '2024-09-21' (base.py:2260)
2025-08-11 09:22:46,355 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-21' AND '2024-09-21' (base.py:2260)
2025-08-11 09:22:46,360 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-21 00:00:00, 2024-09-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,360 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,373 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,388 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-22 00:00:00, 2024-09-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,389 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-22' AND '2024-09-22' (base.py:2260)
2025-08-11 09:22:46,394 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-22' AND '2024-09-22' (base.py:2260)
2025-08-11 09:22:46,398 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-22 00:00:00, 2024-09-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,399 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,411 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,424 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-23 00:00:00, 2024-09-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,425 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-23' AND '2024-09-23' (base.py:2260)
2025-08-11 09:22:46,428 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-23' AND '2024-09-23' (base.py:2260)
2025-08-11 09:22:46,432 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-23 00:00:00, 2024-09-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,432 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,446 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,461 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-24 00:00:00, 2024-09-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,463 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-24' AND '2024-09-24' (base.py:2260)
2025-08-11 09:22:46,467 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-24' AND '2024-09-24' (base.py:2260)
2025-08-11 09:22:46,472 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-24 00:00:00, 2024-09-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,472 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,486 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,502 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-25 00:00:00, 2024-09-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,503 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-25' AND '2024-09-25' (base.py:2260)
2025-08-11 09:22:46,506 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-25' AND '2024-09-25' (base.py:2260)
2025-08-11 09:22:46,510 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-25 00:00:00, 2024-09-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,510 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,522 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,537 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-26 00:00:00, 2024-09-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,538 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-26' AND '2024-09-26' (base.py:2260)
2025-08-11 09:22:46,541 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-26' AND '2024-09-26' (base.py:2260)
2025-08-11 09:22:46,546 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-26 00:00:00, 2024-09-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,546 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,560 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,576 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-27 00:00:00, 2024-09-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,579 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-27' AND '2024-09-27' (base.py:2260)
2025-08-11 09:22:46,584 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-27' AND '2024-09-27' (base.py:2260)
2025-08-11 09:22:46,588 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-27 00:00:00, 2024-09-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,588 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,600 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,615 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-28 00:00:00, 2024-09-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,617 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-28' AND '2024-09-28' (base.py:2260)
2025-08-11 09:22:46,620 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-28' AND '2024-09-28' (base.py:2260)
2025-08-11 09:22:46,625 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-28 00:00:00, 2024-09-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,625 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,639 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,652 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-29 00:00:00, 2024-09-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,653 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-29' AND '2024-09-29' (base.py:2260)
2025-08-11 09:22:46,656 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-29' AND '2024-09-29' (base.py:2260)
2025-08-11 09:22:46,661 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-29 00:00:00, 2024-09-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,661 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,675 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,691 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-09-30 00:00:00, 2024-10-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,692 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-09-30' AND '2024-09-30' (base.py:2260)
2025-08-11 09:22:46,696 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-09-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-09-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-09-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-09-30' AND '2024-09-30' (base.py:2260)
2025-08-11 09:22:46,701 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-09-30 00:00:00, 2024-10-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,701 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,715 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,731 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-01 00:00:00, 2024-10-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,732 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-01' AND '2024-10-01' (base.py:2260)
2025-08-11 09:22:46,735 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-09-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-01' AND '2024-10-01' (base.py:2260)
2025-08-11 09:22:46,739 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-01 00:00:00, 2024-10-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,739 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,752 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,767 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-02 00:00:00, 2024-10-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,768 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-02' AND '2024-10-02' (base.py:2260)
2025-08-11 09:22:46,771 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-02' AND '2024-10-02' (base.py:2260)
2025-08-11 09:22:46,775 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-02 00:00:00, 2024-10-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,775 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,788 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,804 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-03 00:00:00, 2024-10-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,806 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-03' AND '2024-10-03' (base.py:2260)
2025-08-11 09:22:46,811 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-03' AND '2024-10-03' (base.py:2260)
2025-08-11 09:22:46,816 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-03 00:00:00, 2024-10-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,816 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,829 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,844 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-04 00:00:00, 2024-10-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,846 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-04' AND '2024-10-04' (base.py:2260)
2025-08-11 09:22:46,849 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-04' AND '2024-10-04' (base.py:2260)
2025-08-11 09:22:46,854 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-04 00:00:00, 2024-10-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,854 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,868 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,882 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-05 00:00:00, 2024-10-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,883 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-05' AND '2024-10-05' (base.py:2260)
2025-08-11 09:22:46,886 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-05' AND '2024-10-05' (base.py:2260)
2025-08-11 09:22:46,891 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-05 00:00:00, 2024-10-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,891 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,907 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,920 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-06 00:00:00, 2024-10-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,922 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-06' AND '2024-10-06' (base.py:2260)
2025-08-11 09:22:46,924 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-06' AND '2024-10-06' (base.py:2260)
2025-08-11 09:22:46,932 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-06 00:00:00, 2024-10-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,932 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,946 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,963 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-07 00:00:00, 2024-10-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:46,964 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-07' AND '2024-10-07' (base.py:2260)
2025-08-11 09:22:46,967 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-07' AND '2024-10-07' (base.py:2260)
2025-08-11 09:22:46,972 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-07 00:00:00, 2024-10-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:46,972 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:46,984 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:46,999 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-08 00:00:00, 2024-10-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,000 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-08' AND '2024-10-08' (base.py:2260)
2025-08-11 09:22:47,003 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-08' AND '2024-10-08' (base.py:2260)
2025-08-11 09:22:47,007 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-08 00:00:00, 2024-10-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,007 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,022 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,036 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-09 00:00:00, 2024-10-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,039 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-09' AND '2024-10-09' (base.py:2260)
2025-08-11 09:22:47,043 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-09' AND '2024-10-09' (base.py:2260)
2025-08-11 09:22:47,047 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-09 00:00:00, 2024-10-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,047 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,060 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,075 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-10 00:00:00, 2024-10-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,076 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-10' AND '2024-10-10' (base.py:2260)
2025-08-11 09:22:47,080 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-10' AND '2024-10-10' (base.py:2260)
2025-08-11 09:22:47,084 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-10 00:00:00, 2024-10-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,084 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,098 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,111 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-11 00:00:00, 2024-10-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,112 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-11' AND '2024-10-11' (base.py:2260)
2025-08-11 09:22:47,115 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-11' AND '2024-10-11' (base.py:2260)
2025-08-11 09:22:47,119 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-11 00:00:00, 2024-10-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,119 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,134 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,221 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-12 00:00:00, 2024-10-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,223 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-12' AND '2024-10-12' (base.py:2260)
2025-08-11 09:22:47,226 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-12' AND '2024-10-12' (base.py:2260)
2025-08-11 09:22:47,232 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-12 00:00:00, 2024-10-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,232 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,245 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,259 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-13 00:00:00, 2024-10-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,261 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-13' AND '2024-10-13' (base.py:2260)
2025-08-11 09:22:47,264 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-13' AND '2024-10-13' (base.py:2260)
2025-08-11 09:22:47,269 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-13 00:00:00, 2024-10-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,269 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,281 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,297 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-14 00:00:00, 2024-10-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,298 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-14' AND '2024-10-14' (base.py:2260)
2025-08-11 09:22:47,301 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-14' AND '2024-10-14' (base.py:2260)
2025-08-11 09:22:47,305 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-14 00:00:00, 2024-10-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,306 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,321 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,335 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-15 00:00:00, 2024-10-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,338 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-15' AND '2024-10-15' (base.py:2260)
2025-08-11 09:22:47,342 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-15' AND '2024-10-15' (base.py:2260)
2025-08-11 09:22:47,345 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-15 00:00:00, 2024-10-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,345 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,358 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,372 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-16 00:00:00, 2024-10-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,373 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-16' AND '2024-10-16' (base.py:2260)
2025-08-11 09:22:47,376 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-16' AND '2024-10-16' (base.py:2260)
2025-08-11 09:22:47,380 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-16 00:00:00, 2024-10-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,380 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,394 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,408 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-17 00:00:00, 2024-10-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,409 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-17' AND '2024-10-17' (base.py:2260)
2025-08-11 09:22:47,412 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-17' AND '2024-10-17' (base.py:2260)
2025-08-11 09:22:47,417 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-17 00:00:00, 2024-10-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,418 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,432 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,447 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-18 00:00:00, 2024-10-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,449 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-18' AND '2024-10-18' (base.py:2260)
2025-08-11 09:22:47,452 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-18' AND '2024-10-18' (base.py:2260)
2025-08-11 09:22:47,456 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-18 00:00:00, 2024-10-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,456 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,468 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,483 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-19 00:00:00, 2024-10-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,485 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-19' AND '2024-10-19' (base.py:2260)
2025-08-11 09:22:47,488 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-19' AND '2024-10-19' (base.py:2260)
2025-08-11 09:22:47,493 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-19 00:00:00, 2024-10-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,493 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,506 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,520 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-20 00:00:00, 2024-10-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,521 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-20' AND '2024-10-20' (base.py:2260)
2025-08-11 09:22:47,525 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-20' AND '2024-10-20' (base.py:2260)
2025-08-11 09:22:47,529 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-20 00:00:00, 2024-10-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,529 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,542 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,557 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-21 00:00:00, 2024-10-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,559 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-21' AND '2024-10-21' (base.py:2260)
2025-08-11 09:22:47,562 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-21' AND '2024-10-21' (base.py:2260)
2025-08-11 09:22:47,568 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-21 00:00:00, 2024-10-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,568 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,582 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,597 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-22 00:00:00, 2024-10-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,599 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-22' AND '2024-10-22' (base.py:2260)
2025-08-11 09:22:47,604 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-22' AND '2024-10-22' (base.py:2260)
2025-08-11 09:22:47,608 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-22 00:00:00, 2024-10-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,608 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,622 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,636 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-23 00:00:00, 2024-10-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,637 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-23' AND '2024-10-23' (base.py:2260)
2025-08-11 09:22:47,640 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-23' AND '2024-10-23' (base.py:2260)
2025-08-11 09:22:47,644 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-23 00:00:00, 2024-10-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,644 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,658 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,673 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-24 00:00:00, 2024-10-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,674 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-24' AND '2024-10-24' (base.py:2260)
2025-08-11 09:22:47,678 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-24' AND '2024-10-24' (base.py:2260)
2025-08-11 09:22:47,683 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-24 00:00:00, 2024-10-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,683 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,695 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,712 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-25 00:00:00, 2024-10-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,713 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-25' AND '2024-10-25' (base.py:2260)
2025-08-11 09:22:47,716 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-25' AND '2024-10-25' (base.py:2260)
2025-08-11 09:22:47,720 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-25 00:00:00, 2024-10-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,720 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,734 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,750 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-26 00:00:00, 2024-10-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,751 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-26' AND '2024-10-26' (base.py:2260)
2025-08-11 09:22:47,754 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-26' AND '2024-10-26' (base.py:2260)
2025-08-11 09:22:47,759 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-26 00:00:00, 2024-10-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,759 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,772 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,788 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-27 00:00:00, 2024-10-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,791 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-27' AND '2024-10-27' (base.py:2260)
2025-08-11 09:22:47,794 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-27' AND '2024-10-27' (base.py:2260)
2025-08-11 09:22:47,798 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-27 00:00:00, 2024-10-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,798 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,811 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,825 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-28 00:00:00, 2024-10-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,826 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-28' AND '2024-10-28' (base.py:2260)
2025-08-11 09:22:47,830 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-28' AND '2024-10-28' (base.py:2260)
2025-08-11 09:22:47,835 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-28 00:00:00, 2024-10-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,835 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,848 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,861 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-29 00:00:00, 2024-10-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,862 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-29' AND '2024-10-29' (base.py:2260)
2025-08-11 09:22:47,866 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-29' AND '2024-10-29' (base.py:2260)
2025-08-11 09:22:47,871 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-29 00:00:00, 2024-10-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,871 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,884 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,897 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-30 00:00:00, 2024-10-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,899 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-30' AND '2024-10-30' (base.py:2260)
2025-08-11 09:22:47,901 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-30' AND '2024-10-30' (base.py:2260)
2025-08-11 09:22:47,906 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-30 00:00:00, 2024-10-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,906 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,919 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,936 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-10-31 00:00:00, 2024-11-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,938 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-10-31' AND '2024-10-31' (base.py:2260)
2025-08-11 09:22:47,941 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-10-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-10-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-10-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-10-31' AND '2024-10-31' (base.py:2260)
2025-08-11 09:22:47,946 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-10-31 00:00:00, 2024-11-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,946 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:47,960 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:47,980 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-01 00:00:00, 2024-11-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:47,981 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-01' AND '2024-11-01' (base.py:2260)
2025-08-11 09:22:47,985 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-10-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-01' AND '2024-11-01' (base.py:2260)
2025-08-11 09:22:47,990 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-01 00:00:00, 2024-11-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:47,990 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,003 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,019 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-02 00:00:00, 2024-11-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,022 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-02' AND '2024-11-02' (base.py:2260)
2025-08-11 09:22:48,025 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-02' AND '2024-11-02' (base.py:2260)
2025-08-11 09:22:48,030 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-02 00:00:00, 2024-11-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,031 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,043 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,058 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-03 00:00:00, 2024-11-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,060 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-03' AND '2024-11-03' (base.py:2260)
2025-08-11 09:22:48,062 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-03' AND '2024-11-03' (base.py:2260)
2025-08-11 09:22:48,067 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-03 00:00:00, 2024-11-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,067 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,083 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,101 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-04 00:00:00, 2024-11-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,102 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-04' AND '2024-11-04' (base.py:2260)
2025-08-11 09:22:48,107 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-04' AND '2024-11-04' (base.py:2260)
2025-08-11 09:22:48,111 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-04 00:00:00, 2024-11-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,111 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,123 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,139 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-05 00:00:00, 2024-11-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,142 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-05' AND '2024-11-05' (base.py:2260)
2025-08-11 09:22:48,146 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-05' AND '2024-11-05' (base.py:2260)
2025-08-11 09:22:48,151 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-05 00:00:00, 2024-11-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,151 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,166 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,180 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-06 00:00:00, 2024-11-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,181 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-06' AND '2024-11-06' (base.py:2260)
2025-08-11 09:22:48,184 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-06' AND '2024-11-06' (base.py:2260)
2025-08-11 09:22:48,189 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-06 00:00:00, 2024-11-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,189 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,206 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,223 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-07 00:00:00, 2024-11-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,224 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-07' AND '2024-11-07' (base.py:2260)
2025-08-11 09:22:48,227 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-07' AND '2024-11-07' (base.py:2260)
2025-08-11 09:22:48,232 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-07 00:00:00, 2024-11-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,232 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,247 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,266 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-08 00:00:00, 2024-11-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,267 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-08' AND '2024-11-08' (base.py:2260)
2025-08-11 09:22:48,270 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-08' AND '2024-11-08' (base.py:2260)
2025-08-11 09:22:48,275 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-08 00:00:00, 2024-11-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,275 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,290 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,313 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-09 00:00:00, 2024-11-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,315 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-09' AND '2024-11-09' (base.py:2260)
2025-08-11 09:22:48,318 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-09' AND '2024-11-09' (base.py:2260)
2025-08-11 09:22:48,324 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-09 00:00:00, 2024-11-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,324 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,339 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,356 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-10 00:00:00, 2024-11-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,357 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-10' AND '2024-11-10' (base.py:2260)
2025-08-11 09:22:48,363 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-10' AND '2024-11-10' (base.py:2260)
2025-08-11 09:22:48,368 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-10 00:00:00, 2024-11-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,368 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,384 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,399 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-11 00:00:00, 2024-11-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,400 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-11' AND '2024-11-11' (base.py:2260)
2025-08-11 09:22:48,403 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-11' AND '2024-11-11' (base.py:2260)
2025-08-11 09:22:48,407 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-11 00:00:00, 2024-11-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,407 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,422 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,436 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-12 00:00:00, 2024-11-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,437 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-12' AND '2024-11-12' (base.py:2260)
2025-08-11 09:22:48,441 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-12' AND '2024-11-12' (base.py:2260)
2025-08-11 09:22:48,446 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-12 00:00:00, 2024-11-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,446 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,461 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,477 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-13 00:00:00, 2024-11-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,480 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-13' AND '2024-11-13' (base.py:2260)
2025-08-11 09:22:48,484 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-13' AND '2024-11-13' (base.py:2260)
2025-08-11 09:22:48,489 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-13 00:00:00, 2024-11-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,489 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,503 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,518 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-14 00:00:00, 2024-11-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,519 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-14' AND '2024-11-14' (base.py:2260)
2025-08-11 09:22:48,522 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-14' AND '2024-11-14' (base.py:2260)
2025-08-11 09:22:48,526 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-14 00:00:00, 2024-11-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,526 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,539 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,555 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-15 00:00:00, 2024-11-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,557 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-15' AND '2024-11-15' (base.py:2260)
2025-08-11 09:22:48,560 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-15' AND '2024-11-15' (base.py:2260)
2025-08-11 09:22:48,564 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-15 00:00:00, 2024-11-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,564 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,579 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,594 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-16 00:00:00, 2024-11-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,597 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-16' AND '2024-11-16' (base.py:2260)
2025-08-11 09:22:48,601 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-16' AND '2024-11-16' (base.py:2260)
2025-08-11 09:22:48,605 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-16 00:00:00, 2024-11-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,605 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,618 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,634 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-17 00:00:00, 2024-11-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,635 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-17' AND '2024-11-17' (base.py:2260)
2025-08-11 09:22:48,638 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-17' AND '2024-11-17' (base.py:2260)
2025-08-11 09:22:48,644 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-17 00:00:00, 2024-11-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,644 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,661 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,677 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-18 00:00:00, 2024-11-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,678 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-18' AND '2024-11-18' (base.py:2260)
2025-08-11 09:22:48,682 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-18' AND '2024-11-18' (base.py:2260)
2025-08-11 09:22:48,687 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-18 00:00:00, 2024-11-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,687 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,701 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,720 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-19 00:00:00, 2024-11-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,723 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-19' AND '2024-11-19' (base.py:2260)
2025-08-11 09:22:48,725 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-19' AND '2024-11-19' (base.py:2260)
2025-08-11 09:22:48,730 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-19 00:00:00, 2024-11-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,730 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,744 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,760 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-20 00:00:00, 2024-11-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,762 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-20' AND '2024-11-20' (base.py:2260)
2025-08-11 09:22:48,765 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-20' AND '2024-11-20' (base.py:2260)
2025-08-11 09:22:48,771 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-20 00:00:00, 2024-11-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,771 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,785 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,799 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-21 00:00:00, 2024-11-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,802 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-21' AND '2024-11-21' (base.py:2260)
2025-08-11 09:22:48,805 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-21' AND '2024-11-21' (base.py:2260)
2025-08-11 09:22:48,811 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-21 00:00:00, 2024-11-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,811 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,823 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,839 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-22 00:00:00, 2024-11-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,842 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-22' AND '2024-11-22' (base.py:2260)
2025-08-11 09:22:48,847 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-22' AND '2024-11-22' (base.py:2260)
2025-08-11 09:22:48,851 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-22 00:00:00, 2024-11-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,852 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,863 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,878 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-23 00:00:00, 2024-11-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,880 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-23' AND '2024-11-23' (base.py:2260)
2025-08-11 09:22:48,883 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-23' AND '2024-11-23' (base.py:2260)
2025-08-11 09:22:48,888 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-23 00:00:00, 2024-11-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,888 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,900 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,914 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-24 00:00:00, 2024-11-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,916 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-24' AND '2024-11-24' (base.py:2260)
2025-08-11 09:22:48,919 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-24' AND '2024-11-24' (base.py:2260)
2025-08-11 09:22:48,924 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-24 00:00:00, 2024-11-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,924 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,937 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,952 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-25 00:00:00, 2024-11-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,955 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-25' AND '2024-11-25' (base.py:2260)
2025-08-11 09:22:48,958 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-25' AND '2024-11-25' (base.py:2260)
2025-08-11 09:22:48,963 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-25 00:00:00, 2024-11-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:48,963 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:48,977 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:48,993 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-26 00:00:00, 2024-11-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:48,994 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-26' AND '2024-11-26' (base.py:2260)
2025-08-11 09:22:48,997 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-26' AND '2024-11-26' (base.py:2260)
2025-08-11 09:22:49,002 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-26 00:00:00, 2024-11-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,002 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,015 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,029 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-27 00:00:00, 2024-11-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,031 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-27' AND '2024-11-27' (base.py:2260)
2025-08-11 09:22:49,035 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-27' AND '2024-11-27' (base.py:2260)
2025-08-11 09:22:49,039 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-27 00:00:00, 2024-11-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,039 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,050 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,065 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-28 00:00:00, 2024-11-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,068 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-28' AND '2024-11-28' (base.py:2260)
2025-08-11 09:22:49,072 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-28' AND '2024-11-28' (base.py:2260)
2025-08-11 09:22:49,075 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-28 00:00:00, 2024-11-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,075 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,090 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,107 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-29 00:00:00, 2024-11-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,108 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-29' AND '2024-11-29' (base.py:2260)
2025-08-11 09:22:49,111 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-29' AND '2024-11-29' (base.py:2260)
2025-08-11 09:22:49,116 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-29 00:00:00, 2024-11-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,117 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,131 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,145 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-11-30 00:00:00, 2024-12-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,146 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-11-30' AND '2024-11-30' (base.py:2260)
2025-08-11 09:22:49,149 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-11-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-11-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-11-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-11-30' AND '2024-11-30' (base.py:2260)
2025-08-11 09:22:49,154 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-11-30 00:00:00, 2024-12-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,154 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,167 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,183 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-01 00:00:00, 2024-12-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,184 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-01' AND '2024-12-01' (base.py:2260)
2025-08-11 09:22:49,188 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-11-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-01' AND '2024-12-01' (base.py:2260)
2025-08-11 09:22:49,193 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-01 00:00:00, 2024-12-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,193 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,206 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,222 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-02 00:00:00, 2024-12-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,289 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-02' AND '2024-12-02' (base.py:2260)
2025-08-11 09:22:49,293 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-02' AND '2024-12-02' (base.py:2260)
2025-08-11 09:22:49,298 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-02 00:00:00, 2024-12-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,298 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,311 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,326 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-03 00:00:00, 2024-12-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,327 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-03' AND '2024-12-03' (base.py:2260)
2025-08-11 09:22:49,330 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-03' AND '2024-12-03' (base.py:2260)
2025-08-11 09:22:49,334 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-03 00:00:00, 2024-12-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,334 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,348 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,362 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-04 00:00:00, 2024-12-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,363 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-04' AND '2024-12-04' (base.py:2260)
2025-08-11 09:22:49,366 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-04' AND '2024-12-04' (base.py:2260)
2025-08-11 09:22:49,370 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-04 00:00:00, 2024-12-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,370 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,385 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,398 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-05 00:00:00, 2024-12-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,399 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-05' AND '2024-12-05' (base.py:2260)
2025-08-11 09:22:49,403 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-05' AND '2024-12-05' (base.py:2260)
2025-08-11 09:22:49,407 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-05 00:00:00, 2024-12-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,407 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,421 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,436 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-06 00:00:00, 2024-12-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,438 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-06' AND '2024-12-06' (base.py:2260)
2025-08-11 09:22:49,440 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-06' AND '2024-12-06' (base.py:2260)
2025-08-11 09:22:49,445 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-06 00:00:00, 2024-12-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,445 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,460 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,474 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-07 00:00:00, 2024-12-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,475 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-07' AND '2024-12-07' (base.py:2260)
2025-08-11 09:22:49,478 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-07' AND '2024-12-07' (base.py:2260)
2025-08-11 09:22:49,483 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-07 00:00:00, 2024-12-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,483 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,496 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,512 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-08 00:00:00, 2024-12-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,513 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-08' AND '2024-12-08' (base.py:2260)
2025-08-11 09:22:49,517 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-08' AND '2024-12-08' (base.py:2260)
2025-08-11 09:22:49,523 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-08 00:00:00, 2024-12-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,523 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,536 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,550 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-09 00:00:00, 2024-12-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,552 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-09' AND '2024-12-09' (base.py:2260)
2025-08-11 09:22:49,556 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-09' AND '2024-12-09' (base.py:2260)
2025-08-11 09:22:49,560 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-09 00:00:00, 2024-12-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,560 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,574 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,589 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-10 00:00:00, 2024-12-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,590 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-10' AND '2024-12-10' (base.py:2260)
2025-08-11 09:22:49,593 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-10' AND '2024-12-10' (base.py:2260)
2025-08-11 09:22:49,598 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-10 00:00:00, 2024-12-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,598 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,612 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,625 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-11 00:00:00, 2024-12-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,626 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-11' AND '2024-12-11' (base.py:2260)
2025-08-11 09:22:49,629 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-11' AND '2024-12-11' (base.py:2260)
2025-08-11 09:22:49,634 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-11 00:00:00, 2024-12-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,635 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,648 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,665 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-12 00:00:00, 2024-12-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,666 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-12' AND '2024-12-12' (base.py:2260)
2025-08-11 09:22:49,669 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-12' AND '2024-12-12' (base.py:2260)
2025-08-11 09:22:49,674 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-12 00:00:00, 2024-12-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,674 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,686 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,703 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-13 00:00:00, 2024-12-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,704 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-13' AND '2024-12-13' (base.py:2260)
2025-08-11 09:22:49,707 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-13' AND '2024-12-13' (base.py:2260)
2025-08-11 09:22:49,711 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-13 00:00:00, 2024-12-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,711 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,726 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,742 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-14 00:00:00, 2024-12-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,745 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-14' AND '2024-12-14' (base.py:2260)
2025-08-11 09:22:49,748 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-14' AND '2024-12-14' (base.py:2260)
2025-08-11 09:22:49,754 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-14 00:00:00, 2024-12-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,754 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,769 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,783 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-15 00:00:00, 2024-12-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,785 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-15' AND '2024-12-15' (base.py:2260)
2025-08-11 09:22:49,788 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-15' AND '2024-12-15' (base.py:2260)
2025-08-11 09:22:49,793 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-15 00:00:00, 2024-12-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,793 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,810 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,823 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-16 00:00:00, 2024-12-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,824 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-16' AND '2024-12-16' (base.py:2260)
2025-08-11 09:22:49,828 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-16' AND '2024-12-16' (base.py:2260)
2025-08-11 09:22:49,832 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-16 00:00:00, 2024-12-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,832 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,846 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,861 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-17 00:00:00, 2024-12-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,863 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-17' AND '2024-12-17' (base.py:2260)
2025-08-11 09:22:49,867 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-17' AND '2024-12-17' (base.py:2260)
2025-08-11 09:22:49,872 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-17 00:00:00, 2024-12-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,872 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,888 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,902 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-18 00:00:00, 2024-12-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,903 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-18' AND '2024-12-18' (base.py:2260)
2025-08-11 09:22:49,906 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-18' AND '2024-12-18' (base.py:2260)
2025-08-11 09:22:49,910 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-18 00:00:00, 2024-12-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,910 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,924 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,939 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-19 00:00:00, 2024-12-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,940 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-19' AND '2024-12-19' (base.py:2260)
2025-08-11 09:22:49,943 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-19' AND '2024-12-19' (base.py:2260)
2025-08-11 09:22:49,948 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-19 00:00:00, 2024-12-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,949 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:49,961 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:49,976 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-20 00:00:00, 2024-12-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:49,979 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-20' AND '2024-12-20' (base.py:2260)
2025-08-11 09:22:49,982 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-20' AND '2024-12-20' (base.py:2260)
2025-08-11 09:22:49,988 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-20 00:00:00, 2024-12-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:49,988 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,000 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,016 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-21 00:00:00, 2024-12-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,018 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-21' AND '2024-12-21' (base.py:2260)
2025-08-11 09:22:50,021 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-21' AND '2024-12-21' (base.py:2260)
2025-08-11 09:22:50,026 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-21 00:00:00, 2024-12-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,026 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,040 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,054 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-22 00:00:00, 2024-12-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,055 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-22' AND '2024-12-22' (base.py:2260)
2025-08-11 09:22:50,058 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-22' AND '2024-12-22' (base.py:2260)
2025-08-11 09:22:50,063 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-22 00:00:00, 2024-12-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,063 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,077 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,091 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-23 00:00:00, 2024-12-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,092 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-23' AND '2024-12-23' (base.py:2260)
2025-08-11 09:22:50,096 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-23' AND '2024-12-23' (base.py:2260)
2025-08-11 09:22:50,101 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-23 00:00:00, 2024-12-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,101 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,116 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,131 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-24 00:00:00, 2024-12-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,132 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-24' AND '2024-12-24' (base.py:2260)
2025-08-11 09:22:50,135 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-24' AND '2024-12-24' (base.py:2260)
2025-08-11 09:22:50,139 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-24 00:00:00, 2024-12-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,139 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,152 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,167 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-25 00:00:00, 2024-12-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,168 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-25' AND '2024-12-25' (base.py:2260)
2025-08-11 09:22:50,171 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-25' AND '2024-12-25' (base.py:2260)
2025-08-11 09:22:50,176 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-25 00:00:00, 2024-12-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,176 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,190 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,204 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-26 00:00:00, 2024-12-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,207 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-26' AND '2024-12-26' (base.py:2260)
2025-08-11 09:22:50,210 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-26' AND '2024-12-26' (base.py:2260)
2025-08-11 09:22:50,215 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-26 00:00:00, 2024-12-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,215 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,227 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,242 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-27 00:00:00, 2024-12-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,244 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-27' AND '2024-12-27' (base.py:2260)
2025-08-11 09:22:50,247 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-27' AND '2024-12-27' (base.py:2260)
2025-08-11 09:22:50,252 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-27 00:00:00, 2024-12-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,252 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,265 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,279 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-28 00:00:00, 2024-12-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,280 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-28' AND '2024-12-28' (base.py:2260)
2025-08-11 09:22:50,283 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-28' AND '2024-12-28' (base.py:2260)
2025-08-11 09:22:50,289 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-28 00:00:00, 2024-12-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,289 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,304 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,320 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-29 00:00:00, 2024-12-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,321 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-29' AND '2024-12-29' (base.py:2260)
2025-08-11 09:22:50,325 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-29' AND '2024-12-29' (base.py:2260)
2025-08-11 09:22:50,329 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-29 00:00:00, 2024-12-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,329 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,344 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,360 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-30 00:00:00, 2024-12-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,361 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-30' AND '2024-12-30' (base.py:2260)
2025-08-11 09:22:50,364 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-30' AND '2024-12-30' (base.py:2260)
2025-08-11 09:22:50,368 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-30 00:00:00, 2024-12-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,368 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,383 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,397 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2024-12-31 00:00:00, 2025-01-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,398 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2024-12-31' AND '2024-12-31' (base.py:2260)
2025-08-11 09:22:50,401 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2024-12-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2024-12-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2024-12-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2024-12-31' AND '2024-12-31' (base.py:2260)
2025-08-11 09:22:50,405 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2024-12-31 00:00:00, 2025-01-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,405 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,420 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,436 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-01 00:00:00, 2025-01-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,437 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-01' AND '2025-01-01' (base.py:2260)
2025-08-11 09:22:50,442 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2024-12-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-01' AND '2025-01-01' (base.py:2260)
2025-08-11 09:22:50,447 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-01 00:00:00, 2025-01-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,447 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,459 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,473 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-02 00:00:00, 2025-01-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,475 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-02' AND '2025-01-02' (base.py:2260)
2025-08-11 09:22:50,478 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-02' AND '2025-01-02' (base.py:2260)
2025-08-11 09:22:50,482 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-02 00:00:00, 2025-01-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,482 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,496 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,511 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-03 00:00:00, 2025-01-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,512 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-03' AND '2025-01-03' (base.py:2260)
2025-08-11 09:22:50,516 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-03' AND '2025-01-03' (base.py:2260)
2025-08-11 09:22:50,520 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-03 00:00:00, 2025-01-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,520 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,538 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,553 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-04 00:00:00, 2025-01-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,556 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-04' AND '2025-01-04' (base.py:2260)
2025-08-11 09:22:50,559 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-04' AND '2025-01-04' (base.py:2260)
2025-08-11 09:22:50,563 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-04 00:00:00, 2025-01-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,563 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,576 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,591 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-05 00:00:00, 2025-01-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,592 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-05' AND '2025-01-05' (base.py:2260)
2025-08-11 09:22:50,594 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-05' AND '2025-01-05' (base.py:2260)
2025-08-11 09:22:50,599 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-05 00:00:00, 2025-01-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,599 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,614 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,631 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-06 00:00:00, 2025-01-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,633 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-06' AND '2025-01-06' (base.py:2260)
2025-08-11 09:22:50,636 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-06' AND '2025-01-06' (base.py:2260)
2025-08-11 09:22:50,640 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-06 00:00:00, 2025-01-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,640 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,652 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,668 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-07 00:00:00, 2025-01-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,669 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-07' AND '2025-01-07' (base.py:2260)
2025-08-11 09:22:50,673 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-07' AND '2025-01-07' (base.py:2260)
2025-08-11 09:22:50,677 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-07 00:00:00, 2025-01-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,677 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,691 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,706 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-08 00:00:00, 2025-01-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,709 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-08' AND '2025-01-08' (base.py:2260)
2025-08-11 09:22:50,712 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-08' AND '2025-01-08' (base.py:2260)
2025-08-11 09:22:50,716 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-08 00:00:00, 2025-01-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,716 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,728 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,741 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-09 00:00:00, 2025-01-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,743 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-09' AND '2025-01-09' (base.py:2260)
2025-08-11 09:22:50,747 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-09' AND '2025-01-09' (base.py:2260)
2025-08-11 09:22:50,752 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-09 00:00:00, 2025-01-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,752 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,766 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,780 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-10 00:00:00, 2025-01-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,781 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-10' AND '2025-01-10' (base.py:2260)
2025-08-11 09:22:50,786 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-10' AND '2025-01-10' (base.py:2260)
2025-08-11 09:22:50,791 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-10 00:00:00, 2025-01-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,791 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,805 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,819 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-11 00:00:00, 2025-01-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,820 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-11' AND '2025-01-11' (base.py:2260)
2025-08-11 09:22:50,823 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-11' AND '2025-01-11' (base.py:2260)
2025-08-11 09:22:50,827 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-11 00:00:00, 2025-01-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,827 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,842 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,857 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-12 00:00:00, 2025-01-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,858 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-12' AND '2025-01-12' (base.py:2260)
2025-08-11 09:22:50,861 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-12' AND '2025-01-12' (base.py:2260)
2025-08-11 09:22:50,866 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-12 00:00:00, 2025-01-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,866 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,879 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,894 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-13 00:00:00, 2025-01-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,896 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-13' AND '2025-01-13' (base.py:2260)
2025-08-11 09:22:50,900 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-13' AND '2025-01-13' (base.py:2260)
2025-08-11 09:22:50,905 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-13 00:00:00, 2025-01-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,905 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,918 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,932 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-14 00:00:00, 2025-01-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,934 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-14' AND '2025-01-14' (base.py:2260)
2025-08-11 09:22:50,936 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-14' AND '2025-01-14' (base.py:2260)
2025-08-11 09:22:50,942 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-14 00:00:00, 2025-01-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,942 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,954 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:50,968 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-15 00:00:00, 2025-01-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:50,969 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-15' AND '2025-01-15' (base.py:2260)
2025-08-11 09:22:50,974 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-15' AND '2025-01-15' (base.py:2260)
2025-08-11 09:22:50,979 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-15 00:00:00, 2025-01-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:50,979 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:50,991 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,005 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-16 00:00:00, 2025-01-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,006 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-16' AND '2025-01-16' (base.py:2260)
2025-08-11 09:22:51,009 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-16' AND '2025-01-16' (base.py:2260)
2025-08-11 09:22:51,015 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-16 00:00:00, 2025-01-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,015 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,029 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,044 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-17 00:00:00, 2025-01-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,045 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-17' AND '2025-01-17' (base.py:2260)
2025-08-11 09:22:51,048 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-17' AND '2025-01-17' (base.py:2260)
2025-08-11 09:22:51,052 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-17 00:00:00, 2025-01-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,052 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,066 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,081 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-18 00:00:00, 2025-01-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,082 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-18' AND '2025-01-18' (base.py:2260)
2025-08-11 09:22:51,085 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-18' AND '2025-01-18' (base.py:2260)
2025-08-11 09:22:51,091 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-18 00:00:00, 2025-01-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,091 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,102 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,118 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-19 00:00:00, 2025-01-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,119 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-19' AND '2025-01-19' (base.py:2260)
2025-08-11 09:22:51,123 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-19' AND '2025-01-19' (base.py:2260)
2025-08-11 09:22:51,128 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-19 00:00:00, 2025-01-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,128 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,142 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,156 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-20 00:00:00, 2025-01-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,158 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-20' AND '2025-01-20' (base.py:2260)
2025-08-11 09:22:51,162 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-20' AND '2025-01-20' (base.py:2260)
2025-08-11 09:22:51,167 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-20 00:00:00, 2025-01-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,167 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,181 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,194 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-21 00:00:00, 2025-01-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,195 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-21' AND '2025-01-21' (base.py:2260)
2025-08-11 09:22:51,198 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-21' AND '2025-01-21' (base.py:2260)
2025-08-11 09:22:51,203 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-21 00:00:00, 2025-01-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,203 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,285 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,301 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-22 00:00:00, 2025-01-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,302 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-22' AND '2025-01-22' (base.py:2260)
2025-08-11 09:22:51,304 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-22' AND '2025-01-22' (base.py:2260)
2025-08-11 09:22:51,310 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-22 00:00:00, 2025-01-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,310 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,325 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,340 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-23 00:00:00, 2025-01-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,341 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-23' AND '2025-01-23' (base.py:2260)
2025-08-11 09:22:51,344 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-23' AND '2025-01-23' (base.py:2260)
2025-08-11 09:22:51,349 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-23 00:00:00, 2025-01-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,350 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,362 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,377 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-24 00:00:00, 2025-01-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,378 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-24' AND '2025-01-24' (base.py:2260)
2025-08-11 09:22:51,380 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-24' AND '2025-01-24' (base.py:2260)
2025-08-11 09:22:51,387 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-24 00:00:00, 2025-01-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,387 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,401 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,417 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-25 00:00:00, 2025-01-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,419 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-25' AND '2025-01-25' (base.py:2260)
2025-08-11 09:22:51,421 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-25' AND '2025-01-25' (base.py:2260)
2025-08-11 09:22:51,425 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-25 00:00:00, 2025-01-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,425 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,437 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,453 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-26 00:00:00, 2025-01-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,454 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-26' AND '2025-01-26' (base.py:2260)
2025-08-11 09:22:51,458 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-26' AND '2025-01-26' (base.py:2260)
2025-08-11 09:22:51,462 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-26 00:00:00, 2025-01-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,462 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,475 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,491 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-27 00:00:00, 2025-01-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,494 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-27' AND '2025-01-27' (base.py:2260)
2025-08-11 09:22:51,498 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-27' AND '2025-01-27' (base.py:2260)
2025-08-11 09:22:51,503 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-27 00:00:00, 2025-01-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,503 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,515 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,535 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-28 00:00:00, 2025-01-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,536 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-28' AND '2025-01-28' (base.py:2260)
2025-08-11 09:22:51,540 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-28' AND '2025-01-28' (base.py:2260)
2025-08-11 09:22:51,545 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-28 00:00:00, 2025-01-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,545 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,557 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,571 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-29 00:00:00, 2025-01-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,573 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-29' AND '2025-01-29' (base.py:2260)
2025-08-11 09:22:51,576 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-29' AND '2025-01-29' (base.py:2260)
2025-08-11 09:22:51,581 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-29 00:00:00, 2025-01-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,581 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,594 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,609 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-30 00:00:00, 2025-01-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,611 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-30' AND '2025-01-30' (base.py:2260)
2025-08-11 09:22:51,615 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-30' AND '2025-01-30' (base.py:2260)
2025-08-11 09:22:51,619 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-30 00:00:00, 2025-01-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,620 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,633 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,649 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-01-31 00:00:00, 2025-02-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,651 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-01-31' AND '2025-01-31' (base.py:2260)
2025-08-11 09:22:51,654 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-01-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-01-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-01-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-01-31' AND '2025-01-31' (base.py:2260)
2025-08-11 09:22:51,659 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-01-31 00:00:00, 2025-02-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,659 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,672 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,686 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-01 00:00:00, 2025-02-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,687 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-01' AND '2025-02-01' (base.py:2260)
2025-08-11 09:22:51,690 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-01-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-01' AND '2025-02-01' (base.py:2260)
2025-08-11 09:22:51,694 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-01 00:00:00, 2025-02-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,694 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,708 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,724 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-02 00:00:00, 2025-02-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,725 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-02' AND '2025-02-02' (base.py:2260)
2025-08-11 09:22:51,730 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-02' AND '2025-02-02' (base.py:2260)
2025-08-11 09:22:51,735 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-02 00:00:00, 2025-02-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,735 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,749 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,764 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-03 00:00:00, 2025-02-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,765 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-03' AND '2025-02-03' (base.py:2260)
2025-08-11 09:22:51,768 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-03' AND '2025-02-03' (base.py:2260)
2025-08-11 09:22:51,773 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-03 00:00:00, 2025-02-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,773 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,788 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,802 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-04 00:00:00, 2025-02-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,803 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-04' AND '2025-02-04' (base.py:2260)
2025-08-11 09:22:51,805 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-04' AND '2025-02-04' (base.py:2260)
2025-08-11 09:22:51,810 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-04 00:00:00, 2025-02-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,810 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,824 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,841 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-05 00:00:00, 2025-02-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,844 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-05' AND '2025-02-05' (base.py:2260)
2025-08-11 09:22:51,847 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-05' AND '2025-02-05' (base.py:2260)
2025-08-11 09:22:51,853 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-05 00:00:00, 2025-02-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,853 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,864 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,881 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-06 00:00:00, 2025-02-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,882 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-06' AND '2025-02-06' (base.py:2260)
2025-08-11 09:22:51,885 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-06' AND '2025-02-06' (base.py:2260)
2025-08-11 09:22:51,889 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-06 00:00:00, 2025-02-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,889 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,903 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,916 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-07 00:00:00, 2025-02-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,918 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-07' AND '2025-02-07' (base.py:2260)
2025-08-11 09:22:51,920 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-07' AND '2025-02-07' (base.py:2260)
2025-08-11 09:22:51,925 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-07 00:00:00, 2025-02-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,925 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,939 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,953 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-08 00:00:00, 2025-02-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,954 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-08' AND '2025-02-08' (base.py:2260)
2025-08-11 09:22:51,960 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-08' AND '2025-02-08' (base.py:2260)
2025-08-11 09:22:51,965 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-08 00:00:00, 2025-02-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:51,965 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:51,979 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:51,995 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-09 00:00:00, 2025-02-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:51,996 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-09' AND '2025-02-09' (base.py:2260)
2025-08-11 09:22:51,999 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-09' AND '2025-02-09' (base.py:2260)
2025-08-11 09:22:52,003 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-09 00:00:00, 2025-02-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,003 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,018 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,032 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-10 00:00:00, 2025-02-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,033 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-10' AND '2025-02-10' (base.py:2260)
2025-08-11 09:22:52,036 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-10' AND '2025-02-10' (base.py:2260)
2025-08-11 09:22:52,041 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-10 00:00:00, 2025-02-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,041 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,057 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,072 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-11 00:00:00, 2025-02-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,073 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-11' AND '2025-02-11' (base.py:2260)
2025-08-11 09:22:52,078 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-11' AND '2025-02-11' (base.py:2260)
2025-08-11 09:22:52,083 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-11 00:00:00, 2025-02-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,083 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,096 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,111 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-12 00:00:00, 2025-02-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,112 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-12' AND '2025-02-12' (base.py:2260)
2025-08-11 09:22:52,115 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-12' AND '2025-02-12' (base.py:2260)
2025-08-11 09:22:52,119 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-12 00:00:00, 2025-02-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,119 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,133 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,148 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-13 00:00:00, 2025-02-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,151 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-13' AND '2025-02-13' (base.py:2260)
2025-08-11 09:22:52,155 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-13' AND '2025-02-13' (base.py:2260)
2025-08-11 09:22:52,160 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-13 00:00:00, 2025-02-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,160 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,173 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,188 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-14 00:00:00, 2025-02-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,189 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-14' AND '2025-02-14' (base.py:2260)
2025-08-11 09:22:52,195 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-14' AND '2025-02-14' (base.py:2260)
2025-08-11 09:22:52,200 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-14 00:00:00, 2025-02-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,200 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,216 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,230 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-15 00:00:00, 2025-02-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,231 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-15' AND '2025-02-15' (base.py:2260)
2025-08-11 09:22:52,234 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-15' AND '2025-02-15' (base.py:2260)
2025-08-11 09:22:52,238 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-15 00:00:00, 2025-02-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,238 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,253 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,268 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-16 00:00:00, 2025-02-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,269 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-16' AND '2025-02-16' (base.py:2260)
2025-08-11 09:22:52,271 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-16' AND '2025-02-16' (base.py:2260)
2025-08-11 09:22:52,276 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-16 00:00:00, 2025-02-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,276 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,289 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,306 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-17 00:00:00, 2025-02-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,307 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-17' AND '2025-02-17' (base.py:2260)
2025-08-11 09:22:52,312 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-17' AND '2025-02-17' (base.py:2260)
2025-08-11 09:22:52,317 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-17 00:00:00, 2025-02-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,317 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,331 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,347 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-18 00:00:00, 2025-02-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,348 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-18' AND '2025-02-18' (base.py:2260)
2025-08-11 09:22:52,351 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-18' AND '2025-02-18' (base.py:2260)
2025-08-11 09:22:52,355 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-18 00:00:00, 2025-02-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,355 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,370 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,385 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-19 00:00:00, 2025-02-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,388 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-19' AND '2025-02-19' (base.py:2260)
2025-08-11 09:22:52,391 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-19' AND '2025-02-19' (base.py:2260)
2025-08-11 09:22:52,395 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-19 00:00:00, 2025-02-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,395 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,408 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,423 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-20 00:00:00, 2025-02-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,426 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-20' AND '2025-02-20' (base.py:2260)
2025-08-11 09:22:52,430 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-20' AND '2025-02-20' (base.py:2260)
2025-08-11 09:22:52,435 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-20 00:00:00, 2025-02-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,435 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,448 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,463 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-21 00:00:00, 2025-02-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,464 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-21' AND '2025-02-21' (base.py:2260)
2025-08-11 09:22:52,466 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-21' AND '2025-02-21' (base.py:2260)
2025-08-11 09:22:52,471 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-21 00:00:00, 2025-02-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,471 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,489 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,502 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-22 00:00:00, 2025-02-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,504 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-22' AND '2025-02-22' (base.py:2260)
2025-08-11 09:22:52,507 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-22' AND '2025-02-22' (base.py:2260)
2025-08-11 09:22:52,512 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-22 00:00:00, 2025-02-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,512 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,526 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,541 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-23 00:00:00, 2025-02-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,545 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-23' AND '2025-02-23' (base.py:2260)
2025-08-11 09:22:52,548 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-23' AND '2025-02-23' (base.py:2260)
2025-08-11 09:22:52,553 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-23 00:00:00, 2025-02-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,554 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,565 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,581 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-24 00:00:00, 2025-02-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,582 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-24' AND '2025-02-24' (base.py:2260)
2025-08-11 09:22:52,584 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-24' AND '2025-02-24' (base.py:2260)
2025-08-11 09:22:52,589 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-24 00:00:00, 2025-02-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,589 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,603 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,618 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-25 00:00:00, 2025-02-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,620 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-25' AND '2025-02-25' (base.py:2260)
2025-08-11 09:22:52,623 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-25' AND '2025-02-25' (base.py:2260)
2025-08-11 09:22:52,628 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-25 00:00:00, 2025-02-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,628 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,642 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,660 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-26 00:00:00, 2025-02-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,665 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-26' AND '2025-02-26' (base.py:2260)
2025-08-11 09:22:52,670 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-26' AND '2025-02-26' (base.py:2260)
2025-08-11 09:22:52,676 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-26 00:00:00, 2025-02-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,676 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,691 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,712 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-27 00:00:00, 2025-02-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,713 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-27' AND '2025-02-27' (base.py:2260)
2025-08-11 09:22:52,716 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-27' AND '2025-02-27' (base.py:2260)
2025-08-11 09:22:52,722 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-27 00:00:00, 2025-02-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,722 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,735 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,749 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-02-28 00:00:00, 2025-03-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,750 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-02-28' AND '2025-02-28' (base.py:2260)
2025-08-11 09:22:52,753 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-02-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-02-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-02-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-02-28' AND '2025-02-28' (base.py:2260)
2025-08-11 09:22:52,760 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-02-28 00:00:00, 2025-03-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,760 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,775 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,790 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-01 00:00:00, 2025-03-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,792 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-01' AND '2025-03-01' (base.py:2260)
2025-08-11 09:22:52,797 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-02-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-01' AND '2025-03-01' (base.py:2260)
2025-08-11 09:22:52,802 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-01 00:00:00, 2025-03-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,802 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,818 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,837 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-02 00:00:00, 2025-03-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,838 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-02' AND '2025-03-02' (base.py:2260)
2025-08-11 09:22:52,842 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-02' AND '2025-03-02' (base.py:2260)
2025-08-11 09:22:52,846 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-02 00:00:00, 2025-03-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,846 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,860 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,881 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-03 00:00:00, 2025-03-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,886 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-03' AND '2025-03-03' (base.py:2260)
2025-08-11 09:22:52,889 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-03' AND '2025-03-03' (base.py:2260)
2025-08-11 09:22:52,894 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-03 00:00:00, 2025-03-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,894 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,910 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,926 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-04 00:00:00, 2025-03-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,927 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-04' AND '2025-03-04' (base.py:2260)
2025-08-11 09:22:52,931 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-04' AND '2025-03-04' (base.py:2260)
2025-08-11 09:22:52,940 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-04 00:00:00, 2025-03-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,940 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,955 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:52,970 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-05 00:00:00, 2025-03-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:52,971 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-05' AND '2025-03-05' (base.py:2260)
2025-08-11 09:22:52,975 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-05' AND '2025-03-05' (base.py:2260)
2025-08-11 09:22:52,980 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-05 00:00:00, 2025-03-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:52,980 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:52,992 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,009 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-06 00:00:00, 2025-03-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,011 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-06' AND '2025-03-06' (base.py:2260)
2025-08-11 09:22:53,016 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-06' AND '2025-03-06' (base.py:2260)
2025-08-11 09:22:53,021 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-06 00:00:00, 2025-03-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,021 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,036 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,053 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-07 00:00:00, 2025-03-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,054 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-07' AND '2025-03-07' (base.py:2260)
2025-08-11 09:22:53,058 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-07' AND '2025-03-07' (base.py:2260)
2025-08-11 09:22:53,063 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-07 00:00:00, 2025-03-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,063 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,078 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,098 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-08 00:00:00, 2025-03-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,100 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-08' AND '2025-03-08' (base.py:2260)
2025-08-11 09:22:53,104 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-08' AND '2025-03-08' (base.py:2260)
2025-08-11 09:22:53,108 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-08 00:00:00, 2025-03-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,108 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,127 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,144 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-09 00:00:00, 2025-03-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,145 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-09' AND '2025-03-09' (base.py:2260)
2025-08-11 09:22:53,150 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-09' AND '2025-03-09' (base.py:2260)
2025-08-11 09:22:53,154 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-09 00:00:00, 2025-03-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,154 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,167 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,181 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-10 00:00:00, 2025-03-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,183 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-10' AND '2025-03-10' (base.py:2260)
2025-08-11 09:22:53,186 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-10' AND '2025-03-10' (base.py:2260)
2025-08-11 09:22:53,192 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-10 00:00:00, 2025-03-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,192 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,267 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,281 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-11 00:00:00, 2025-03-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,282 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-11' AND '2025-03-11' (base.py:2260)
2025-08-11 09:22:53,285 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-11' AND '2025-03-11' (base.py:2260)
2025-08-11 09:22:53,290 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-11 00:00:00, 2025-03-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,290 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,303 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,318 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-12 00:00:00, 2025-03-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,319 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-12' AND '2025-03-12' (base.py:2260)
2025-08-11 09:22:53,322 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-12' AND '2025-03-12' (base.py:2260)
2025-08-11 09:22:53,326 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-12 00:00:00, 2025-03-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,326 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,340 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,356 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-13 00:00:00, 2025-03-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,357 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-13' AND '2025-03-13' (base.py:2260)
2025-08-11 09:22:53,360 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-13' AND '2025-03-13' (base.py:2260)
2025-08-11 09:22:53,365 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-13 00:00:00, 2025-03-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,365 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,381 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,396 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-14 00:00:00, 2025-03-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,397 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-14' AND '2025-03-14' (base.py:2260)
2025-08-11 09:22:53,399 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-14' AND '2025-03-14' (base.py:2260)
2025-08-11 09:22:53,403 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-14 00:00:00, 2025-03-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,403 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,417 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,430 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-15 00:00:00, 2025-03-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,432 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-15' AND '2025-03-15' (base.py:2260)
2025-08-11 09:22:53,435 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-15' AND '2025-03-15' (base.py:2260)
2025-08-11 09:22:53,440 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-15 00:00:00, 2025-03-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,441 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,455 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,469 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-16 00:00:00, 2025-03-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,470 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-16' AND '2025-03-16' (base.py:2260)
2025-08-11 09:22:53,473 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-16' AND '2025-03-16' (base.py:2260)
2025-08-11 09:22:53,480 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-16 00:00:00, 2025-03-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,480 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,493 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,507 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-17 00:00:00, 2025-03-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,508 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-17' AND '2025-03-17' (base.py:2260)
2025-08-11 09:22:53,511 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-17' AND '2025-03-17' (base.py:2260)
2025-08-11 09:22:53,516 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-17 00:00:00, 2025-03-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,516 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,530 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,547 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-18 00:00:00, 2025-03-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,548 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-18' AND '2025-03-18' (base.py:2260)
2025-08-11 09:22:53,552 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-18' AND '2025-03-18' (base.py:2260)
2025-08-11 09:22:53,559 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-18 00:00:00, 2025-03-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,559 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,572 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,587 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-19 00:00:00, 2025-03-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,589 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-19' AND '2025-03-19' (base.py:2260)
2025-08-11 09:22:53,593 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-19' AND '2025-03-19' (base.py:2260)
2025-08-11 09:22:53,597 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-19 00:00:00, 2025-03-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,597 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,612 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,627 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-20 00:00:00, 2025-03-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,628 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-20' AND '2025-03-20' (base.py:2260)
2025-08-11 09:22:53,630 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-20' AND '2025-03-20' (base.py:2260)
2025-08-11 09:22:53,635 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-20 00:00:00, 2025-03-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,635 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,650 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,665 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-21 00:00:00, 2025-03-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,667 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-21' AND '2025-03-21' (base.py:2260)
2025-08-11 09:22:53,670 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-21' AND '2025-03-21' (base.py:2260)
2025-08-11 09:22:53,674 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-21 00:00:00, 2025-03-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,675 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,691 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,705 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-22 00:00:00, 2025-03-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,706 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-22' AND '2025-03-22' (base.py:2260)
2025-08-11 09:22:53,711 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-22' AND '2025-03-22' (base.py:2260)
2025-08-11 09:22:53,716 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-22 00:00:00, 2025-03-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,716 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,733 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,749 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-23 00:00:00, 2025-03-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,750 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-23' AND '2025-03-23' (base.py:2260)
2025-08-11 09:22:53,753 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-23' AND '2025-03-23' (base.py:2260)
2025-08-11 09:22:53,760 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-23 00:00:00, 2025-03-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,761 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,776 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,791 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-24 00:00:00, 2025-03-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,793 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-24' AND '2025-03-24' (base.py:2260)
2025-08-11 09:22:53,796 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-24' AND '2025-03-24' (base.py:2260)
2025-08-11 09:22:53,802 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-24 00:00:00, 2025-03-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,802 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,815 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,829 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-25 00:00:00, 2025-03-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,831 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-25' AND '2025-03-25' (base.py:2260)
2025-08-11 09:22:53,836 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-25' AND '2025-03-25' (base.py:2260)
2025-08-11 09:22:53,840 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-25 00:00:00, 2025-03-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,840 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,856 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,873 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-26 00:00:00, 2025-03-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,874 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-26' AND '2025-03-26' (base.py:2260)
2025-08-11 09:22:53,878 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-26' AND '2025-03-26' (base.py:2260)
2025-08-11 09:22:53,883 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-26 00:00:00, 2025-03-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,883 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,895 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,913 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-27 00:00:00, 2025-03-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,915 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-27' AND '2025-03-27' (base.py:2260)
2025-08-11 09:22:53,918 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-27' AND '2025-03-27' (base.py:2260)
2025-08-11 09:22:53,923 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-27 00:00:00, 2025-03-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,923 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,939 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,954 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-28 00:00:00, 2025-03-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,955 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-28' AND '2025-03-28' (base.py:2260)
2025-08-11 09:22:53,961 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-28' AND '2025-03-28' (base.py:2260)
2025-08-11 09:22:53,967 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-28 00:00:00, 2025-03-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:53,967 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:53,982 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:53,997 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-29 00:00:00, 2025-03-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:53,998 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-29' AND '2025-03-29' (base.py:2260)
2025-08-11 09:22:54,001 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-29' AND '2025-03-29' (base.py:2260)
2025-08-11 09:22:54,006 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-29 00:00:00, 2025-03-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,007 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,021 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,035 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-30 00:00:00, 2025-03-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,037 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-30' AND '2025-03-30' (base.py:2260)
2025-08-11 09:22:54,039 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-30' AND '2025-03-30' (base.py:2260)
2025-08-11 09:22:54,044 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-30 00:00:00, 2025-03-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,045 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,059 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,074 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-03-31 00:00:00, 2025-04-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,076 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-03-31' AND '2025-03-31' (base.py:2260)
2025-08-11 09:22:54,080 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-03-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-03-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-03-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-03-31' AND '2025-03-31' (base.py:2260)
2025-08-11 09:22:54,084 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-03-31 00:00:00, 2025-04-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,084 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,097 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,114 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-01 00:00:00, 2025-04-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,116 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-01' AND '2025-04-01' (base.py:2260)
2025-08-11 09:22:54,119 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-03-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-01' AND '2025-04-01' (base.py:2260)
2025-08-11 09:22:54,124 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-01 00:00:00, 2025-04-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,124 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,138 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,151 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-02 00:00:00, 2025-04-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,154 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-02' AND '2025-04-02' (base.py:2260)
2025-08-11 09:22:54,157 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-02' AND '2025-04-02' (base.py:2260)
2025-08-11 09:22:54,161 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-02 00:00:00, 2025-04-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,161 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,173 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,186 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-03 00:00:00, 2025-04-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,188 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-03' AND '2025-04-03' (base.py:2260)
2025-08-11 09:22:54,191 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-03' AND '2025-04-03' (base.py:2260)
2025-08-11 09:22:54,196 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-03 00:00:00, 2025-04-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,196 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,211 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,225 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-04 00:00:00, 2025-04-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,226 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-04' AND '2025-04-04' (base.py:2260)
2025-08-11 09:22:54,229 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-04' AND '2025-04-04' (base.py:2260)
2025-08-11 09:22:54,233 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-04 00:00:00, 2025-04-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,234 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,249 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,263 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-05 00:00:00, 2025-04-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,264 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-05' AND '2025-04-05' (base.py:2260)
2025-08-11 09:22:54,267 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-05' AND '2025-04-05' (base.py:2260)
2025-08-11 09:22:54,272 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-05 00:00:00, 2025-04-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,272 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,283 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,299 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-06 00:00:00, 2025-04-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,300 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-06' AND '2025-04-06' (base.py:2260)
2025-08-11 09:22:54,302 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-06' AND '2025-04-06' (base.py:2260)
2025-08-11 09:22:54,309 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-06 00:00:00, 2025-04-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,309 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,323 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,339 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-07 00:00:00, 2025-04-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,341 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-07' AND '2025-04-07' (base.py:2260)
2025-08-11 09:22:54,344 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-07' AND '2025-04-07' (base.py:2260)
2025-08-11 09:22:54,349 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-07 00:00:00, 2025-04-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,350 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,361 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,375 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-08 00:00:00, 2025-04-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,377 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-08' AND '2025-04-08' (base.py:2260)
2025-08-11 09:22:54,380 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-08' AND '2025-04-08' (base.py:2260)
2025-08-11 09:22:54,384 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-08 00:00:00, 2025-04-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,384 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,399 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,412 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-09 00:00:00, 2025-04-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,415 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-09' AND '2025-04-09' (base.py:2260)
2025-08-11 09:22:54,420 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-09' AND '2025-04-09' (base.py:2260)
2025-08-11 09:22:54,425 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-09 00:00:00, 2025-04-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,425 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,437 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,450 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-10 00:00:00, 2025-04-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,451 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-10' AND '2025-04-10' (base.py:2260)
2025-08-11 09:22:54,454 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-10' AND '2025-04-10' (base.py:2260)
2025-08-11 09:22:54,459 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-10 00:00:00, 2025-04-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,459 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,473 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,487 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-11 00:00:00, 2025-04-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,488 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-11' AND '2025-04-11' (base.py:2260)
2025-08-11 09:22:54,491 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-11' AND '2025-04-11' (base.py:2260)
2025-08-11 09:22:54,495 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-11 00:00:00, 2025-04-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,495 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,510 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,525 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-12 00:00:00, 2025-04-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,526 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-12' AND '2025-04-12' (base.py:2260)
2025-08-11 09:22:54,531 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-12' AND '2025-04-12' (base.py:2260)
2025-08-11 09:22:54,536 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-12 00:00:00, 2025-04-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,536 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,549 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,567 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-13 00:00:00, 2025-04-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,568 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-13' AND '2025-04-13' (base.py:2260)
2025-08-11 09:22:54,571 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-13' AND '2025-04-13' (base.py:2260)
2025-08-11 09:22:54,577 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-13 00:00:00, 2025-04-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,577 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,589 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,605 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-14 00:00:00, 2025-04-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,606 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-14' AND '2025-04-14' (base.py:2260)
2025-08-11 09:22:54,609 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-14' AND '2025-04-14' (base.py:2260)
2025-08-11 09:22:54,614 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-14 00:00:00, 2025-04-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,614 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,630 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,644 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-15 00:00:00, 2025-04-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,647 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-15' AND '2025-04-15' (base.py:2260)
2025-08-11 09:22:54,651 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-15' AND '2025-04-15' (base.py:2260)
2025-08-11 09:22:54,655 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-15 00:00:00, 2025-04-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,655 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,670 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,684 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-16 00:00:00, 2025-04-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,685 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-16' AND '2025-04-16' (base.py:2260)
2025-08-11 09:22:54,688 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-16' AND '2025-04-16' (base.py:2260)
2025-08-11 09:22:54,692 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-16 00:00:00, 2025-04-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,692 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,707 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,720 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-17 00:00:00, 2025-04-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,723 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-17' AND '2025-04-17' (base.py:2260)
2025-08-11 09:22:54,725 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-17' AND '2025-04-17' (base.py:2260)
2025-08-11 09:22:54,730 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-17 00:00:00, 2025-04-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,730 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,744 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,758 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-18 00:00:00, 2025-04-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,759 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-18' AND '2025-04-18' (base.py:2260)
2025-08-11 09:22:54,764 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-18' AND '2025-04-18' (base.py:2260)
2025-08-11 09:22:54,768 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-18 00:00:00, 2025-04-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,768 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,780 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,796 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-19 00:00:00, 2025-04-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,798 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-19' AND '2025-04-19' (base.py:2260)
2025-08-11 09:22:54,801 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-19' AND '2025-04-19' (base.py:2260)
2025-08-11 09:22:54,805 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-19 00:00:00, 2025-04-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,805 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,820 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,835 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-20 00:00:00, 2025-04-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,836 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-20' AND '2025-04-20' (base.py:2260)
2025-08-11 09:22:54,839 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-20' AND '2025-04-20' (base.py:2260)
2025-08-11 09:22:54,844 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-20 00:00:00, 2025-04-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,844 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,857 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,872 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-21 00:00:00, 2025-04-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,874 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-21' AND '2025-04-21' (base.py:2260)
2025-08-11 09:22:54,879 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-21' AND '2025-04-21' (base.py:2260)
2025-08-11 09:22:54,886 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-21 00:00:00, 2025-04-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,886 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,900 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,914 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-22 00:00:00, 2025-04-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,915 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-22' AND '2025-04-22' (base.py:2260)
2025-08-11 09:22:54,917 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-22' AND '2025-04-22' (base.py:2260)
2025-08-11 09:22:54,921 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-22 00:00:00, 2025-04-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,922 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,936 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,949 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-23 00:00:00, 2025-04-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,950 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-23' AND '2025-04-23' (base.py:2260)
2025-08-11 09:22:54,953 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-23' AND '2025-04-23' (base.py:2260)
2025-08-11 09:22:54,957 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-23 00:00:00, 2025-04-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,957 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:54,971 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:54,987 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-24 00:00:00, 2025-04-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:54,991 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-24' AND '2025-04-24' (base.py:2260)
2025-08-11 09:22:54,994 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-24' AND '2025-04-24' (base.py:2260)
2025-08-11 09:22:54,998 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-24 00:00:00, 2025-04-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:54,998 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,012 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,029 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-25 00:00:00, 2025-04-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,030 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-25' AND '2025-04-25' (base.py:2260)
2025-08-11 09:22:55,033 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-25' AND '2025-04-25' (base.py:2260)
2025-08-11 09:22:55,037 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-25 00:00:00, 2025-04-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,037 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,051 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,067 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-26 00:00:00, 2025-04-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,068 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-26' AND '2025-04-26' (base.py:2260)
2025-08-11 09:22:55,071 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-26' AND '2025-04-26' (base.py:2260)
2025-08-11 09:22:55,075 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-26 00:00:00, 2025-04-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,075 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,088 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,102 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-27 00:00:00, 2025-04-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,105 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-27' AND '2025-04-27' (base.py:2260)
2025-08-11 09:22:55,108 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-27' AND '2025-04-27' (base.py:2260)
2025-08-11 09:22:55,112 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-27 00:00:00, 2025-04-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,112 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,126 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,140 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-28 00:00:00, 2025-04-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,142 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-28' AND '2025-04-28' (base.py:2260)
2025-08-11 09:22:55,146 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-28' AND '2025-04-28' (base.py:2260)
2025-08-11 09:22:55,152 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-28 00:00:00, 2025-04-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,152 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,167 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,180 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-29 00:00:00, 2025-04-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,181 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-29' AND '2025-04-29' (base.py:2260)
2025-08-11 09:22:55,184 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-29' AND '2025-04-29' (base.py:2260)
2025-08-11 09:22:55,189 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-29 00:00:00, 2025-04-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,189 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,203 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,220 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-04-30 00:00:00, 2025-05-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,221 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-04-30' AND '2025-04-30' (base.py:2260)
2025-08-11 09:22:55,226 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-04-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-04-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-04-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-04-30' AND '2025-04-30' (base.py:2260)
2025-08-11 09:22:55,231 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-04-30 00:00:00, 2025-05-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,231 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,244 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,260 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-01 00:00:00, 2025-05-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,261 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-01' AND '2025-05-01' (base.py:2260)
2025-08-11 09:22:55,263 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-04-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-01' AND '2025-05-01' (base.py:2260)
2025-08-11 09:22:55,269 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-01 00:00:00, 2025-05-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,269 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,281 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,295 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-02 00:00:00, 2025-05-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,298 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-02' AND '2025-05-02' (base.py:2260)
2025-08-11 09:22:55,369 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-02' AND '2025-05-02' (base.py:2260)
2025-08-11 09:22:55,373 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-02 00:00:00, 2025-05-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,373 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,387 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,401 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-03 00:00:00, 2025-05-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,403 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-03' AND '2025-05-03' (base.py:2260)
2025-08-11 09:22:55,406 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-03' AND '2025-05-03' (base.py:2260)
2025-08-11 09:22:55,412 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-03 00:00:00, 2025-05-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,412 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,428 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,441 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-04 00:00:00, 2025-05-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,442 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-04' AND '2025-05-04' (base.py:2260)
2025-08-11 09:22:55,445 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-04' AND '2025-05-04' (base.py:2260)
2025-08-11 09:22:55,449 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-04 00:00:00, 2025-05-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,449 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,463 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,479 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-05 00:00:00, 2025-05-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,482 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-05' AND '2025-05-05' (base.py:2260)
2025-08-11 09:22:55,486 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-05' AND '2025-05-05' (base.py:2260)
2025-08-11 09:22:55,490 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-05 00:00:00, 2025-05-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,490 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,502 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,517 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-06 00:00:00, 2025-05-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,519 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-06' AND '2025-05-06' (base.py:2260)
2025-08-11 09:22:55,522 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-06' AND '2025-05-06' (base.py:2260)
2025-08-11 09:22:55,526 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-06 00:00:00, 2025-05-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,527 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,541 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,556 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-07 00:00:00, 2025-05-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,557 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-07' AND '2025-05-07' (base.py:2260)
2025-08-11 09:22:55,560 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-07' AND '2025-05-07' (base.py:2260)
2025-08-11 09:22:55,565 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-07 00:00:00, 2025-05-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,565 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,579 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,592 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-08 00:00:00, 2025-05-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,594 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-08' AND '2025-05-08' (base.py:2260)
2025-08-11 09:22:55,598 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-08' AND '2025-05-08' (base.py:2260)
2025-08-11 09:22:55,603 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-08 00:00:00, 2025-05-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,603 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,617 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,632 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-09 00:00:00, 2025-05-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,633 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-09' AND '2025-05-09' (base.py:2260)
2025-08-11 09:22:55,636 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-09' AND '2025-05-09' (base.py:2260)
2025-08-11 09:22:55,642 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-09 00:00:00, 2025-05-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,642 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,654 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,669 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-10 00:00:00, 2025-05-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,670 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-10' AND '2025-05-10' (base.py:2260)
2025-08-11 09:22:55,672 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-10' AND '2025-05-10' (base.py:2260)
2025-08-11 09:22:55,677 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-10 00:00:00, 2025-05-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,677 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,690 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,704 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-11 00:00:00, 2025-05-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,705 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-11' AND '2025-05-11' (base.py:2260)
2025-08-11 09:22:55,708 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-11' AND '2025-05-11' (base.py:2260)
2025-08-11 09:22:55,715 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-11 00:00:00, 2025-05-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,715 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,728 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,743 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-12 00:00:00, 2025-05-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,744 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-12' AND '2025-05-12' (base.py:2260)
2025-08-11 09:22:55,747 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-12' AND '2025-05-12' (base.py:2260)
2025-08-11 09:22:55,752 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-12 00:00:00, 2025-05-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,752 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,764 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,778 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-13 00:00:00, 2025-05-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,779 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-13' AND '2025-05-13' (base.py:2260)
2025-08-11 09:22:55,782 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-13' AND '2025-05-13' (base.py:2260)
2025-08-11 09:22:55,785 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-13 00:00:00, 2025-05-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,785 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,799 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,813 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-14 00:00:00, 2025-05-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,815 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-14' AND '2025-05-14' (base.py:2260)
2025-08-11 09:22:55,817 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-14' AND '2025-05-14' (base.py:2260)
2025-08-11 09:22:55,822 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-14 00:00:00, 2025-05-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,822 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,836 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,853 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-15 00:00:00, 2025-05-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,854 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-15' AND '2025-05-15' (base.py:2260)
2025-08-11 09:22:55,858 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-15' AND '2025-05-15' (base.py:2260)
2025-08-11 09:22:55,863 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-15 00:00:00, 2025-05-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,863 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,877 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,891 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-16 00:00:00, 2025-05-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,892 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-16' AND '2025-05-16' (base.py:2260)
2025-08-11 09:22:55,895 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-16' AND '2025-05-16' (base.py:2260)
2025-08-11 09:22:55,899 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-16 00:00:00, 2025-05-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,899 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,915 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,929 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-17 00:00:00, 2025-05-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,933 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-17' AND '2025-05-17' (base.py:2260)
2025-08-11 09:22:55,937 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-17' AND '2025-05-17' (base.py:2260)
2025-08-11 09:22:55,940 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-17 00:00:00, 2025-05-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,940 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,952 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:55,971 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-18 00:00:00, 2025-05-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:55,972 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-18' AND '2025-05-18' (base.py:2260)
2025-08-11 09:22:55,975 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-18' AND '2025-05-18' (base.py:2260)
2025-08-11 09:22:55,979 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-18 00:00:00, 2025-05-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:55,979 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:55,992 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,008 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-19 00:00:00, 2025-05-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,009 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-19' AND '2025-05-19' (base.py:2260)
2025-08-11 09:22:56,012 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-19' AND '2025-05-19' (base.py:2260)
2025-08-11 09:22:56,016 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-19 00:00:00, 2025-05-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,016 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,029 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,044 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-20 00:00:00, 2025-05-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,045 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-20' AND '2025-05-20' (base.py:2260)
2025-08-11 09:22:56,049 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-20' AND '2025-05-20' (base.py:2260)
2025-08-11 09:22:56,054 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-20 00:00:00, 2025-05-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,054 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,067 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,083 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-21 00:00:00, 2025-05-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,084 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-21' AND '2025-05-21' (base.py:2260)
2025-08-11 09:22:56,088 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-21' AND '2025-05-21' (base.py:2260)
2025-08-11 09:22:56,093 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-21 00:00:00, 2025-05-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,093 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,107 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,121 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-22 00:00:00, 2025-05-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,122 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-22' AND '2025-05-22' (base.py:2260)
2025-08-11 09:22:56,124 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-22' AND '2025-05-22' (base.py:2260)
2025-08-11 09:22:56,128 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-22 00:00:00, 2025-05-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,128 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,143 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,158 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-23 00:00:00, 2025-05-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,159 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-23' AND '2025-05-23' (base.py:2260)
2025-08-11 09:22:56,165 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-23' AND '2025-05-23' (base.py:2260)
2025-08-11 09:22:56,170 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-23 00:00:00, 2025-05-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,170 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,183 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,199 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-24 00:00:00, 2025-05-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,200 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-24' AND '2025-05-24' (base.py:2260)
2025-08-11 09:22:56,202 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-24' AND '2025-05-24' (base.py:2260)
2025-08-11 09:22:56,206 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-24 00:00:00, 2025-05-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,206 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,220 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,234 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-25 00:00:00, 2025-05-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,235 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-25' AND '2025-05-25' (base.py:2260)
2025-08-11 09:22:56,238 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-25' AND '2025-05-25' (base.py:2260)
2025-08-11 09:22:56,242 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-25 00:00:00, 2025-05-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,242 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,256 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,270 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-26 00:00:00, 2025-05-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,272 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-26' AND '2025-05-26' (base.py:2260)
2025-08-11 09:22:56,276 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-26' AND '2025-05-26' (base.py:2260)
2025-08-11 09:22:56,281 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-26 00:00:00, 2025-05-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,281 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,295 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,310 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-27 00:00:00, 2025-05-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,311 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-27' AND '2025-05-27' (base.py:2260)
2025-08-11 09:22:56,314 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-27' AND '2025-05-27' (base.py:2260)
2025-08-11 09:22:56,319 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-27 00:00:00, 2025-05-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,319 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,332 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,346 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-28 00:00:00, 2025-05-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,347 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-28' AND '2025-05-28' (base.py:2260)
2025-08-11 09:22:56,350 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-28' AND '2025-05-28' (base.py:2260)
2025-08-11 09:22:56,354 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-28 00:00:00, 2025-05-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,355 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,371 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,386 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-29 00:00:00, 2025-05-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,387 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-29' AND '2025-05-29' (base.py:2260)
2025-08-11 09:22:56,391 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-29' AND '2025-05-29' (base.py:2260)
2025-08-11 09:22:56,396 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-29 00:00:00, 2025-05-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,396 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,408 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,424 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-30 00:00:00, 2025-05-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,425 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-30' AND '2025-05-30' (base.py:2260)
2025-08-11 09:22:56,428 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-30' AND '2025-05-30' (base.py:2260)
2025-08-11 09:22:56,432 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-30 00:00:00, 2025-05-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,433 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,446 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,460 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-05-31 00:00:00, 2025-06-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,462 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-05-31' AND '2025-05-31' (base.py:2260)
2025-08-11 09:22:56,465 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-05-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-05-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-05-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-05-31' AND '2025-05-31' (base.py:2260)
2025-08-11 09:22:56,470 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-05-31 00:00:00, 2025-06-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,470 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,484 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,500 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-01 00:00:00, 2025-06-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,501 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-01' AND '2025-06-01' (base.py:2260)
2025-08-11 09:22:56,505 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-05-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-01' AND '2025-06-01' (base.py:2260)
2025-08-11 09:22:56,510 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-01 00:00:00, 2025-06-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,510 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,524 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,538 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-02 00:00:00, 2025-06-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,539 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-02' AND '2025-06-02' (base.py:2260)
2025-08-11 09:22:56,543 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-02' AND '2025-06-02' (base.py:2260)
2025-08-11 09:22:56,547 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-02 00:00:00, 2025-06-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,547 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,561 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,576 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-03 00:00:00, 2025-06-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,577 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-03' AND '2025-06-03' (base.py:2260)
2025-08-11 09:22:56,581 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-03' AND '2025-06-03' (base.py:2260)
2025-08-11 09:22:56,586 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-03 00:00:00, 2025-06-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,586 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,603 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,619 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-04 00:00:00, 2025-06-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,622 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-04' AND '2025-06-04' (base.py:2260)
2025-08-11 09:22:56,625 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-04' AND '2025-06-04' (base.py:2260)
2025-08-11 09:22:56,629 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-04 00:00:00, 2025-06-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,629 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,643 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,660 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-05 00:00:00, 2025-06-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,661 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-05' AND '2025-06-05' (base.py:2260)
2025-08-11 09:22:56,664 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-05' AND '2025-06-05' (base.py:2260)
2025-08-11 09:22:56,668 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-05 00:00:00, 2025-06-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,669 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,682 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,697 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-06 00:00:00, 2025-06-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,698 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-06' AND '2025-06-06' (base.py:2260)
2025-08-11 09:22:56,700 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-06' AND '2025-06-06' (base.py:2260)
2025-08-11 09:22:56,705 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-06 00:00:00, 2025-06-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,705 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,719 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,735 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-07 00:00:00, 2025-06-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,736 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-07' AND '2025-06-07' (base.py:2260)
2025-08-11 09:22:56,741 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-07' AND '2025-06-07' (base.py:2260)
2025-08-11 09:22:56,746 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-07 00:00:00, 2025-06-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,746 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,759 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,774 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-08 00:00:00, 2025-06-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,775 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-08' AND '2025-06-08' (base.py:2260)
2025-08-11 09:22:56,779 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-08' AND '2025-06-08' (base.py:2260)
2025-08-11 09:22:56,783 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-08 00:00:00, 2025-06-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,783 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,799 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,813 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-09 00:00:00, 2025-06-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,814 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-09' AND '2025-06-09' (base.py:2260)
2025-08-11 09:22:56,818 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-09' AND '2025-06-09' (base.py:2260)
2025-08-11 09:22:56,821 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-09 00:00:00, 2025-06-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,821 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,839 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,853 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-10 00:00:00, 2025-06-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,856 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-10' AND '2025-06-10' (base.py:2260)
2025-08-11 09:22:56,859 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-10' AND '2025-06-10' (base.py:2260)
2025-08-11 09:22:56,864 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-10 00:00:00, 2025-06-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,864 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,878 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,895 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-11 00:00:00, 2025-06-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,896 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-11' AND '2025-06-11' (base.py:2260)
2025-08-11 09:22:56,900 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-11' AND '2025-06-11' (base.py:2260)
2025-08-11 09:22:56,904 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-11 00:00:00, 2025-06-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,904 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,918 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,933 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-12 00:00:00, 2025-06-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,934 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-12' AND '2025-06-12' (base.py:2260)
2025-08-11 09:22:56,937 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-12' AND '2025-06-12' (base.py:2260)
2025-08-11 09:22:56,941 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-12 00:00:00, 2025-06-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,941 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:56,956 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:56,975 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-13 00:00:00, 2025-06-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:56,978 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-13' AND '2025-06-13' (base.py:2260)
2025-08-11 09:22:56,981 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-13' AND '2025-06-13' (base.py:2260)
2025-08-11 09:22:56,986 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-13 00:00:00, 2025-06-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:56,986 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,000 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,018 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-14 00:00:00, 2025-06-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,019 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-14' AND '2025-06-14' (base.py:2260)
2025-08-11 09:22:57,024 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-14' AND '2025-06-14' (base.py:2260)
2025-08-11 09:22:57,029 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-14 00:00:00, 2025-06-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,029 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,042 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,056 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-15 00:00:00, 2025-06-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,057 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-15' AND '2025-06-15' (base.py:2260)
2025-08-11 09:22:57,060 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-15' AND '2025-06-15' (base.py:2260)
2025-08-11 09:22:57,065 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-15 00:00:00, 2025-06-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,065 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,080 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,095 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-16 00:00:00, 2025-06-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,097 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-16' AND '2025-06-16' (base.py:2260)
2025-08-11 09:22:57,102 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-16' AND '2025-06-16' (base.py:2260)
2025-08-11 09:22:57,106 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-16 00:00:00, 2025-06-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,107 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,119 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,135 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-17 00:00:00, 2025-06-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,137 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-17' AND '2025-06-17' (base.py:2260)
2025-08-11 09:22:57,139 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-17' AND '2025-06-17' (base.py:2260)
2025-08-11 09:22:57,144 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-17 00:00:00, 2025-06-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,144 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,157 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,172 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-18 00:00:00, 2025-06-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,173 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-18' AND '2025-06-18' (base.py:2260)
2025-08-11 09:22:57,176 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-18' AND '2025-06-18' (base.py:2260)
2025-08-11 09:22:57,181 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-18 00:00:00, 2025-06-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,181 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,197 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,211 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-19 00:00:00, 2025-06-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,214 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-19' AND '2025-06-19' (base.py:2260)
2025-08-11 09:22:57,219 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-19' AND '2025-06-19' (base.py:2260)
2025-08-11 09:22:57,224 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-19 00:00:00, 2025-06-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,224 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,237 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,252 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-20 00:00:00, 2025-06-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,254 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-20' AND '2025-06-20' (base.py:2260)
2025-08-11 09:22:57,258 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-20' AND '2025-06-20' (base.py:2260)
2025-08-11 09:22:57,261 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-20 00:00:00, 2025-06-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,261 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,280 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,295 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-21 00:00:00, 2025-06-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,296 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-21' AND '2025-06-21' (base.py:2260)
2025-08-11 09:22:57,299 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-21' AND '2025-06-21' (base.py:2260)
2025-08-11 09:22:57,305 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-21 00:00:00, 2025-06-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,305 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,319 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,332 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-22 00:00:00, 2025-06-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,333 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-22' AND '2025-06-22' (base.py:2260)
2025-08-11 09:22:57,338 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-22' AND '2025-06-22' (base.py:2260)
2025-08-11 09:22:57,342 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-22 00:00:00, 2025-06-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,343 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,356 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,372 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-23 00:00:00, 2025-06-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,374 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-23' AND '2025-06-23' (base.py:2260)
2025-08-11 09:22:57,377 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-23' AND '2025-06-23' (base.py:2260)
2025-08-11 09:22:57,382 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-23 00:00:00, 2025-06-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,382 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,394 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,409 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-24 00:00:00, 2025-06-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,410 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-24' AND '2025-06-24' (base.py:2260)
2025-08-11 09:22:57,413 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-24' AND '2025-06-24' (base.py:2260)
2025-08-11 09:22:57,417 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-24 00:00:00, 2025-06-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,417 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,431 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,445 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-25 00:00:00, 2025-06-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,450 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-25' AND '2025-06-25' (base.py:2260)
2025-08-11 09:22:57,453 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-25' AND '2025-06-25' (base.py:2260)
2025-08-11 09:22:57,457 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-25 00:00:00, 2025-06-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,457 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,470 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,487 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-26 00:00:00, 2025-06-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,488 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-26' AND '2025-06-26' (base.py:2260)
2025-08-11 09:22:57,582 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-26' AND '2025-06-26' (base.py:2260)
2025-08-11 09:22:57,586 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-26 00:00:00, 2025-06-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,586 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,598 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,613 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-27 00:00:00, 2025-06-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,614 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-27' AND '2025-06-27' (base.py:2260)
2025-08-11 09:22:57,617 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-27' AND '2025-06-27' (base.py:2260)
2025-08-11 09:22:57,621 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-27 00:00:00, 2025-06-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,621 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,636 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,649 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-28 00:00:00, 2025-06-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,651 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-28' AND '2025-06-28' (base.py:2260)
2025-08-11 09:22:57,654 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-28' AND '2025-06-28' (base.py:2260)
2025-08-11 09:22:57,659 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-28 00:00:00, 2025-06-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,659 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,671 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,686 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-29 00:00:00, 2025-06-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,687 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-29' AND '2025-06-29' (base.py:2260)
2025-08-11 09:22:57,690 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-29' AND '2025-06-29' (base.py:2260)
2025-08-11 09:22:57,695 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-29 00:00:00, 2025-06-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,695 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,708 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,724 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-06-30 00:00:00, 2025-07-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,725 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-06-30' AND '2025-06-30' (base.py:2260)
2025-08-11 09:22:57,728 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-06-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-06-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-06-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-06-30' AND '2025-06-30' (base.py:2260)
2025-08-11 09:22:57,733 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-06-30 00:00:00, 2025-07-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,733 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,747 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,763 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-01 00:00:00, 2025-07-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,765 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-01' AND '2025-07-01' (base.py:2260)
2025-08-11 09:22:57,768 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-06-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-01' AND '2025-07-01' (base.py:2260)
2025-08-11 09:22:57,777 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-01 00:00:00, 2025-07-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,777 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,791 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,806 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-02 00:00:00, 2025-07-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,808 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-02' AND '2025-07-02' (base.py:2260)
2025-08-11 09:22:57,814 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-02' AND '2025-07-02' (base.py:2260)
2025-08-11 09:22:57,819 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-02 00:00:00, 2025-07-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,819 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,833 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,848 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-03 00:00:00, 2025-07-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,850 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-03' AND '2025-07-03' (base.py:2260)
2025-08-11 09:22:57,853 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-03' AND '2025-07-03' (base.py:2260)
2025-08-11 09:22:57,858 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-03 00:00:00, 2025-07-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,858 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,872 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,885 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-04 00:00:00, 2025-07-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,886 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-04' AND '2025-07-04' (base.py:2260)
2025-08-11 09:22:57,889 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-04' AND '2025-07-04' (base.py:2260)
2025-08-11 09:22:57,894 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-04 00:00:00, 2025-07-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,894 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,907 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,921 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-05 00:00:00, 2025-07-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,923 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-05' AND '2025-07-05' (base.py:2260)
2025-08-11 09:22:57,927 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-05' AND '2025-07-05' (base.py:2260)
2025-08-11 09:22:57,930 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-05 00:00:00, 2025-07-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,931 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,945 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,961 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-06 00:00:00, 2025-07-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:57,963 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-06' AND '2025-07-06' (base.py:2260)
2025-08-11 09:22:57,966 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-06' AND '2025-07-06' (base.py:2260)
2025-08-11 09:22:57,970 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-06 00:00:00, 2025-07-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:57,970 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:57,984 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:57,999 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-07 00:00:00, 2025-07-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,001 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-07' AND '2025-07-07' (base.py:2260)
2025-08-11 09:22:58,004 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-07' AND '2025-07-07' (base.py:2260)
2025-08-11 09:22:58,009 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-07 00:00:00, 2025-07-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,009 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,022 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,038 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-08 00:00:00, 2025-07-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,041 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-08' AND '2025-07-08' (base.py:2260)
2025-08-11 09:22:58,046 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-08' AND '2025-07-08' (base.py:2260)
2025-08-11 09:22:58,051 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-08 00:00:00, 2025-07-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,051 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,065 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,082 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-09 00:00:00, 2025-07-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,083 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-09' AND '2025-07-09' (base.py:2260)
2025-08-11 09:22:58,087 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-09' AND '2025-07-09' (base.py:2260)
2025-08-11 09:22:58,091 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-09 00:00:00, 2025-07-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,092 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,109 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,124 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-10 00:00:00, 2025-07-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,125 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-10' AND '2025-07-10' (base.py:2260)
2025-08-11 09:22:58,129 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-10' AND '2025-07-10' (base.py:2260)
2025-08-11 09:22:58,134 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-10 00:00:00, 2025-07-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,134 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,149 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,165 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-11 00:00:00, 2025-07-12 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,168 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-11' AND '2025-07-11' (base.py:2260)
2025-08-11 09:22:58,172 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-11' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-11' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-10' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-11' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-11' AND '2025-07-11' (base.py:2260)
2025-08-11 09:22:58,176 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-11 00:00:00, 2025-07-12 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,176 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,189 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,205 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-12 00:00:00, 2025-07-13 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,206 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-12' AND '2025-07-12' (base.py:2260)
2025-08-11 09:22:58,210 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-12' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-12' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-11' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-12' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-12' AND '2025-07-12' (base.py:2260)
2025-08-11 09:22:58,216 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-12 00:00:00, 2025-07-13 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,216 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,229 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,244 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-13 00:00:00, 2025-07-14 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,246 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-13' AND '2025-07-13' (base.py:2260)
2025-08-11 09:22:58,248 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-13' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-13' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-12' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-13' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-13' AND '2025-07-13' (base.py:2260)
2025-08-11 09:22:58,252 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-13 00:00:00, 2025-07-14 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,252 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,267 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,282 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-14 00:00:00, 2025-07-15 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,283 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-14' AND '2025-07-14' (base.py:2260)
2025-08-11 09:22:58,288 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-14' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-14' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-13' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-14' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-14' AND '2025-07-14' (base.py:2260)
2025-08-11 09:22:58,294 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-14 00:00:00, 2025-07-15 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,294 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,307 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,322 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-15 00:00:00, 2025-07-16 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,323 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-15' AND '2025-07-15' (base.py:2260)
2025-08-11 09:22:58,326 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-15' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-15' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-14' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-15' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-15' AND '2025-07-15' (base.py:2260)
2025-08-11 09:22:58,330 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-15 00:00:00, 2025-07-16 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,330 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,344 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,360 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-16 00:00:00, 2025-07-17 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,360 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-16' AND '2025-07-16' (base.py:2260)
2025-08-11 09:22:58,363 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-16' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-16' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-15' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-16' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-16' AND '2025-07-16' (base.py:2260)
2025-08-11 09:22:58,368 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-16 00:00:00, 2025-07-17 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,368 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,385 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,403 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-17 00:00:00, 2025-07-18 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,406 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-17' AND '2025-07-17' (base.py:2260)
2025-08-11 09:22:58,409 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-17' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-17' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-16' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-17' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-17' AND '2025-07-17' (base.py:2260)
2025-08-11 09:22:58,413 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-17 00:00:00, 2025-07-18 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,413 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,425 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,441 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-18 00:00:00, 2025-07-19 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,442 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-18' AND '2025-07-18' (base.py:2260)
2025-08-11 09:22:58,446 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-18' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-18' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-17' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-18' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-18' AND '2025-07-18' (base.py:2260)
2025-08-11 09:22:58,451 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-18 00:00:00, 2025-07-19 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,451 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,466 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,481 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-19 00:00:00, 2025-07-20 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,482 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-19' AND '2025-07-19' (base.py:2260)
2025-08-11 09:22:58,485 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-19' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-19' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-18' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-19' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-19' AND '2025-07-19' (base.py:2260)
2025-08-11 09:22:58,490 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-19 00:00:00, 2025-07-20 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,490 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,504 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,520 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-20 00:00:00, 2025-07-21 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,523 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-20' AND '2025-07-20' (base.py:2260)
2025-08-11 09:22:58,528 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-20' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-20' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-19' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-20' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-20' AND '2025-07-20' (base.py:2260)
2025-08-11 09:22:58,532 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-20 00:00:00, 2025-07-21 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,532 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,546 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,560 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-21 00:00:00, 2025-07-22 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,562 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-21' AND '2025-07-21' (base.py:2260)
2025-08-11 09:22:58,566 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-21' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-21' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-20' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-21' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-21' AND '2025-07-21' (base.py:2260)
2025-08-11 09:22:58,571 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-21 00:00:00, 2025-07-22 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,571 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,586 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,600 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-22 00:00:00, 2025-07-23 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,601 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-22' AND '2025-07-22' (base.py:2260)
2025-08-11 09:22:58,604 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-22' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-22' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-21' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-22' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-22' AND '2025-07-22' (base.py:2260)
2025-08-11 09:22:58,609 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-22 00:00:00, 2025-07-23 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,609 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,621 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,637 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-23 00:00:00, 2025-07-24 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,640 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-23' AND '2025-07-23' (base.py:2260)
2025-08-11 09:22:58,643 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-23' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-23' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-22' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-23' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-23' AND '2025-07-23' (base.py:2260)
2025-08-11 09:22:58,647 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-23 00:00:00, 2025-07-24 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,647 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,662 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,678 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-24 00:00:00, 2025-07-25 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,680 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-24' AND '2025-07-24' (base.py:2260)
2025-08-11 09:22:58,683 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-24' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-24' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-23' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-24' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-24' AND '2025-07-24' (base.py:2260)
2025-08-11 09:22:58,687 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-24 00:00:00, 2025-07-25 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,687 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,700 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,715 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-25 00:00:00, 2025-07-26 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,716 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-25' AND '2025-07-25' (base.py:2260)
2025-08-11 09:22:58,719 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-25' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-25' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-24' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-25' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-25' AND '2025-07-25' (base.py:2260)
2025-08-11 09:22:58,724 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-25 00:00:00, 2025-07-26 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,724 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,738 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,751 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-26 00:00:00, 2025-07-27 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,752 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-26' AND '2025-07-26' (base.py:2260)
2025-08-11 09:22:58,758 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-26' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-26' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-25' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-26' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-26' AND '2025-07-26' (base.py:2260)
2025-08-11 09:22:58,762 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-26 00:00:00, 2025-07-27 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,762 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,778 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,792 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-27 00:00:00, 2025-07-28 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,793 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-27' AND '2025-07-27' (base.py:2260)
2025-08-11 09:22:58,796 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-27' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-27' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-26' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-27' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-27' AND '2025-07-27' (base.py:2260)
2025-08-11 09:22:58,801 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-27 00:00:00, 2025-07-28 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,801 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,817 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,831 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-28 00:00:00, 2025-07-29 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,832 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-28' AND '2025-07-28' (base.py:2260)
2025-08-11 09:22:58,836 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-28' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-28' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-27' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-28' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-28' AND '2025-07-28' (base.py:2260)
2025-08-11 09:22:58,841 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-28 00:00:00, 2025-07-29 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,841 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,853 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,869 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-29 00:00:00, 2025-07-30 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,870 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-29' AND '2025-07-29' (base.py:2260)
2025-08-11 09:22:58,874 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-29' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-29' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-28' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-29' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-29' AND '2025-07-29' (base.py:2260)
2025-08-11 09:22:58,880 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-29 00:00:00, 2025-07-30 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,880 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,897 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,912 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-30 00:00:00, 2025-07-31 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,913 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-30' AND '2025-07-30' (base.py:2260)
2025-08-11 09:22:58,917 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-30' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-30' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-29' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-30' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-30' AND '2025-07-30' (base.py:2260)
2025-08-11 09:22:58,922 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-30 00:00:00, 2025-07-31 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,922 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,935 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,949 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-31 00:00:00, 2025-08-01 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,950 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-07-31' AND '2025-07-31' (base.py:2260)
2025-08-11 09:22:58,953 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-07-31' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-07-31' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-30' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-07-31' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-07-31' AND '2025-07-31' (base.py:2260)
2025-08-11 09:22:58,957 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-31 00:00:00, 2025-08-01 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,957 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:58,971 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:58,984 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-01 00:00:00, 2025-08-02 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:58,988 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-08-01' AND '2025-08-01' (base.py:2260)
2025-08-11 09:22:58,992 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-08-01' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-08-01' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-07-31' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-08-01' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-08-01' AND '2025-08-01' (base.py:2260)
2025-08-11 09:22:58,997 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-01 00:00:00, 2025-08-02 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:58,997 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:59,010 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:59,024 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-02 00:00:00, 2025-08-03 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:59,025 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-08-02' AND '2025-08-02' (base.py:2260)
2025-08-11 09:22:59,029 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-08-02' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-08-02' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-08-01' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-08-02' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-08-02' AND '2025-08-02' (base.py:2260)
2025-08-11 09:22:59,033 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-02 00:00:00, 2025-08-03 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:59,033 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:59,047 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:59,060 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-03 00:00:00, 2025-08-04 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:59,062 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-08-03' AND '2025-08-03' (base.py:2260)
2025-08-11 09:22:59,065 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-08-03' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-08-03' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-08-02' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-08-03' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-08-03' AND '2025-08-03' (base.py:2260)
2025-08-11 09:22:59,070 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-03 00:00:00, 2025-08-04 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:59,070 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:59,082 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:59,097 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-04 00:00:00, 2025-08-05 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:59,098 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-08-04' AND '2025-08-04' (base.py:2260)
2025-08-11 09:22:59,102 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-08-04' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-08-04' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-08-03' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-08-04' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-08-04' AND '2025-08-04' (base.py:2260)
2025-08-11 09:22:59,107 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-04 00:00:00, 2025-08-05 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:59,107 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:59,119 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:59,135 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-05 00:00:00, 2025-08-06 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:59,137 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-08-05' AND '2025-08-05' (base.py:2260)
2025-08-11 09:22:59,139 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-08-05' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-08-05' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-08-04' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-08-05' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-08-05' AND '2025-08-05' (base.py:2260)
2025-08-11 09:22:59,144 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-05 00:00:00, 2025-08-06 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:59,145 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:59,159 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:59,174 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-06 00:00:00, 2025-08-07 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:59,175 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-08-06' AND '2025-08-06' (base.py:2260)
2025-08-11 09:22:59,178 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-08-06' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-08-06' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-08-05' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-08-06' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-08-06' AND '2025-08-06' (base.py:2260)
2025-08-11 09:22:59,183 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-06 00:00:00, 2025-08-07 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:59,183 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:59,196 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:59,209 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-07 00:00:00, 2025-08-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:59,211 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-08-07' AND '2025-08-07' (base.py:2260)
2025-08-11 09:22:59,214 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-08-07' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-08-07' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-08-06' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-08-07' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-08-07' AND '2025-08-07' (base.py:2260)
2025-08-11 09:22:59,219 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-07 00:00:00, 2025-08-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:59,220 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:59,233 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:59,247 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-08 00:00:00, 2025-08-09 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:59,248 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-08-08' AND '2025-08-08' (base.py:2260)
2025-08-11 09:22:59,253 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-08-08' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-08-08' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-08-07' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-08-08' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-08-08' AND '2025-08-08' (base.py:2260)
2025-08-11 09:22:59,257 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-08 00:00:00, 2025-08-09 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:59,258 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:59,271 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:59,284 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-09 00:00:00, 2025-08-10 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:59,285 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-08-09' AND '2025-08-09' (base.py:2260)
2025-08-11 09:22:59,288 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-08-09' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-08-09' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-08-08' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-08-09' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-08-09' AND '2025-08-09' (base.py:2260)
2025-08-11 09:22:59,294 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-09 00:00:00, 2025-08-10 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:59,294 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:59,307 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (evaluator.py:648)
2025-08-11 09:22:59,323 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-10 00:00:00, 2025-08-11 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:703)
2025-08-11 09:22:59,324 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ DELETE FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" WHERE "ds" BETWEEN '2025-08-10' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:59,327 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ INSERT INTO "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" ("customer_id", "revenue", "ds") WITH "order_total" AS (SELECT "oi"."order_id" AS "order_id", SUM("oi"."quantity" * "i"."price") AS "total" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" AS "oi" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" AS "i" ON "i"."ds" = "oi"."ds" AND "i"."id" = "oi"."item_id" WHERE "oi"."ds" = '2025-08-10' GROUP BY "oi"."order_id"), "incremental_total" AS (SELECT "o"."customer_id" AS "customer_id", SUM("ot"."total") AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" AS "o" LEFT JOIN "order_total" AS "ot" ON "o"."id" = "ot"."order_id" WHERE "o"."ds" = '2025-08-10' GROUP BY "o"."customer_id"), "prev_total" AS (SELECT "crl"."customer_id" AS "customer_id", "crl"."revenue" AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" AS "crl" WHERE "crl"."ds" = STRFTIME(CAST('2025-08-09' AS DATE), '%Y-%m-%d')) SELECT "customer_id", "revenue", "ds" FROM (SELECT COALESCE("it"."customer_id", "prev_total"."customer_id") AS "customer_id", COALESCE("it"."revenue", 0) + COALESCE("prev_total"."revenue", 0) AS "revenue", '2025-08-10' AS "ds" FROM "incremental_total" AS "it" FULL OUTER JOIN "prev_total" AS "prev_total" ON "it"."customer_id" = "prev_total"."customer_id") AS "_subquery" WHERE "ds" BETWEEN '2025-08-10' AND '2025-08-10' (base.py:2260)
2025-08-11 09:22:59,332 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-10 00:00:00, 2025-08-11 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (facade.py:619)
2025-08-11 09:22:59,332 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_revenue_lifetime": 846247608> (interval.py:213)
2025-08-11 09:22:59,349 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage EnvironmentRecordUpdateStage (evaluator.py:125)
2025-08-11 09:22:59,349 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Promoting environment 'dev' (facade.py:167)
2025-08-11 09:22:59,367 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage VirtualLayerUpdateStage (evaluator.py:125)
2025-08-11 09:22:59,373 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema '"sushi-example".sushimoderate__dev' (evaluator.py:1176)
2025-08-11 09:22:59,373 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE SCHEMA IF NOT EXISTS "sushi-example"."sushimoderate__dev" (base.py:2260)
2025-08-11 09:22:59,375 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema '"sushi-example".raw__dev' (evaluator.py:1176)
2025-08-11 09:22:59,375 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE SCHEMA IF NOT EXISTS "sushi-example"."raw__dev" (base.py:2260)
2025-08-11 09:22:59,378 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".raw__dev.demographics' to point at table '"sushi-example".sqlmesh__raw.raw__demographics__3399964752' (evaluator.py:1493)
2025-08-11 09:22:59,379 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."raw__dev"."demographics" AS SELECT * FROM "sushi-example"."sqlmesh__raw"."raw__demographics__3399964752" (base.py:2260)
2025-08-11 09:22:59,384 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".raw__dev.items' to point at table '"sushi-example".sqlmesh__raw.raw__items__1587933360' (evaluator.py:1493)
2025-08-11 09:22:59,384 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."raw__dev"."items" AS SELECT * FROM "sushi-example"."sqlmesh__raw"."raw__items__1587933360" (base.py:2260)
2025-08-11 09:22:59,388 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".raw__dev.marketing' to point at table '"sushi-example".sqlmesh__raw.raw__marketing__2281409975' (evaluator.py:1493)
2025-08-11 09:22:59,388 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."raw__dev"."marketing" AS SELECT * FROM "sushi-example"."sqlmesh__raw"."raw__marketing__2281409975" (base.py:2260)
2025-08-11 09:22:59,392 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".raw__dev.order_items' to point at table '"sushi-example".sqlmesh__raw.raw__order_items__654969149' (evaluator.py:1493)
2025-08-11 09:22:59,393 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."raw__dev"."order_items" AS SELECT * FROM "sushi-example"."sqlmesh__raw"."raw__order_items__654969149" (base.py:2260)
2025-08-11 09:22:59,397 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".raw__dev.orders' to point at table '"sushi-example".sqlmesh__raw.raw__orders__1960537533' (evaluator.py:1493)
2025-08-11 09:22:59,398 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."raw__dev"."orders" AS SELECT * FROM "sushi-example"."sqlmesh__raw"."raw__orders__1960537533" (base.py:2260)
2025-08-11 09:22:59,402 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.waiter_names' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__waiter_names__1494776325' (evaluator.py:1493)
2025-08-11 09:22:59,403 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."waiter_names" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_names__1494776325" (base.py:2260)
2025-08-11 09:22:59,407 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.items' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__items__4183556318' (evaluator.py:1493)
2025-08-11 09:22:59,408 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."items" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__4183556318" (base.py:2260)
2025-08-11 09:22:59,412 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.order_items' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__order_items__3229655664' (evaluator.py:1493)
2025-08-11 09:22:59,413 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."order_items" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__3229655664" (base.py:2260)
2025-08-11 09:22:59,417 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.orders' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__orders__2553744583' (evaluator.py:1493)
2025-08-11 09:22:59,417 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."orders" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2553744583" (base.py:2260)
2025-08-11 09:22:59,421 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.customer_revenue_by_day' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_by_day__2161423016' (evaluator.py:1493)
2025-08-11 09:22:59,422 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."customer_revenue_by_day" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_by_day__2161423016" (base.py:2260)
2025-08-11 09:22:59,426 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.customer_revenue_lifetime' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__2371348360' (evaluator.py:1493)
2025-08-11 09:22:59,427 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."customer_revenue_lifetime" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__2371348360" (base.py:2260)
2025-08-11 09:22:59,430 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.customers' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customers__1460721243' (evaluator.py:1493)
2025-08-11 09:22:59,431 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."customers" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1460721243" (base.py:2260)
2025-08-11 09:22:59,434 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.waiter_revenue_by_day' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__waiter_revenue_by_day__2502736145' (evaluator.py:1493)
2025-08-11 09:22:59,435 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."waiter_revenue_by_day" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__2502736145" (base.py:2260)
2025-08-11 09:22:59,438 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.top_waiters' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__top_waiters__4200137544' (evaluator.py:1493)
2025-08-11 09:22:59,439 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 9e8083525dc345dc8722a6997e41565f */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."top_waiters" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__4200137544" (base.py:2260)
2025-08-11 09:22:59,444 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage FinalizeEnvironmentStage (evaluator.py:125)
2025-08-11 09:22:59,444 - MainThread - sqlmesh.core.state_sync.db.environment - INFO - Finalizing environment 'dev' (environment.py:139)
2025-08-11 09:22:59,485 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
