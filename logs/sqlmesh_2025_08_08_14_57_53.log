2025-08-08 14:57:53,562 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'db/sushi-example.db'} (connection.py:481)
2025-08-08 14:57:54,108 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:483)
2025-08-08 14:57:54,109 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:483)
2025-08-08 14:57:54,192 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: db/sushi-example.db (connection.py:471)
2025-08-08 14:57:56,114 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage PhysicalLayerUpdateStage (evaluator.py:125)
2025-08-08 14:57:56,116 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema "sushi-example".sqlmesh__sushimoderate (evaluator.py:361)
2025-08-08 14:57:56,116 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-08 14:57:56,116 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-08 14:57:56,118 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'sushi-example' AND table_schema = 'sqlmesh__sushimoderate') AND table_name IN ('sushimoderate__top_waiters__3569809579', 'sushimoderate__waiter_names__1494776325', 'sushimoderate__customer_segments__2917654191', 'sushimoderate__order_items__4050422953', 'sushimoderate__customers__1405437590', 'sushimoderate__customer_revenue_lifetime__1390750626', 'sushimoderate__waiter_revenue_by_day__3677256476', 'sushimoderate__customer_revenue_by_day__1770424383', 'sushimoderate__orders__2914195010', 'sushimoderate__items__1305987177', 'sushimoderate__customer_lifetime_value__1687617668') (base.py:2260)
2025-08-08 14:57:56,128 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage BackfillStage (evaluator.py:125)
2025-08-08 14:57:56,128 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage EnvironmentRecordUpdateStage (evaluator.py:125)
2025-08-08 14:57:56,128 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Promoting environment 'prod' (facade.py:167)
2025-08-08 14:57:56,155 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage MigrateSchemasStage (evaluator.py:125)
2025-08-08 14:57:56,156 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ DESCRIBE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__3569809579" (base.py:2260)
2025-08-08 14:57:56,157 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Migrating table schema from '"sushi-example".sqlmesh__sushimoderate.sushimoderate__top_waiters__3569809579__dev' to '"sushi-example".sqlmesh__sushimoderate.sushimoderate__top_waiters__3569809579' (evaluator.py:940)
2025-08-08 14:57:56,157 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Migrating view '"sushi-example".sqlmesh__sushimoderate.sushimoderate__top_waiters__3569809579' (evaluator.py:2007)
2025-08-08 14:57:56,164 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ CREATE OR REPLACE VIEW "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__3569809579" ("waiter_id", "waiter_name", "revenue") AS SELECT CAST("r"."waiter_id" AS INT) AS "waiter_id", CAST("n"."name" AS TEXT) AS "waiter_name", CAST("r"."revenue" AS DOUBLE) AS "revenue" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__3677256476" AS "r" LEFT JOIN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_names__1494776325" AS "n" ON "n"."id" = "r"."waiter_id" WHERE "r"."ds" = (SELECT MAX("waiter_revenue_by_day"."ds") AS "_col_0" FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__3677256476" AS "waiter_revenue_by_day") ORDER BY "revenue" DESC LIMIT 10 (base.py:2260)
2025-08-08 14:57:56,168 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ COMMENT ON VIEW "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__3569809579" IS 'View of 10 waiters with highest revenue on most recent day of data.' (base.py:2260)
2025-08-08 14:57:56,171 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__3569809579"."waiter_id" IS 'Waiter ID' (base.py:2260)
2025-08-08 14:57:56,173 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__3569809579"."waiter_name" IS 'Waiter name' (base.py:2260)
2025-08-08 14:57:56,176 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ COMMENT ON COLUMN "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__3569809579"."revenue" IS 'Waiter revenue on most recent day of data' (base.py:2260)
2025-08-08 14:57:56,179 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage UnpauseStage (evaluator.py:125)
2025-08-08 14:57:56,180 - MainThread - sqlmesh.core.state_sync.db.snapshot - INFO - Unpausing snapshot SnapshotId<"sushi-example"."sushimoderate"."top_waiters": 3549594052> (snapshot.py:143)
2025-08-08 14:57:56,181 - MainThread - sqlmesh.core.state_sync.db.snapshot - INFO - Unpausing snapshot SnapshotId<"sushi-example"."sushimoderate"."waiter_names": 2534315953> (snapshot.py:143)
2025-08-08 14:57:56,181 - MainThread - sqlmesh.core.state_sync.db.snapshot - INFO - Unpausing snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_segments": 1007898447> (snapshot.py:143)
2025-08-08 14:57:56,184 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage VirtualLayerUpdateStage (evaluator.py:125)
2025-08-08 14:57:56,187 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema '"sushi-example".sushimoderate' (evaluator.py:1176)
2025-08-08 14:57:56,187 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ CREATE SCHEMA IF NOT EXISTS "sushi-example"."sushimoderate" (base.py:2260)
2025-08-08 14:57:56,188 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate.customer_segments' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_segments__2917654191' (evaluator.py:1493)
2025-08-08 14:57:56,188 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate"."customer_segments" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_segments__2917654191" (base.py:2260)
2025-08-08 14:57:56,192 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate.waiter_names' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__waiter_names__1494776325' (evaluator.py:1493)
2025-08-08 14:57:56,192 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate"."waiter_names" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_names__1494776325" (base.py:2260)
2025-08-08 14:57:56,195 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ COMMENT ON VIEW "sushi-example"."sushimoderate"."waiter_names" IS 'Seed data containing water names.' (base.py:2260)
2025-08-08 14:57:56,199 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate.top_waiters' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__top_waiters__3569809579' (evaluator.py:1493)
2025-08-08 14:57:56,199 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate"."top_waiters" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__3569809579" (base.py:2260)
2025-08-08 14:57:56,202 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ COMMENT ON VIEW "sushi-example"."sushimoderate"."top_waiters" IS 'View of 10 waiters with highest revenue on most recent day of data.' (base.py:2260)
2025-08-08 14:57:56,205 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ COMMENT ON COLUMN "sushi-example"."sushimoderate"."top_waiters"."waiter_id" IS 'Waiter ID' (base.py:2260)
2025-08-08 14:57:56,207 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ COMMENT ON COLUMN "sushi-example"."sushimoderate"."top_waiters"."waiter_name" IS 'Waiter name' (base.py:2260)
2025-08-08 14:57:56,210 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: f2af788dd45d4b40808c78e9316a375b */ COMMENT ON COLUMN "sushi-example"."sushimoderate"."top_waiters"."revenue" IS 'Waiter revenue on most recent day of data' (base.py:2260)
2025-08-08 14:57:56,215 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage FinalizeEnvironmentStage (evaluator.py:125)
2025-08-08 14:57:56,215 - MainThread - sqlmesh.core.state_sync.db.environment - INFO - Finalizing environment 'prod' (environment.py:139)
2025-08-08 14:57:56,240 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
