2025-08-08 14:57:46,802 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'db/sushi-example.db'} (connection.py:481)
2025-08-08 14:57:47,331 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:483)
2025-08-08 14:57:47,332 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:483)
2025-08-08 14:57:47,415 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: db/sushi-example.db (connection.py:471)
2025-08-08 14:57:49,026 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage CreateSnapshotRecordsStage (evaluator.py:125)
2025-08-08 14:57:49,051 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage PhysicalLayerUpdateStage (evaluator.py:125)
2025-08-08 14:57:49,053 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema "sushi-example".sqlmesh__sushimoderate (evaluator.py:361)
2025-08-08 14:57:49,053 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-08 14:57:49,054 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-08 14:57:49,055 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'sushi-example' AND table_schema = 'sqlmesh__sushimoderate') AND table_name IN ('sushimoderate__customer_revenue_by_day__1770424383', 'sushimoderate__waiter_revenue_by_day__3677256476', 'sushimoderate__order_items__4050422953', 'sushimoderate__top_waiters__3569809579', 'sushimoderate__customer_revenue_lifetime__1390750626', 'sushimoderate__customers__1405437590', 'sushimoderate__waiter_names__1494776325', 'sushimoderate__customer_lifetime_value__1687617668', 'sushimoderate__customer_segments__2917654191', 'sushimoderate__items__1305987177', 'sushimoderate__orders__2914195010') (base.py:2260)
2025-08-08 14:57:49,067 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema '"sushi-example".sqlmesh__sushimoderate' (evaluator.py:1176)
2025-08-08 14:57:49,067 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE SCHEMA IF NOT EXISTS "sushi-example"."sqlmesh__sushimoderate" (base.py:2260)
2025-08-08 14:57:49,068 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_segments__2917654191' (evaluator.py:1538)
2025-08-08 14:57:49,068 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-08 14:57:49,068 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-08 14:57:49,069 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE TABLE IF NOT EXISTS "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_segments__2917654191" ("customer_id" INT, "lifetime_value" DOUBLE, "historical_revenue" DOUBLE, "active_months" BIGINT, "tenure_days" INT, "cluster" INT, "segment" TEXT) (base.py:2260)
2025-08-08 14:57:49,075 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage BackfillStage (evaluator.py:125)
2025-08-08 14:57:49,077 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_segments": 1007898447> (evaluator.py:648)
2025-08-08 14:57:49,079 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ 
        SELECT
            customer_id,
            lifetime_value,
            historical_revenue,
            active_months,
            first_order_date
        FROM sushimoderate.customer_lifetime_value
     (base.py:2260)
2025-08-08 14:57:49,088 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-07 00:00:00, 2025-08-08 00:00:00) into "sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_segments__2917654191' (evaluator.py:703)
2025-08-08 14:57:49,093 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ SELECT CURRENT_CATALOG() (base.py:2260)
2025-08-08 14:57:49,094 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'sushi-example' (base.py:2260)
2025-08-08 14:57:49,095 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE TABLE "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_segments__2917654191" AS SELECT CAST("customer_id" AS INT) AS "customer_id", CAST("lifetime_value" AS DOUBLE) AS "lifetime_value", CAST("historical_revenue" AS DOUBLE) AS "historical_revenue", CAST("active_months" AS BIGINT) AS "active_months", CAST("tenure_days" AS INT) AS "tenure_days", CAST("cluster" AS INT) AS "cluster", CAST("segment" AS TEXT) AS "segment" FROM (SELECT "customer_id", "lifetime_value", "historical_revenue", "active_months", "tenure_days", "cluster", "segment" FROM "sushi-example"."sqlmesh__sushimoderate"."__temp_sushimoderate__customer_segments__2917654191_x4z7jgw7") AS "_subquery" (base.py:2260)
2025-08-08 14:57:49,098 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ DROP TABLE IF EXISTS "sushi-example"."sqlmesh__sushimoderate"."__temp_sushimoderate__customer_segments__2917654191_x4z7jgw7" (base.py:2260)
2025-08-08 14:57:49,101 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-07 00:00:00, 2025-08-08 00:00:00) for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_segments": 1007898447> (facade.py:619)
2025-08-08 14:57:49,101 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sushi-example"."sushimoderate"."customer_segments": 1007898447> (interval.py:213)
2025-08-08 14:57:49,117 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage EnvironmentRecordUpdateStage (evaluator.py:125)
2025-08-08 14:57:49,117 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Promoting environment 'dev' (facade.py:167)
2025-08-08 14:57:49,142 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage VirtualLayerUpdateStage (evaluator.py:125)
2025-08-08 14:57:49,146 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema '"sushi-example".sushimoderate__dev' (evaluator.py:1176)
2025-08-08 14:57:49,146 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE SCHEMA IF NOT EXISTS "sushi-example"."sushimoderate__dev" (base.py:2260)
2025-08-08 14:57:49,147 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.customer_segments' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_segments__2917654191' (evaluator.py:1493)
2025-08-08 14:57:49,148 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."customer_segments" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_segments__2917654191" (base.py:2260)
2025-08-08 14:57:49,152 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.items' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__items__1305987177' (evaluator.py:1493)
2025-08-08 14:57:49,152 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."items" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__items__1305987177" (base.py:2260)
2025-08-08 14:57:49,156 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.order_items' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__order_items__4050422953' (evaluator.py:1493)
2025-08-08 14:57:49,156 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."order_items" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__order_items__4050422953" (base.py:2260)
2025-08-08 14:57:49,161 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.orders' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__orders__2914195010' (evaluator.py:1493)
2025-08-08 14:57:49,161 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."orders" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__orders__2914195010" (base.py:2260)
2025-08-08 14:57:49,166 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.waiter_names' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__waiter_names__1494776325' (evaluator.py:1493)
2025-08-08 14:57:49,166 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."waiter_names" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_names__1494776325" (base.py:2260)
2025-08-08 14:57:49,170 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.customer_revenue_by_day' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_by_day__1770424383' (evaluator.py:1493)
2025-08-08 14:57:49,171 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."customer_revenue_by_day" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_by_day__1770424383" (base.py:2260)
2025-08-08 14:57:49,175 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.customer_revenue_lifetime' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_revenue_lifetime__1390750626' (evaluator.py:1493)
2025-08-08 14:57:49,175 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."customer_revenue_lifetime" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_revenue_lifetime__1390750626" (base.py:2260)
2025-08-08 14:57:49,180 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.customers' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customers__1405437590' (evaluator.py:1493)
2025-08-08 14:57:49,180 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."customers" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customers__1405437590" (base.py:2260)
2025-08-08 14:57:49,184 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.waiter_revenue_by_day' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__waiter_revenue_by_day__3677256476' (evaluator.py:1493)
2025-08-08 14:57:49,185 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."waiter_revenue_by_day" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__waiter_revenue_by_day__3677256476" (base.py:2260)
2025-08-08 14:57:49,189 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.customer_lifetime_value' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__customer_lifetime_value__1687617668' (evaluator.py:1493)
2025-08-08 14:57:49,190 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."customer_lifetime_value" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__customer_lifetime_value__1687617668" (base.py:2260)
2025-08-08 14:57:49,194 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view '"sushi-example".sushimoderate__dev.top_waiters' to point at table '"sushi-example".sqlmesh__sushimoderate.sushimoderate__top_waiters__3569809579' (evaluator.py:1493)
2025-08-08 14:57:49,194 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 2408892aef3048d493e48dab2a47d7f0 */ CREATE OR REPLACE VIEW "sushi-example"."sushimoderate__dev"."top_waiters" AS SELECT * FROM "sushi-example"."sqlmesh__sushimoderate"."sushimoderate__top_waiters__3569809579" (base.py:2260)
2025-08-08 14:57:49,199 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage FinalizeEnvironmentStage (evaluator.py:125)
2025-08-08 14:57:49,199 - MainThread - sqlmesh.core.state_sync.db.environment - INFO - Finalizing environment 'dev' (environment.py:139)
2025-08-08 14:57:49,232 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
